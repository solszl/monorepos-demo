"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("crypto")),n=Object.freeze({__proto__:null}),r=Math.ceil,i=Math.floor,a=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)},o=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function s(e,t){return e(t={exports:{}},t.exports),t.exports}var u=s((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),l=s((function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)}));l.version;var c=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},h=function(e,t,n){if(c(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},f=function(e){try{return!!e()}catch(e){return!0}},d=!f((function(){return 7!=m({},"a",{get:function(){return 7}}).a})),p=Gt,v=Bt;p(p.S+p.F*!d,"Object",{defineProperty:v.f});var g=l.Object,m=function(e,t,n){return g.defineProperty(e,t,n)},y={}.hasOwnProperty,x=function(e,t){return y.call(e,t)},_=qt,w=_,b=function(e,t){var n=(l.Object||{})[e]||Object[e],r={};r[e]=t(n),p(p.S+p.F*f((function(){n(1)})),"Object",r)},S=Mt;b("isExtensible",(function(e){return function(t){return!!S(t)&&(!e||e(t))}}));var k=l.Object.isExtensible,P=R,T=P.onFreeze;b("preventExtensions",(function(e){return function(t){return e&&S(t)?e(T(t)):t}}));var D=l.Object.preventExtensions,C=0,E=Math.random(),A=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++C+E).toString(36))},R=s((function(e){var t=A("meta"),n=v.f,r=0,i=k||function(){return!0},a=!f((function(){return i(D({}))})),o=function(e){n(e,t,{value:{i:"O"+ ++r,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,n){if(!S(e))return"symbol"==Lt(e)?e:("string"==typeof e?"S":"P")+e;if(!x(e,t)){if(!i(e))return"F";if(!n)return"E";o(e)}return e[t].i},getWeak:function(e,n){if(!x(e,t)){if(!i(e))return!0;if(!n)return!1;o(e)}return e[t].w},onFreeze:function(e){return a&&s.NEED&&i(e)&&!x(e,t)&&o(e),e}}}));R.KEY,R.NEED,R.fastKey,R.getWeak,R.onFreeze;var I=s((function(e){var t="__core-js_shared__",n=u[t]||(u[t]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:l.version,mode:"pure",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),O=s((function(e){var t=I("wks"),n=u.Symbol,r="function"==typeof n;(e.exports=function(e){return t[e]||(t[e]=r&&n[e]||(r?n:A)("Symbol."+e))}).store=t})),L=v.f,M=O("toStringTag"),N=function(e,t,n){e&&!x(e=n?e:e.prototype,M)&&L(e,M,{configurable:!0,value:t})},F={f:O},B=v.f,q=function(e){var t=l.Symbol||(l.Symbol={});"_"==e.charAt(0)||e in t||B(t,e,{value:F.f(e)})},U=function(e){return Object(o(e))},G=ie;b("keys",(function(){return function(e){return G(U(e))}}));var z,V=l.Object.keys,W={}.toString,j=function(e){return W.call(e).slice(8,-1)},H=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==j(e)?e.split(""):Object(e)},Y=function(e){return H(o(e))},Z=Math.min,X=function(e){return e>0?Z(a(e),9007199254740991):0},K=Math.max,J=Math.min,$=I("keys"),Q=function(e){return $[e]||($[e]=A(e))},ee=(z=!1,function(e,t,n){var r,i=Y(e),o=X(i.length),s=function(e,t){return(e=a(e))<0?K(e+t,0):J(e,t)}(n,o);if(z&&t!=t){for(;o>s;)if((r=i[s++])!=r)return!0}else for(;o>s;s++)if((z||s in i)&&i[s]===t)return z||s||0;return!z&&-1}),te=Q("IE_PROTO"),ne=function(e,t){var n,r=Y(e),i=0,a=[];for(n in r)n!=te&&x(r,n)&&a.push(n);for(;t.length>i;)x(r,n=t[i++])&&(~ee(a,n)||a.push(n));return a},re="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ie=V||function(e){return ne(e,re)},ae={f:l.Object.getOwnPropertySymbols},oe={f:{}.propertyIsEnumerable},se=le;p(p.S,"Array",{isArray:se});var ue=l.Array.isArray,le=ue||function(e){return"Array"==j(e)},ce=function(e,t){if(!S(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!S(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!S(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!S(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},he=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},fe=Ce;p(p.S,"Object",{create:fe});var de=l.Object,pe=function(e,t){return de.create(e,t)},ve=xe;p(p.S+p.F*!d,"Object",{defineProperties:ve});var ge=l.Object,me=function(e,t){return ge.defineProperties(e,t)},ye=Nt,xe=d?me:function(e,t){ye(e);for(var n,r=G(t),i=r.length,a=0;i>a;)v.f(e,n=r[a++],t[n]);return e},_e=u.document,we=S(_e)&&S(_e.createElement),be=function(e){return we?_e.createElement(e):{}},Se=u.document,ke=Se&&Se.documentElement,Pe=Q("IE_PROTO"),Te=function(){},De=function(){var e,t=be("iframe"),n=re.length;for(t.style.display="none",ke.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),De=e.F;n--;)delete De.prototype[re[n]];return De()},Ce=pe||function(e,t){var n;return null!==e?(Te.prototype=ye(e),n=new Te,Te.prototype=null,n[Pe]=e):n=De(),void 0===t?n:ve(n,t)},Ee=Fe;b("getOwnPropertyNames",(function(){return Ee.f}));var Ae=l.Object,Re=function(e){return Ae.getOwnPropertyNames(e)},Ie=re.concat("length","prototype"),Oe={f:Re||function(e){return ne(e,Ie)}},Le=Oe.f,Me={}.toString,Ne="object"==("undefined"==typeof window?"undefined":Lt(window))&&window&&Re?Re(window):[],Fe={f:function(e){return Ne&&"[object Window]"==Me.call(e)?function(e){try{return Le(e)}catch(e){return Ne.slice()}}(e):Le(Y(e))}},Be=We,qe=Be.f;b("getOwnPropertyDescriptor",(function(){return function(e,t){return qe(Y(e),t)}}));var Ue=l.Object,Ge=function(e,t){return Ue.getOwnPropertyDescriptor(e,t)},ze=!d&&!f((function(){return 7!=m(be("div"),"a",{get:function(){return 7}}).a})),Ve=Ge,We={f:d?Ve:function(e,t){if(e=Y(e),t=ce(t,!0),ze)try{return Ve(e,t)}catch(e){}if(x(e,t))return he(!oe.f.call(e,t),e[t])}},je=P.KEY,He=Be.f,Ye=v.f,Ze=Ee.f,Xe=St,Ke=u.JSON,Je=Ke&&Ke.stringify,$e=O("_hidden"),Qe=O("toPrimitive"),et={}.propertyIsEnumerable,tt=I("symbol-registry"),nt=I("symbols"),rt=I("op-symbols"),it=Object.prototype,at="function"==typeof Xe&&!!ae.f,ot=u.QObject,st=!ot||!ot.prototype||!ot.prototype.findChild,ut=d&&f((function(){return 7!=fe(Ye({},"a",{get:function(){return Ye(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=He(it,t);r&&delete it[t],Ye(e,t,n),r&&e!==it&&Ye(it,t,r)}:Ye,lt=function(e){var t=nt[e]=fe(Xe.prototype);return t._k=e,t},ct=at&&"symbol"==Lt(Xe.iterator)?function(e){return"symbol"==Lt(e)}:function(e){return e instanceof Xe},ht=function(e,t,n){return e===it&&ht(rt,t,n),ye(e),t=ce(t,!0),ye(n),x(nt,t)?(n.enumerable?(x(e,$e)&&e[$e][t]&&(e[$e][t]=!1),n=fe(n,{enumerable:he(0,!1)})):(x(e,$e)||Ye(e,$e,he(1,{})),e[$e][t]=!0),ut(e,t,n)):Ye(e,t,n)},ft=function(e,t){ye(e);for(var n,r=function(e){var t=G(e),n=ae.f;if(n)for(var r,i=n(e),a=oe.f,o=0;i.length>o;)a.call(e,r=i[o++])&&t.push(r);return t}(t=Y(t)),i=0,a=r.length;a>i;)ht(e,n=r[i++],t[n]);return e},dt=function(e){var t=et.call(this,e=ce(e,!0));return!(this===it&&x(nt,e)&&!x(rt,e))&&(!(t||!x(this,e)||!x(nt,e)||x(this,$e)&&this[$e][e])||t)},pt=function(e,t){if(e=Y(e),t=ce(t,!0),e!==it||!x(nt,t)||x(rt,t)){var n=He(e,t);return!n||!x(nt,t)||x(e,$e)&&e[$e][t]||(n.enumerable=!0),n}},vt=function(e){for(var t,n=Ze(Y(e)),r=[],i=0;n.length>i;)x(nt,t=n[i++])||t==$e||t==je||r.push(t);return r},gt=function(e){for(var t,n=e===it,r=Ze(n?rt:Y(e)),i=[],a=0;r.length>a;)!x(nt,t=r[a++])||n&&!x(it,t)||i.push(nt[t]);return i};at||(w((Xe=function(){if(this instanceof Xe)throw TypeError("Symbol is not a constructor!");var e=A(arguments.length>0?arguments[0]:void 0),t=function t(n){this===it&&t.call(rt,n),x(this,$e)&&x(this[$e],e)&&(this[$e][e]=!1),ut(this,e,he(1,n))};return d&&st&&ut(it,e,{configurable:!0,set:t}),lt(e)}).prototype,"toString",(function(){return this._k})),Be.f=pt,v.f=ht,Oe.f=Ee.f=vt,oe.f=dt,ae.f=gt,F.f=function(e){return lt(O(e))}),p(p.G+p.W+p.F*!at,{Symbol:Xe});for(var mt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),yt=0;mt.length>yt;)O(mt[yt++]);for(var xt=G(O.store),_t=0;xt.length>_t;)q(xt[_t++]);p(p.S+p.F*!at,"Symbol",{for:function(e){return x(tt,e+="")?tt[e]:tt[e]=Xe(e)},keyFor:function(e){if(!ct(e))throw TypeError(e+" is not a symbol!");for(var t in tt)if(tt[t]===e)return t},useSetter:function(){st=!0},useSimple:function(){st=!1}}),p(p.S+p.F*!at,"Object",{create:function(e,t){return void 0===t?fe(e):ft(fe(e),t)},defineProperty:ht,defineProperties:ft,getOwnPropertyDescriptor:pt,getOwnPropertyNames:vt,getOwnPropertySymbols:gt});var wt,bt=f((function(){ae.f(1)}));p(p.S+p.F*bt,"Object",{getOwnPropertySymbols:function(e){return ae.f(U(e))}}),Ke&&p(p.S+p.F*(!at||f((function(){var e=Xe();return"[null]"!=Je([e])||"{}"!=Je({a:e})||"{}"!=Je(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(S(t)||void 0!==e)&&!ct(e))return se(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!ct(t))return t}),r[1]=t,Je.apply(Ke,r)}}),Xe.prototype[Qe]||_(Xe.prototype,Qe,Xe.prototype.valueOf),N(Xe,"Symbol"),N(Math,"Math",!0),N(u.JSON,"JSON",!0),q("asyncIterator"),q("observable"),(wt=n)&&wt.default;var St=l.Symbol,kt=function(e,t){return{value:t,done:!!e}},Pt={},Tt=Qt;Tt(Array,"Array",(function(e,t){this._t=Y(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,kt(1)):kt(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),Pt.Arguments=Pt.Array;for(var Dt=O("toStringTag"),Ct="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Et=0;Et<Ct.length;Et++){var At=Ct[Et],Rt=u[At],It=Rt&&Rt.prototype;It&&!It[Dt]&&_(It,Dt,At),Pt[At]=Pt.Array}var Ot=F.f("iterator");function Lt(e){return(Lt="function"==typeof St&&"symbol"==typeof Ot?function(e){return typeof e}:function(e){return e&&"function"==typeof St&&e.constructor===St&&e!==St.prototype?"symbol":typeof e})(e)}var Mt=function(e){return"object"===Lt(e)?null!==e:"function"==typeof e},Nt=function(e){if(!S(e))throw TypeError(e+" is not an object!");return e},Ft=m,Bt={f:d?m:function(e,t,n){if(ye(e),t=ce(t,!0),ye(n),ze)try{return Ft(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},qt=d?function(e,t,n){return v.f(e,t,he(1,n))}:function(e,t,n){return e[t]=n,e},Ut=function e(t,n,r){var i,a,o,s=t&e.F,c=t&e.G,f=t&e.S,d=t&e.P,p=t&e.B,v=t&e.W,g=c?l:l[n]||(l[n]={}),m=g.prototype,y=c?u:f?u[n]:(u[n]||{}).prototype;for(i in c&&(r=n),r)(a=!s&&y&&void 0!==y[i])&&x(g,i)||(o=a?y[i]:r[i],g[i]=c&&"function"!=typeof y[i]?r[i]:p&&a?h(o,u):v&&y[i]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(o):d&&"function"==typeof o?h(Function.call,o):o,d&&((g.virtual||(g.virtual={}))[i]=o,t&e.R&&m&&!m[i]&&_(m,i,o)))};Ut.F=1,Ut.G=2,Ut.S=4,Ut.P=8,Ut.B=16,Ut.W=32,Ut.U=64,Ut.R=128;var Gt=Ut,zt={};_(zt,O("iterator"),(function(){return this}));var Vt=function(e,t,n){e.prototype=fe(zt,{next:he(1,n)}),N(e,t+" Iterator")},Wt=Xt;b("getPrototypeOf",(function(){return function(e){return Wt(U(e))}}));var jt,Ht=l.Object.getPrototypeOf,Yt=Q("IE_PROTO"),Zt=Object.prototype,Xt=Ht||function(e){return e=U(e),x(e,Yt)?e[Yt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zt:null},Kt=O("iterator"),Jt=!([].keys&&"next"in[].keys()),$t=function(){return this},Qt=function(e,t,n,r,i,a,o){Vt(n,t,r);var s,u,l,c=function(e){if(!Jt&&e in v)return v[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},h=t+" Iterator",f="values"==i,d=!1,v=e.prototype,g=v[Kt]||v["@@iterator"]||i&&v[i],m=g||c(i),y=i?f?c("entries"):m:void 0,x="Array"==t&&v.entries||g;if(x&&(l=Wt(x.call(new e)))!==Object.prototype&&l.next&&N(l,h,!0),f&&g&&"values"!==g.name&&(d=!0,m=function(){return g.call(this)}),o&&(Jt||d||!v[Kt])&&_(v,Kt,m),Pt[t]=m,Pt[h]=$t,i)if(s={values:f?m:c("values"),keys:a?m:c("keys"),entries:y},o)for(u in s)u in v||w(v,u,s[u]);else p(p.P+p.F*(Jt||d),t,s);return s},en=(jt=!0,function(e,t){var n,r,i=String(o(e)),s=a(t),u=i.length;return s<0||s>=u?jt?"":void 0:(n=i.charCodeAt(s))<55296||n>56319||s+1===u||(r=i.charCodeAt(s+1))<56320||r>57343?jt?i.charAt(s):n:jt?i.slice(s,s+2):r-56320+(n-55296<<10)+65536});Tt(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=en(t,n),this._i+=e.length,{value:e,done:!1})}));var tn=O("toStringTag"),nn="Arguments"==j(function(){return arguments}()),rn=function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),tn))?n:nn?j(t):"Object"==(r=j(t))&&"function"==typeof t.callee?"Arguments":r},an=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e},on=function(e,t,n,r){try{return r?t(ye(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&ye(i.call(e)),t}},sn=O("iterator"),un=Array.prototype,ln=function(e){return void 0!==e&&(Pt.Array===e||un[sn]===e)},cn=O("iterator"),hn=l.getIteratorMethod=function(e){if(null!=e)return e[cn]||e["@@iterator"]||Pt[rn(e)]},fn=s((function(e){var t={},n={},r=e.exports=function(e,r,i,a,o){var s,u,l,c,f=o?function(){return e}:hn(e),d=h(i,a,r?2:1),p=0;if("function"!=typeof f)throw TypeError(e+" is not iterable!");if(ln(f)){for(s=X(e.length);s>p;p++)if((c=r?d(ye(u=e[p])[0],u[1]):d(e[p]))===t||c===n)return c}else for(l=f.call(e);!(u=l.next()).done;)if((c=on(l,d,u.value,r))===t||c===n)return c};r.BREAK=t,r.RETURN=n})),dn=O("species"),pn=function(e,t){var n,r=ye(e).constructor;return void 0===r||null==(n=ye(r)[dn])?t:c(n)},vn=Rn;p(p.G+p.B,{setImmediate:vn.set,clearImmediate:vn.clear});var gn,mn,yn,xn=l.setImmediate,_n=l.clearImmediate,wn=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)},bn=u.process,Sn=xn,kn=_n,Pn=u.MessageChannel,Tn=u.Dispatch,Dn=0,Cn={},En=function(){var e=+this;if(Cn.hasOwnProperty(e)){var t=Cn[e];delete Cn[e],t()}},An=function(e){En.call(e.data)};Sn&&kn||(Sn=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Cn[++Dn]=function(){wn("function"==typeof e?e:Function(e),t)},gn(Dn),Dn},kn=function(e){delete Cn[e]},"process"==j(bn)?gn=function(e){bn.nextTick(h(En,e,1))}:Tn&&Tn.now?gn=function(e){Tn.now(h(En,e,1))}:Pn?(yn=(mn=new Pn).port2,mn.port1.onmessage=An,gn=h(yn.postMessage,yn,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(gn=function(e){u.postMessage(e+"","*")},u.addEventListener("message",An,!1)):gn="onreadystatechange"in be("script")?function(e){ke.appendChild(be("script")).onreadystatechange=function(){ke.removeChild(this),En.call(e)}}:function(e){setTimeout(h(En,e,1),0)});var Rn={set:Sn,clear:kn},In=vn.set,On=u.MutationObserver||u.WebKitMutationObserver,Ln=u.process,Mn=wr,Nn="process"==j(Ln);function Fn(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=c(t),this.reject=c(n)}var Bn={f:function(e){return new Fn(e)}},qn=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}},Un=u.navigator,Gn=Un&&Un.userAgent||"",zn=function(e,t){if(ye(e),S(t)&&t.constructor===e)return t;var n=Bn.f(e);return(0,n.resolve)(t),n.promise},Vn=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:_(e,r,t[r]);return e},Wn=O("species"),jn=function(e){var t="function"==typeof l[e]?l[e]:u[e];d&&t&&!t[Wn]&&v.f(t,Wn,{configurable:!0,get:function(){return this}})},Hn=function(e,t,n){t in e?v.f(e,t,he(0,n)):e[t]=n},Yn=nr;p(p.S+p.F*!Yn((function(e){Zn(e)})),"Array",{from:function(e){var t,n,r,i,a=U(e),o="function"==typeof this?this:Array,s=arguments.length,u=s>1?arguments[1]:void 0,l=void 0!==u,c=0,f=hn(a);if(l&&(u=h(u,s>2?arguments[2]:void 0,2)),null==f||o==Array&&ln(f))for(n=new o(t=X(a.length));t>c;c++)Hn(n,c,l?u(a[c],c):a[c]);else for(i=f.call(a),n=new o;!(r=i.next()).done;c++)Hn(n,c,l?on(i,u,[r.value,c],!0):r.value);return n.length=c,n}});var Zn=l.Array.from,Xn=O("iterator"),Kn=!1;try{var Jn=[7][Xn]();Jn.return=function(){Kn=!0},Zn(Jn,(function(){throw 2}))}catch(e){}var $n,Qn,er,tr,nr=function(e,t){if(!t&&!Kn)return!1;var n=!1;try{var r=[7],i=r[Xn]();i.next=function(){return{done:n=!0}},r[Xn]=function(){return i},e(r)}catch(e){}return n},rr=vn.set,ir=function(){var e,t,n,r=function(){var r,i;for(Nn&&(r=Ln.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(Nn)n=function(){Ln.nextTick(r)};else if(!On||u.navigator&&u.navigator.standalone)if(Mn&&Mn.resolve){var i=Mn.resolve(void 0);n=function(){i.then(r)}}else n=function(){In.call(u,r)};else{var a=!0,o=document.createTextNode("");new On(r).observe(o,{characterData:!0}),n=function(){o.data=a=!a}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}(),ar=u.TypeError,or=u.process,sr=or&&or.versions,ur=sr&&sr.v8||"",lr=wr,cr="process"==rn(or),hr=function(){},fr=Qn=Bn.f,dr=!!function(){try{var e=lr.resolve(1),t=(e.constructor={})[O("species")]=function(e){e(hr,hr)};return(cr||"function"==typeof PromiseRejectionEvent)&&e.then(hr)instanceof t&&0!==ur.indexOf("6.6")&&-1===Gn.indexOf("Chrome/66")}catch(e){}}(),pr=function(e){var t;return!(!S(e)||"function"!=typeof(t=e.then))&&t},vr=function(e,t){if(!e._n){e._n=!0;var n=e._c;ir((function(){for(var r=e._v,i=1==e._s,a=0,o=function(t){var n,a,o,s=i?t.ok:t.fail,u=t.resolve,l=t.reject,c=t.domain;try{s?(i||(2==e._h&&yr(e),e._h=1),!0===s?n=r:(c&&c.enter(),n=s(r),c&&(c.exit(),o=!0)),n===t.promise?l(ar("Promise-chain cycle")):(a=pr(n))?a.call(n,u,l):u(n)):l(r)}catch(e){c&&!o&&c.exit(),l(e)}};n.length>a;)o(n[a++]);e._c=[],e._n=!1,t&&!e._h&&gr(e)}))}},gr=function(e){rr.call(u,(function(){var t,n,r,i=e._v,a=mr(e);if(a&&(t=qn((function(){cr?or.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=cr||mr(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},mr=function(e){return 1!==e._h&&0===(e._a||e._c).length},yr=function(e){rr.call(u,(function(){var t;cr?or.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},xr=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),vr(t,!0))},_r=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw ar("Promise can't be resolved itself");(n=pr(t))?ir((function(){var i={_w:r,_d:!1};try{n.call(t,h(e,i,1),h(xr,i,1))}catch(e){xr.call(i,e)}})):(r._v=t,r._s=1,vr(r,!1))}catch(e){xr.call({_w:r,_d:!1},e)}}};dr||(lr=function(e){an(this,lr,"Promise","_h"),c(e),$n.call(this);try{e(h(_r,this,1),h(xr,this,1))}catch(e){xr.call(this,e)}},($n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=Vn(lr.prototype,{then:function(e,t){var n=fr(pn(this,lr));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=cr?or.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&vr(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),er=function(){var e=new $n;this.promise=e,this.resolve=h(_r,e,1),this.reject=h(xr,e,1)},Bn.f=fr=function(e){return e===lr||e===tr?new er(e):Qn(e)}),p(p.G+p.W+p.F*!dr,{Promise:lr}),N(lr,"Promise"),jn("Promise"),tr=l.Promise,p(p.S+p.F*!dr,"Promise",{reject:function(e){var t=fr(this);return(0,t.reject)(e),t.promise}}),p(p.S+true*p.F,"Promise",{resolve:function(e){return zn(this===tr?lr:this,e)}}),p(p.S+p.F*!(dr&&Yn((function(e){lr.all(e).catch(hr)}))),"Promise",{all:function(e){var t=this,n=fr(t),r=n.resolve,i=n.reject,a=qn((function(){var n=[],a=0,o=1;fn(e,!1,(function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then((function(e){u||(u=!0,n[s]=e,--o||r(n))}),i)})),--o||r(n)}));return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=fr(t),r=n.reject,i=qn((function(){fn(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}}),p(p.P+p.R,"Promise",{finally:function(e){var t=pn(this,l.Promise||wr),n="function"==typeof e;return this.then(n?function(n){return zn(t,e()).then((function(){return n}))}:e,n?function(n){return zn(t,e()).then((function(){throw n}))}:e)}}),p(p.S,"Promise",{try:function(e){var t=Bn.f(this),n=qn(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}});var wr=l.Promise;function br(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):wr.resolve(u).then(r,i)}function Sr(e){return function(){var t=this,n=arguments;return new wr((function(r,i){var a=e.apply(t,n);function o(e){br(a,r,i,o,s,"next",e)}function s(e){br(a,r,i,o,s,"throw",e)}o(void 0)}))}}function kr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),m(e,r.key,r)}}function Tr(e,t,n){return t&&Pr(e.prototype,t),n&&Pr(e,n),e}var Dr=function(e,t){if(ye(e),!S(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Cr={set:Er||("__proto__"in{}?function(e,t,n){try{(n=h(Function.call,Be.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,r){return Dr(e,r),t?e.__proto__=r:n(e,r),e}}({},!1):void 0),check:Dr};p(p.S,"Object",{setPrototypeOf:Cr.set});var Er=l.Object.setPrototypeOf,Ar=s((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof St?St:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return m(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,a=pe(i.prototype),o=new C(r||[]);return a._invoke=function(e,t,n){var r=h;return function(i,a){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return A()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=P(o,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var u=c(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function g(){}function y(){}function x(){}var _={};u(_,a,(function(){return this}));var w=Ht&&Ht(Ht(E([])));w&&w!==n&&r.call(w,a)&&(_=w);var b=x.prototype=g.prototype=pe(_);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,a,o,s){var u=c(e[i],e,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"===Lt(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function P(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function E(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:A}}function A(){return{value:t,done:!0}}return y.prototype=x,u(b,"constructor",x),u(x,"constructor",y),y.displayName=u(x,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Er?Er(e,x):(e.__proto__=x,u(e,s,"GeneratorFunction")),e.prototype=pe(b),e},e.awrap=function(e){return{__await:e}},S(k.prototype),u(k.prototype,o,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,i,a){void 0===a&&(a=wr);var o=new k(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(b),u(b,s,"Generator"),u(b,a,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":Lt(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})),Rr=function(e,t){if(!S(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},Ir=v.f,Or=P.fastKey,Lr=d?"_s":"size",Mr=function(e,t){var n,r=Or(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n},Nr={getConstructor:function(e,t,n,r){var i=e((function(e,a){an(e,i,t,"_i"),e._t=t,e._i=fe(null),e._f=void 0,e._l=void 0,e[Lr]=0,null!=a&&fn(a,n,e[r],e)}));return Vn(i.prototype,{clear:function(){for(var e=Rr(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[Lr]=0},delete:function(e){var n=Rr(this,t),r=Mr(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[Lr]--}return!!r},forEach:function(e){Rr(this,t);for(var n,r=h(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!Mr(Rr(this,t),e)}}),d&&Ir(i.prototype,"size",{get:function(){return Rr(this,t)[Lr]}}),i},def:function(e,t,n){var r,i,a=Mr(e,t);return a?a.v=n:(e._l=a={i:i=Or(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[Lr]++,"F"!==i&&(e._i[i]=a)),e},getEntry:Mr,setStrong:function(e,t,n){Tt(e,t,(function(e,n){this._t=Rr(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?kt(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(e._t=void 0,kt(1))}),n?"entries":"values",!n,!0),jn(t)}},Fr=O("species"),Br=function(e,t){return new(function(e){var t;return se(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!se(t.prototype)||(t=void 0),S(t)&&null===(t=t[Fr])&&(t=void 0)),void 0===t?Array:t}(e))(t)},qr=v.f,Ur=function(e,t){var n=1==e,r=2==e,i=3==e,a=4==e,o=6==e,s=5==e||o,u=t||Br;return function(t,l,c){for(var f,d,p=U(t),v=H(p),g=h(l,c,3),m=X(v.length),y=0,x=n?u(t,m):r?u(t,0):void 0;m>y;y++)if((s||y in v)&&(d=g(f=v[y],y,p),e))if(n)x[y]=d;else if(d)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:x.push(f)}else if(a)return!1;return o?-1:i||a?a:x}}(0),Gr=function(e,t,n,r,i,a){var o=u[e],s=o,l=i?"set":"add",c=s&&s.prototype,h={};return d&&"function"==typeof s&&(a||c.forEach&&!f((function(){(new s).entries().next()})))?(s=t((function(t,n){an(t,s,e,"_c"),t._c=new o,null!=n&&fn(n,i,t[l],t)})),Ur("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in c)||a&&"clear"==e||_(s.prototype,e,(function(n,r){if(an(this,s,e),!t&&a&&!S(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i}))})),a||qr(s.prototype,"size",{get:function(){return this._c.size}})):(s=r.getConstructor(t,e,i,l),Vn(s.prototype,n),P.NEED=!0),N(s,e),h[e]=s,p(p.G+p.W+p.F,h),a||r.setStrong(s,e,i),s};Gr("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=Nr.getEntry(Rr(this,"Map"),e);return t&&t.v},set:function(e,t){return Nr.def(Rr(this,"Map"),0===e?0:e,t)}},Nr,!0);var zr=function(e){return function(){if(rn(this)!=e)throw TypeError(e+"#toJSON isn't generic");return function(e,t){var n=[];return fn(e,!1,n.push,n,t),n}(this)}};p(p.P+p.R,"Map",{toJSON:zr("Map")});var Vr=function(e){p(p.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})};Vr("Map");var Wr=function(e){p(p.S,e,{from:function(e){var t,n,r,i,a=arguments[1];return c(this),(t=void 0!==a)&&c(a),null==e?new this:(n=[],t?(r=0,i=h(a,arguments[2],2),fn(e,!1,(function(e){n.push(i(e,r++))}))):fn(e,!1,n.push,n),new this(n))}})};Wr("Map");var jr=l.Map,Hr=function(){function e(){kr(this,e),this.cache={}}return Tr(e,[{key:"cacheItem",value:function(e,t){var n,r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"axis",o=null!==(n=null===(r=this.cache)||void 0===r?void 0:r[e])&&void 0!==n?n:{},s=null!==(i=null==o?void 0:o[a])&&void 0!==i?i:new jr,u=t.key,l=t.value;s.set(u,l),this.cache[e]=o,this.cache[e][a]=s}},{key:"getItem",value:function(e,t,n){var r,i,a;return null===(r=this.cache)||void 0===r||null===(i=r[e])||void 0===i||null===(a=i[n])||void 0===a?void 0:a.get(t)}},{key:"getItems",value:function(e,t){var n,r,i,a,o,s;if(0===(null!==(n=null===(r=this.cache)||void 0===r||null===(i=r[e])||void 0===i||null===(a=i[t])||void 0===a?void 0:a.size)&&void 0!==n?n:0))return[];var u=null===(o=this.cache)||void 0===o||null===(s=o[e])||void 0===s?void 0:s[t];return Zn(u).sort((function(e,t){return e[0]-t[0]})).map((function(e){return e[1]}))}},{key:"purge",value:function(e,t){var n;e?t?delete this.cache[e][t]:null===(n=this.cache)||void 0===n||delete n[e]:this.cache={}}}]),e}(),Yr=0;function Zr(e,t){var n=t.data;if(ue(n)&&!(n.length<2)){var r=n[0],i=n[1],a=n[2],o=e._callbacks[r];o&&(delete e._callbacks[r],o(i,a))}}function Xr(e){var t=this;t._worker=e,t._callbacks={},e.addEventListener("message",(function(e){Zr(t,e)}))}Xr.prototype.postMessage=function(e){var t=this,n=Yr++,r=[n,e];return new wr((function(e,i){if(t._callbacks[n]=function(t,n){if(t)return i(new Error(t.message));e(n)},void 0!==t._worker.controller){var a=new MessageChannel;a.port1.onmessage=function(e){Zr(t,e)},t._worker.controller.postMessage(r,[a.port2])}else t._worker.postMessage(r)}))};var Kr=Xr,Jr=document.createElement("canvas"),$r=function(){var e=Sr(Ar.mark((function e(t,n){return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new wr((function(e,r){var i=t;if("webimage"===n.format){i={};var a=new Image,o=new Uint8Array(t.data),s=new Blob([o],{type:"image/jpeg"}),u=(window.URL||window.webkitURL).createObjectURL(s);a.src=u,a.onload=function(t){i.columns=a.width,i.rows=a.height,i.color="rgba",i.samplesPerPixel=4,i.windowWidth=255,i.windowCenter=128,i.maxPixelValue=255,i.minPixelValue=0,i.intercept=0,i.slope=1,Jr.width=a.width,Jr.height=a.height;var n=Jr.getContext("2d");n.drawImage(a,0,0),i.pixelData=n.getImageData(0,0,a.width,a.height).data,e(i)}}else e(i)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();p(p.S,"Number",{MAX_SAFE_INTEGER:9007199254740991});p(p.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});var Qr="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",ei="["+Qr+"]",ti=RegExp("^"+ei+ei+"*"),ni=RegExp(ei+ei+"*$"),ri=function(e,t,n){var r={},i=f((function(){return!!Qr[e]()||"​"!="​"[e]()})),a=r[e]=i?t(ii):Qr[e];n&&(r[n]=a),p(p.P+p.F*i,"String",r)},ii=ri.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(ti,"")),2&t&&(e=e.replace(ni,"")),e},ai=ri,oi=u.parseInt,si=ai.trim,ui=/^[-+]?0[xX]/,li=8!==oi(Qr+"08")||22!==oi(Qr+"0x16")?function(e,t){var n=si(String(e),3);return oi(n,t>>>0||(ui.test(n)?16:10))}:oi;p(p.G+p.F*(ci!=li),{parseInt:li});var ci=l.parseInt,hi=F.f("species"),fi=u.parseFloat,di=ai.trim,pi=1/fi(Qr+"-0")!=-1/0?function(e){var t=di(String(e),3),n=fi(t);return 0===n&&"-"==t.charAt(0)?-0:n}:fi;p(p.G+p.F*(vi!=pi),{parseFloat:pi});var vi=l.parseFloat,gi=O("hasInstance"),mi=Function.prototype;gi in mi||v.f(mi,gi,{value:function(e){if("function"!=typeof this||!S(e))return!1;if(!S(this.prototype))return e instanceof this;for(;e=Wt(e);)if(this.prototype===e)return!0;return!1}});var yi=F.f("hasInstance"),xi=l.JSON||(l.JSON={stringify:_i}),_i=function(e){return xi.stringify.apply(xi,arguments)},wi=P.onFreeze;b("freeze",(function(e){return function(t){return e&&S(t)?e(wi(t)):t}}));var bi,Si=l.Object.freeze,ki=s((function(e,t){
/*! dicom-parser - 1.8.5 - 2021-08-16 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */
e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||m(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){m(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=78)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":Lt(window))&&(n=window)}e.exports=n},function(e,t,n){(function(e){
/*!
         * The buffer module from node.js, for the browser.
         *
         * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
         * @license  MIT
         */
var r=n(72),i=n(71),a=n(39);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return l(this,e,t,n)}function l(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|d(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&a(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(c(t),e=s(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|d(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return G(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var c=-1;for(a=n;a<s;a++)if(l(e,a)===l(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===u)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,f=0;f<u;f++)if(l(e,a+f)!==l(t,f)){h=!1;break}if(h)return a}return-1}function x(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=ci(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function _(e,t,n,r){return V(G(t,e.length-n),e,n,r)}function w(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return V(z(t),e,n,r)}function k(e,t,n,r){return V(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,l=e[i],c=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&l)<<6|63&a)>127&&(c=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&l)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=h}return function(e){var t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=D));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return l(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,void 0!==St&&hi&&u[hi]===u&&m(u,hi,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),l=this.slice(r,i),c=e.slice(t,n),h=0;h<s;++h)if(l[h]!==c[h]){a=l[h],o=c[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var D=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=U(e[a]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,a){return a||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function B(e,t,n,r,a){return a||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:G(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){var r=n(10),i=V||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var a=n(6);a.inherits=n(5);var o=n(36),s=n(19);a.inherits(h,o);for(var u=i(s.prototype),l=0;l<u.length;l++){var c=u[l];h.prototype[c]||(h.prototype[c]=s.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}m(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,l=[],c=!1,h=-1;function f(){c&&u&&(c=!1,u.length?l=u.concat(l):h=-1,l.length&&d())}function d(){if(!c){var e=s(f);c=!0;for(var t=l.length;t;){for(u=l,l=[];++h<t;)u&&u[h].run();h=-1,t=l.length}u=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)}},function(e,t){e.exports="function"==typeof pe?function(e,t){e.super_=t,e.prototype=pe(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return ue?ue(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==Lt(e)},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==Lt(e)&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==Lt(e)||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(1).Buffer)},function(e,t,n){m(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),m(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14);function a(e,t){return void 0!==e.parser?e.parser:t}var o=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.byteArrayParser=t,this.byteArray=n,this.elements=r}return r(e,[{key:"uint16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint16(this.byteArray,n.dataOffset+2*t)}},{key:"int16",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt16(this.byteArray,n.dataOffset+2*t)}},{key:"uint32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readUint32(this.byteArray,n.dataOffset+4*t)}},{key:"int32",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readInt32(this.byteArray,n.dataOffset+4*t)}},{key:"float",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readFloat(this.byteArray,n.dataOffset+4*t)}},{key:"double",value:function(e,t){var n=this.elements[e];if(t=void 0!==t?t:0,n&&0!==n.length)return a(n,this.byteArrayParser).readDouble(this.byteArray,n.dataOffset+8*t)}},{key:"numStringValues",value:function(e){var t=this.elements[e];if(t&&t.length>0){var n=(0,i.readFixedString)(this.byteArray,t.dataOffset,t.length).match(/\\/g);return null===n?1:n.length+1}}},{key:"string",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].trim():r.trim()}}},{key:"text",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){var r=(0,i.readFixedString)(this.byteArray,n.dataOffset,n.length);return t>=0?r.split("\\")[t].replace(/ +$/,""):r.replace(/ +$/,"")}}},{key:"floatString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return vi(r)}}},{key:"intString",value:function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return ci(r)}}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var n=a(t,this.byteArrayParser).readUint16,r=this.byteArray,i=t.dataOffset;return"x"+("00000000"+(256*n(r,i)*256+n(r,i+2)).toString(16)).substr(-8)}}}]),e}();t.default=o},function(e,t,n){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=Lt(n))throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(e[r]=n[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(r)},function(e,t,n){var r=n(1),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(a=new Array(s-1),o=0;o<a.length;)a[o++]=arguments[o];return t.nextTick((function(){e.apply(null,a)}))}}}:e.exports=t}).call(this,n(3))},function(e,t,n){(function(e){m(t,"__esModule",{value:!0}),t.default=function(t,n,r){if(void 0!==e&&t instanceof e)return t.slice(n,n+r);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+n,r);throw"dicomParser.from: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){(function(e){m(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),m(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=(r=n(11))&&r.__esModule?r:{default:r},o=n(14),s=function(){function t(n,r,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===r)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(r instanceof Uint8Array==0&&r instanceof e==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=r.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=n,this.byteArray=r,this.position=i||0,this.warnings=[]}return i(t,[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var n=(0,a.default)(this.byteArray,this.position,e);return this.position+=e,new t(this.byteArrayParser,n)}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=(0,o.readFixedString)(this.byteArray,this.position,e);return this.position+=e,t}}]),t}();t.default=s}).call(this,n(1).Buffer)},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:(0,i.default)(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return t};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){m(t,"__esModule",{value:!0}),t.readFixedString=function(e,t,n){if(n<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r,i="",a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,i;i+=String.fromCharCode(r)}return i}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var u={tag:(0,a.default)(e),vr:e.readFixedString(2)};return 2===l(u.vr)?(u.length=e.readUint16(),u.dataOffset=e.position):(e.seek(2),u.length=e.readUint32(),u.dataOffset=e.position),4294967295===u.length&&(u.hadUndefinedLength=!0),u.tag===n?u:"SQ"===u.vr?((0,s.default)(e,u,t),u):4294967295===u.length?"x7fe00010"===u.tag?((0,r.default)(e,u,t),u):"UN"===u.vr?((0,i.default)(e,u),u):((0,o.default)(e,u),u):(e.seek(u.length),u)};var r=u(n(42)),i=(u(n(41)),u(n(26))),a=u(n(4)),o=u(n(24)),s=u(n(40));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}},function(e,t,n){m(t,"__esModule",{value:!0}),t.parseDicomDataSetExplicit=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?t.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var a=e.elements;t.position<n;){var o=(0,r.default)(t,e.warnings,i.untilTag);if(a[o.tag]=o,o.tag===i.untilTag)return}if(t.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n=void 0===n?e.byteArray.length:n,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<t.position||n>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;t.position<n;){var o=(0,i.default)(t,r.untilTag,r.vrCallback);if(a[o.tag]=o,o.tag===r.untilTag)return}};var r=a(n(15)),i=a(n(25));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){m(t,"__esModule",{value:!0});var r={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};t.isStringVr=function(e){return r[e]},t.isPrivateTag=function(e){return ci(e[4],10)%2==1},t.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,l){if(s=s||1,l=l||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(s<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+s>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new i.default(e.byteArrayParser,e.byteArray,t.dataOffset),h=(0,a.default)(c);if("xfffee000"!==h.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(h.length);var f=c.position;if(1===s)return(0,o.default)(c.byteArray,f+l[n].offset+8,l[n].length);for(var d=u(l,n,s),p=(0,r.default)(c.byteArray,d),v=0,g=n;g<n+s;g++)for(var m=f+l[g].offset+8,y=0;y<l[g].length;y++)p[v++]=c.byteArray[m++];return p};var r=s(n(23)),i=s(n(12)),a=s(n(13)),o=s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n){for(var r=0,i=t;i<t+n;i++)r+=e[i].length;return r}},function(e,t,n){(function(t,r,i){var a=n(10);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=x;var s,u=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:a.nextTick;x.WritableState=y;var l=n(6);l.inherits=n(5);var c,h={deprecate:n(61)},f=n(35),d=n(9).Buffer,p=i.Uint8Array||function(){},v=n(34);function g(){}function y(e,t){s=s||n(2),e=e||{};var r=t instanceof s;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,l=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(l||0===l)?l:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(a.nextTick(i,r),a.nextTick(P,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),P(e,t))}(e,n,r,t,i);else{var o=S(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||b(e,n),r?u(w,e,n,o,i):w(e,n,o,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function x(e){if(s=s||n(2),!(c.call(x,this)||this instanceof s))return new x(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),f.call(this)}function _(e,t,n,r,i,a,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),P(e,t)}function b(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0,u=!0;n;)i[s]=n,n.isBuf||(u=!1),n=n.next,s+=1;i.allBuffers=u,_(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,c=n.encoding,h=n.callback;if(_(e,t,!1,t.objectMode?1:l.length,l,c,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function k(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),P(e,t)}))}function P(e,t){var n=S(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,a.nextTick(k,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}l.inherits(x,f),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{m(y.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof St&&yi&&"function"==typeof Function.prototype[yi]?(c=Function.prototype[yi],m(x,yi,{value:function(e){return!!c.call(this,e)||this===x&&e&&e._writableState instanceof y}})):c=function(e){return e instanceof this},x.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},x.prototype.write=function(e,t,n){var r,i=this._writableState,o=!1,s=!i.objectMode&&(r=e,d.isBuffer(r)||r instanceof p);return s&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=g),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),a.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),a.nextTick(r,o),i=!1),i}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,a){if(!n){var o=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,n)),t}(t,r,i);r!==o&&(n=!0,i="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:a,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else _(e,t,!1,s,r,i,a);return u}(this,i,s,e,t,n)),o},x.prototype.cork=function(){this._writableState.corked++},x.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||b(this,e))},x.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},x.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},x.prototype._writev=null,x.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,P(e,t),n&&(t.finished?a.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},m(x.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),x.prototype.destroy=v.destroy,x.prototype._undestroy=v.undestroy,x.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(3),n(63).setImmediate,n(0))},function(e,t,n){(t=e.exports=n(36)).Stream=t,t.Readable=t,t.Writable=n(19),t.Duplex=n(2),t.Transform=n(32),t.PassThrough=n(60)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==Lt(e)&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(a(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),o=(l=n.slice()).length,u=0;u<o;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,a,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=s;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t,n){(function(e){m(t,"__esModule",{value:!0}),t.default=function(t,n){if(void 0!==e&&t instanceof e)return e.alloc(n);if(t instanceof Uint8Array)return new Uint8Array(n);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,n(1).Buffer)},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var s={tag:(0,a.default)(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===t?s:u(s,e,n)&&!(0,o.isPrivateTag)(s.tag)?((0,i.default)(e,s),s):s.hadUndefinedLength?((0,r.default)(e,s),s):(e.seek(s.length),s)};var r=s(n(24)),i=s(n(26)),a=s(n(4)),o=n(17);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e,t,n){if(void 0!==n)return"SQ"===n(e.tag);if(t.position+4<=t.byteArray.length){var r=(0,a.default)(t);return t.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return t.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=l(e,n);t.items.push(i)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=l(e,n);t.items.push(i)}}(e,t,n)};var r=u(n(7)),i=u(n(25)),a=u(n(13)),o=u(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,void 0,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetImplicit(n.dataSet,e,e.position+n.length,{vrCallback:t})),n}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,s){if(r=r||t.basicOffsetTable,s=s||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var u=r[n],l=a(s,u);if(void 0===l)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var c=o(n,r,s,l);return(0,i.default)(e,t,l,c,s)};var r,i=(r=n(18))&&r.__esModule?r:{default:r},a=function(e,t){for(var n=0;n<e.length;n++)if(e[n].offset===t)return n},o=function(e,t,n,r){if(e===t.length-1)return n.length-r;for(var i=t[e+1],a=r+1;a<n.length;a++)if(n[a].offset===i)return a-r;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(e,t,n){var r=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();e.exports=function(e,t,n,i){var a=r,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,n){e.exports=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,n){(function(e,r){var i=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return _i(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<a;u=r[++n])v(u)||!_(u)?o+=" "+u:o+=" "+s(u);return o},t.deprecate=function(n,i){if(y(e.process))return function(){return t.deprecate(n,i).apply(this,arguments)};if(!0===r.noDeprecation)return n;var a=!1;return function(){if(!a){if(r.throwDeprecation)throw new Error(i);r.traceDeprecation?console.trace(i):console.error(i),a=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),c(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function l(e,t){return e}function c(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return m(i)||(i=c(e,i,r)),i}var a=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(m(t)){var n="'"+_i(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):p(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}(e,n);if(a)return a;var o=V(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Re(n)),b(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(S(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(x(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(b(n))return h(n)}var l,_="",k=!1,P=["{","}"];return d(n)&&(k=!0,P=["[","]"]),S(n)&&(_=" [Function"+(n.name?": "+n.name:"")+"]"),x(n)&&(_=" "+RegExp.prototype.toString.call(n)),w(n)&&(_=" "+Date.prototype.toUTCString.call(n)),b(n)&&(_=" "+h(n)),0!==o.length||k&&0!=n.length?r<0?x(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),l=k?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)D(t,String(o))?a.push(f(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(f(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return f(e,n,r,s,t,k)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,_,P)):P[0]+_+P[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,a){var o,s,u;if((u=Ge(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),D(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=v(n)?c(e,u.value,null):c(e,u.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(o)){if(a&&i.match(/^\d+$/))return s;(o=_i(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function d(e){return ue(e)}function p(e){return"boolean"==typeof e}function v(e){return null===e}function g(e){return"number"==typeof e}function m(e){return"string"==typeof e}function y(e){return void 0===e}function x(e){return _(e)&&"[object RegExp]"===k(e)}function _(e){return"object"==Lt(e)&&null!==e}function w(e){return _(e)&&"[object Date]"===k(e)}function b(e){return _(e)&&("[object Error]"===k(e)||e instanceof Error)}function S(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(y(a)&&(a=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=v,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=m,t.isSymbol=function(e){return"symbol"==Lt(e)},t.isUndefined=y,t.isRegExp=x,t.isObject=_,t.isDate=w,t.isError=b,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==Lt(e)||void 0===e},t.isBuffer=n(54);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(n=[P((e=new Date).getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(53),t._extend=function(e,t){if(!t||!_(t))return e;for(var n=V(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,n(0),n(3))},function(e,t,n){(function(t){
/*!
         * The buffer module from node.js, for the browser.
         *
         * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
         * @license  MIT
         */
function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var a=n(30),o=Object.prototype.hasOwnProperty,s=Array.prototype.slice,u="foo"===function(){}.name;function l(e){return Object.prototype.toString.call(e)}function c(e){return!i(e)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var h=e.exports=m,f=/\s*function\s+([^\(\s]*)\s*/;function d(e){if(a.isFunction(e)){if(u)return e.name;var t=e.toString().match(f);return t&&t[1]}}function p(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function v(e){if(u||!a.isFunction(e))return a.inspect(e);var t=d(e);return"[Function"+(t?": "+t:"")+"]"}function g(e,t,n,r,i){throw new h.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function m(e,t){e||g(e,!0,t,"==",h.ok)}function y(e,t,n,o){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(a.isDate(e)&&a.isDate(t))return e.getTime()===t.getTime();if(a.isRegExp(e)&&a.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==Lt(e)||null!==t&&"object"==Lt(t)){if(c(e)&&c(t)&&l(e)===l(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var u=(o=o||{actual:[],expected:[]}).actual.indexOf(e);return-1!==u&&u===o.expected.indexOf(t)||(o.actual.push(e),o.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(a.isPrimitive(e)||a.isPrimitive(t))return e===t;if(n&&Ht(e)!==Ht(t))return!1;var i=x(e),o=x(t);if(i&&!o||!i&&o)return!1;if(i)return y(e=s.call(e),t=s.call(t),n);var u,l,c=b(e),h=b(t);if(c.length!==h.length)return!1;for(c.sort(),h.sort(),l=c.length-1;l>=0;l--)if(c[l]!==h[l])return!1;for(l=c.length-1;l>=0;l--)if(!y(e[u=c[l]],t[u],n,r))return!1;return!0}(e,t,n,o))}return n?e===t:e==t}function x(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function _(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function w(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&g(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!e&&i&&!n;if((!e&&a.isError(i)&&o&&_(i,n)||s)&&g(i,n,"Got unwanted exception"+r),e&&i&&n&&!_(i,n)||!e&&i)throw i}h.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=p(v((t=this).actual),128)+" "+t.operator+" "+p(v(t.expected),128),this.generatedMessage=!0);var n=e.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,n);else{var r=new Error;if(r.stack){var i=r.stack,a=d(n),o=i.indexOf("\n"+a);if(o>=0){var s=i.indexOf("\n",o+1);i=i.substring(s+1)}this.stack=i}}},a.inherits(h.AssertionError,Error),h.fail=g,h.ok=m,h.equal=function(e,t,n){e!=t&&g(e,t,n,"==",h.equal)},h.notEqual=function(e,t,n){e==t&&g(e,t,n,"!=",h.notEqual)},h.deepEqual=function(e,t,n){y(e,t,!1)||g(e,t,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function(e,t,n){y(e,t,!0)||g(e,t,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function(e,t,n){y(e,t,!1)&&g(e,t,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=function e(t,n,r){y(t,n,!0)&&g(t,n,r,"notDeepStrictEqual",e)},h.strictEqual=function(e,t,n){e!==t&&g(e,t,n,"===",h.strictEqual)},h.notStrictEqual=function(e,t,n){e===t&&g(e,t,n,"!==",h.notStrictEqual)},h.throws=function(e,t,n){w(!0,e,t,n)},h.doesNotThrow=function(e,t,n){w(!1,e,t,n)},h.ifError=function(e){if(e)throw e};var b=V||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}}).call(this,n(0))},function(e,t,n){e.exports=a;var r=n(2),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){s(e,t,n)})):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(5),i.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){var r=n(9).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=u,this.end=l,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=h,t=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.StringDecoder=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=o(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n?0:(i=o(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){var r=n(10);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,a=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return a||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){e.exports=n(21).EventEmitter},function(e,t,n){(function(t,r){var i=n(10);e.exports=_;var a,o=n(39);_.ReadableState=x,n(21).EventEmitter;var s=function(e,t){return e.listeners(t).length},u=n(35),l=n(9).Buffer,c=t.Uint8Array||function(){},h=n(6);h.inherits=n(5);var f=n(66),d=void 0;d=f&&f.debuglog?f.debuglog("stream"):function(){};var p,v=n(65),g=n(34);h.inherits(_,u);var y=["error","close","destroy","pause","resume"];function x(e,t){e=e||{};var r=t instanceof(a=a||n(2));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new v,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(33).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function _(e){if(a=a||n(2),!(this instanceof _))return new _(e);this._readableState=new x(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),u.call(this)}function w(e,t,n,r,i){var a,o=e._readableState;return null===t?(o.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,P(e)}}(e,o)):(i||(a=function(e,t){var n,r;return r=t,l.isBuffer(r)||r instanceof c||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,t)),a?e.emit("error",a):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Ht(t)===l.prototype||(t=function(e){return l.from(e)}(t)),r?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):b(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?b(e,o,t,!1):D(e,o)):b(e,o,t,!1))):r||(o.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function b(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&P(e)),D(e,t)}m(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=g.destroy,_.prototype._undestroy=g.undestroy,_.prototype._destroy=function(e,t){this.push(null),t(e)},_.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=l.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},_.prototype.unshift=function(e){return w(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){return p||(p=n(33).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var S=8388608;function k(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=S?e=S:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(T,e):T(e))}function T(e){d("emit readable"),e.emit("readable"),R(e)}function D(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function E(e){d("readable nexttick read 0"),e.read(0)}function A(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function I(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var a=n.data,o=e>a.length?a.length:e;if(o===a.length?i+=a:i+=a.slice(0,e),0==(e-=o)){o===a.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=a.slice(o));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=l.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(a.copy(n,n.length-e,0,o),0==(e-=o)){o===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function O(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(L,t,e))}function L(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){d("read",e),e=ci(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?O(this):P(this),null;if(0===(e=k(e,t))&&t.ended)return 0===t.length&&O(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=k(n,t))),null===(r=e>0?I(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&O(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(e,t){var n=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,d("pipe count=%d opts=%j",a.pipesCount,t);var u=t&&!1===t.end||e===r.stdout||e===r.stderr?x:c;function l(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",m),e.removeListener("finish",y),e.removeListener("drain",h),e.removeListener("error",g),e.removeListener("unpipe",l),n.removeListener("end",c),n.removeListener("end",x),n.removeListener("data",v),f=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function c(){d("onend"),e.end()}a.endEmitted?i.nextTick(u):n.once("end",u),e.on("unpipe",l);var h=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,R(e))}}(n);e.on("drain",h);var f=!1,p=!1;function v(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==M(a.pipes,e))&&!f&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function g(t){d("onerror",t),x(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function m(){e.removeListener("finish",y),x()}function y(){d("onfinish"),e.removeListener("close",m),x()}function x(){d("unpipe"),n.unpipe(e)}return n.on("data",v),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",m),e.once("finish",y),e.emit("pipe",n),a.flowing||(d("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)r[a].emit("unpipe",this,n);return this}var o=M(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},_.prototype.on=function(e,t){var n=u.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&P(this):i.nextTick(E,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(A,e,t))}(this,e)),this},_.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!=i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var a=0;a<y.length;a++)e.on(y[a],this.emit.bind(this,y[a]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},_._fromList=I}).call(this,n(0),n(3))},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=new r.default(a.default,e);return function(){!function(){if(n.seek(128),"DICM"!==n.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],t={};n.position<n.byteArray.length;){var r=n.position,s=(0,o.default)(n,e);if(s.tag>"x0002ffff"){n.position=r;break}s.parser=a.default,t[s.tag]=s}var u=new i.default(n.byteArrayParser,n.byteArray,t);return u.warnings=n.warnings,u.position=n.position,u}()};var r=s(n(12)),i=s(n(7)),a=s(n(22)),o=s(n(15));function s(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}}},function(e,t){var n={}.toString;e.exports=ue||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?function(e,t,n){for(;e.position+4<=e.byteArray.length;){var r=(0,o.default)(e);if(e.seek(-4),"xfffee0dd"===r)return t.length=e.position-t.dataOffset,e.seek(8),t;var i=l(e,n);t.items.push(i)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}(e,t,n):function(e,t,n){for(var r=t.dataOffset+t.length;e.position<r;){var i=l(e,n);t.items.push(i)}}(e,t,n)};var r=u(n(7)),i=u(n(15)),a=u(n(13)),o=u(n(4)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(16));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=(0,a.default)(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,t){for(var n={};e.position<e.byteArray.length;){var a=(0,i.default)(e,t);if(n[a.tag]=a,"xfffee00d"===a.tag)return new r.default(e.byteArrayParser,e.byteArray,n)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new r.default(e.byteArrayParser,e.byteArray,n)}(e,t),n.length=e.position-n.dataOffset):(n.dataSet=new r.default(e.byteArrayParser,e.byteArray,{}),s.parseDicomDataSetExplicit(n.dataSet,e,e.position+n.length)),n}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position "+(e.position-4)+" while reading element of undefined length with tag "+t.tag),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==(0,i.default)(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,a=0;a<r;a++){var o=e.readUint32();t.basicOffsetTable.push(o)}for(var s=e.position;e.position<e.byteArray.length;){var u=(0,i.default)(e),l=e.readUint32();if("xfffee0dd"===u)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==u)return n&&n.push("unexpected tag "+u+" while searching for end of pixel data element with undefined length"),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-s-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-s-8,position:e.position,length:l}),e.seek(l)}n&&n.push("pixel data element "+t.tag+" missing sequence delimiter tag xfffee0dd")};var r,i=(r=n(4))&&r.__esModule?r:{default:r}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,i=t.vr,a=t.tag;function o(t,n){for(var r="",i=0;i<t;i++)0!==i&&(r+="/"),r+=n.call(e,a,i).toString();return r}if(!0===r.isStringVr(i))n=e.string(a);else{if("AT"===i){var s=e.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"===i?n=o(t.length/2,e.uint16):"SS"===i?n=o(t.length/2,e.int16):"UL"===i?n=o(t.length/4,e.uint32):"SL"===i?n=o(t.length/4,e.int32):"FD"===i?n=o(t.length/8,e.double):"FL"===i&&(n=o(t.length/4,e.float))}return n};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(o||(o=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?(0,r.default)(e,t,n):(0,i.default)(e,t,0,t.fragments.length)};var r=a(n(27)),i=a(n(18));function a(e){return e&&e.__esModule?e:{default:e}}var o=!1},function(e,t,n){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,n){var r=n(8),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,n,u,l,c,h,f){var d,p,v,g,m,y,x,_,w,b=f.bits,S=0,k=0,P=0,T=0,D=0,C=0,E=0,A=0,R=0,I=0,O=null,L=0,M=new r.Buf16(16),N=new r.Buf16(16),F=null,B=0;for(S=0;S<=15;S++)M[S]=0;for(k=0;k<u;k++)M[t[n+k]]++;for(D=b,T=15;T>=1&&0===M[T];T--);if(D>T&&(D=T),0===T)return l[c++]=20971520,l[c++]=20971520,f.bits=1,0;for(P=1;P<T&&0===M[P];P++);for(D<P&&(D=P),A=1,S=1;S<=15;S++)if(A<<=1,(A-=M[S])<0)return-1;if(A>0&&(0===e||1!==T))return-1;for(N[1]=0,S=1;S<15;S++)N[S+1]=N[S]+M[S];for(k=0;k<u;k++)0!==t[n+k]&&(h[N[t[n+k]]++]=k);if(0===e?(O=F=h,y=19):1===e?(O=i,L-=257,F=a,B-=257,y=256):(O=o,F=s,y=-1),I=0,k=0,S=P,m=c,C=D,E=0,v=-1,g=(R=1<<D)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){x=S-E,h[k]<y?(_=0,w=h[k]):h[k]>y?(_=F[B+h[k]],w=O[L+h[k]]):(_=96,w=0),d=1<<S-E,P=p=1<<C;do{l[m+(I>>E)+(p-=d)]=x<<24|_<<16|w|0}while(0!==p);for(d=1<<S-1;I&d;)d>>=1;if(0!==d?(I&=d-1,I+=d):I=0,k++,0==--M[S]){if(S===T)break;S=t[n+h[k]]}if(S>D&&(I&g)!==v){for(0===E&&(E=D),m+=P,A=1<<(C=S-E);C+E<T&&!((A-=M[C+E])<=0);)C++,A<<=1;if(R+=1<<C,1===e&&R>852||2===e&&R>592)return 1;l[v=I&g]=D<<24|C<<16|m-c|0}}return 0!==I&&(l[m+I]=S-E<<24|64<<16|0),f.bits=D,0}},function(e,t,n){e.exports=function(e,t){var n,r,i,a,o,s,u,l,c,h,f,d,p,v,g,m,y,x,_,w,b,S,k,P,T;n=e.state,r=e.next_in,P=e.input,i=r+(e.avail_in-5),a=e.next_out,T=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),u=n.dmax,l=n.wsize,c=n.whave,h=n.wnext,f=n.window,d=n.hold,p=n.bits,v=n.lencode,g=n.distcode,m=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(d+=P[r++]<<p,p+=8,d+=P[r++]<<p,p+=8),x=v[d&m];t:for(;;){if(d>>>=_=x>>>24,p-=_,0==(_=x>>>16&255))T[a++]=65535&x;else{if(!(16&_)){if(0==(64&_)){x=v[(65535&x)+(d&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&x,(_&=15)&&(p<_&&(d+=P[r++]<<p,p+=8),w+=d&(1<<_)-1,d>>>=_,p-=_),p<15&&(d+=P[r++]<<p,p+=8,d+=P[r++]<<p,p+=8),x=g[d&y];n:for(;;){if(d>>>=_=x>>>24,p-=_,!(16&(_=x>>>16&255))){if(0==(64&_)){x=g[(65535&x)+(d&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(b=65535&x,p<(_&=15)&&(d+=P[r++]<<p,(p+=8)<_&&(d+=P[r++]<<p,p+=8)),(b+=d&(1<<_)-1)>u){e.msg="invalid distance too far back",n.mode=30;break e}if(d>>>=_,p-=_,b>(_=a-o)){if((_=b-_)>c&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,k=f,0===h){if(S+=l-_,_<w){w-=_;do{T[a++]=f[S++]}while(--_);S=a-b,k=T}}else if(h<_){if(S+=l+h-_,(_-=h)<w){w-=_;do{T[a++]=f[S++]}while(--_);if(S=0,h<w){w-=_=h;do{T[a++]=f[S++]}while(--_);S=a-b,k=T}}}else if(S+=h-_,_<w){w-=_;do{T[a++]=f[S++]}while(--_);S=a-b,k=T}for(;w>2;)T[a++]=k[S++],T[a++]=k[S++],T[a++]=k[S++],w-=3;w&&(T[a++]=k[S++],w>1&&(T[a++]=k[S++]))}else{S=a-b;do{T[a++]=T[S++],T[a++]=T[S++],T[a++]=T[S++],w-=3}while(w>2);w&&(T[a++]=T[S++],w>1&&(T[a++]=T[S++]))}break}}break}}while(r<i&&a<s);r-=w=p>>3,d&=(1<<(p-=w<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=d,n.bits=p}},function(e,t,n){var r=n(8),i=n(29),a=n(28),o=n(47),s=n(46),u=0,l=1,c=2,h=4,f=5,d=6,p=0,v=1,g=2,m=-2,y=-3,x=-4,_=-5,w=8,b=1,S=2,k=3,P=4,T=5,D=6,C=7,E=8,A=9,R=10,I=11,O=12,L=13,M=14,N=15,F=16,B=17,q=18,U=19,G=20,z=21,V=22,W=23,j=24,H=25,Y=26,Z=27,X=28,K=29,J=30,$=31,Q=32,ee=852,te=592,ne=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=b,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,p):m}function ae(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ie(e)):m}function oe(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?m:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ae(e))):m}function se(e,t){var n,i;return e?(i=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=i,i.window=null,(n=oe(e,t))!==p&&(e.state=null),n):m}var ue,le,ce=!0;function he(e){if(ce){var t;for(ue=new r.Buf32(512),le=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,ue,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,le,0,e.work,{bits:5}),ce=!1}e.lencode=ue,e.lenbits=9,e.distcode=le,e.distbits=5}function fe(e,t,n,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),r.arraySet(o.window,t,n-i,a,o.wnext),(i-=a)?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=ae,t.inflateReset2=oe,t.inflateResetKeep=ie,t.inflateInit=function(e){return se(e,ne)},t.inflateInit2=se,t.inflate=function(e,t){var n,ee,te,ne,ie,ae,oe,se,ue,le,ce,de,pe,ve,ge,me,ye,xe,_e,we,be,Se,ke,Pe,Te=0,De=new r.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;(n=e.state).mode===O&&(n.mode=L),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ae=e.avail_in,se=n.hold,ue=n.bits,le=ae,ce=oe,Se=p;e:for(;;)switch(n.mode){case b:if(0===n.wrap){n.mode=L;break}for(;ue<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(2&n.wrap&&35615===se){n.check=0,De[0]=255&se,De[1]=se>>>8&255,n.check=a(n.check,De,2,0),se=0,ue=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",n.mode=J;break}if((15&se)!==w){e.msg="unknown compression method",n.mode=J;break}if(ue-=4,be=8+(15&(se>>>=4)),0===n.wbits)n.wbits=be;else if(be>n.wbits){e.msg="invalid window size",n.mode=J;break}n.dmax=1<<be,e.adler=n.check=1,n.mode=512&se?R:O,se=0,ue=0;break;case S:for(;ue<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(n.flags=se,(255&n.flags)!==w){e.msg="unknown compression method",n.mode=J;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=J;break}n.head&&(n.head.text=se>>8&1),512&n.flags&&(De[0]=255&se,De[1]=se>>>8&255,n.check=a(n.check,De,2,0)),se=0,ue=0,n.mode=k;case k:for(;ue<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.head&&(n.head.time=se),512&n.flags&&(De[0]=255&se,De[1]=se>>>8&255,De[2]=se>>>16&255,De[3]=se>>>24&255,n.check=a(n.check,De,4,0)),se=0,ue=0,n.mode=P;case P:for(;ue<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.head&&(n.head.xflags=255&se,n.head.os=se>>8),512&n.flags&&(De[0]=255&se,De[1]=se>>>8&255,n.check=a(n.check,De,2,0)),se=0,ue=0,n.mode=T;case T:if(1024&n.flags){for(;ue<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.length=se,n.head&&(n.head.extra_len=se),512&n.flags&&(De[0]=255&se,De[1]=se>>>8&255,n.check=a(n.check,De,2,0)),se=0,ue=0}else n.head&&(n.head.extra=null);n.mode=D;case D:if(1024&n.flags&&((de=n.length)>ae&&(de=ae),de&&(n.head&&(be=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,ee,ne,de,be)),512&n.flags&&(n.check=a(n.check,ee,de,ne)),ae-=de,ne+=de,n.length-=de),n.length))break e;n.length=0,n.mode=C;case C:if(2048&n.flags){if(0===ae)break e;de=0;do{be=ee[ne+de++],n.head&&be&&n.length<65536&&(n.head.name+=String.fromCharCode(be))}while(be&&de<ae);if(512&n.flags&&(n.check=a(n.check,ee,de,ne)),ae-=de,ne+=de,be)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=E;case E:if(4096&n.flags){if(0===ae)break e;de=0;do{be=ee[ne+de++],n.head&&be&&n.length<65536&&(n.head.comment+=String.fromCharCode(be))}while(be&&de<ae);if(512&n.flags&&(n.check=a(n.check,ee,de,ne)),ae-=de,ne+=de,be)break e}else n.head&&(n.head.comment=null);n.mode=A;case A:if(512&n.flags){for(;ue<16;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(se!==(65535&n.check)){e.msg="header crc mismatch",n.mode=J;break}se=0,ue=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=O;break;case R:for(;ue<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}e.adler=n.check=re(se),se=0,ue=0,n.mode=I;case I:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=ue,g;e.adler=n.check=1,n.mode=O;case O:if(t===f||t===d)break e;case L:if(n.last){se>>>=7&ue,ue-=7&ue,n.mode=Z;break}for(;ue<3;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}switch(n.last=1&se,ue-=1,3&(se>>>=1)){case 0:n.mode=M;break;case 1:if(he(n),n.mode=G,t===d){se>>>=2,ue-=2;break e}break;case 2:n.mode=B;break;case 3:e.msg="invalid block type",n.mode=J}se>>>=2,ue-=2;break;case M:for(se>>>=7&ue,ue-=7&ue;ue<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",n.mode=J;break}if(n.length=65535&se,se=0,ue=0,n.mode=N,t===d)break e;case N:n.mode=F;case F:if(de=n.length){if(de>ae&&(de=ae),de>oe&&(de=oe),0===de)break e;r.arraySet(te,ee,ne,de,ie),ae-=de,ne+=de,oe-=de,ie+=de,n.length-=de;break}n.mode=O;break;case B:for(;ue<14;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(n.nlen=257+(31&se),se>>>=5,ue-=5,n.ndist=1+(31&se),se>>>=5,ue-=5,n.ncode=4+(15&se),se>>>=4,ue-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=J;break}n.have=0,n.mode=q;case q:for(;n.have<n.ncode;){for(;ue<3;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.lens[Ce[n.have++]]=7&se,se>>>=3,ue-=3}for(;n.have<19;)n.lens[Ce[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,ke={bits:n.lenbits},Se=s(u,n.lens,0,19,n.lencode,0,n.work,ke),n.lenbits=ke.bits,Se){e.msg="invalid code lengths set",n.mode=J;break}n.have=0,n.mode=U;case U:for(;n.have<n.nlen+n.ndist;){for(;me=(Te=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Te,!((ge=Te>>>24)<=ue);){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(ye<16)se>>>=ge,ue-=ge,n.lens[n.have++]=ye;else{if(16===ye){for(Pe=ge+2;ue<Pe;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(se>>>=ge,ue-=ge,0===n.have){e.msg="invalid bit length repeat",n.mode=J;break}be=n.lens[n.have-1],de=3+(3&se),se>>>=2,ue-=2}else if(17===ye){for(Pe=ge+3;ue<Pe;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}ue-=ge,be=0,de=3+(7&(se>>>=ge)),se>>>=3,ue-=3}else{for(Pe=ge+7;ue<Pe;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}ue-=ge,be=0,de=11+(127&(se>>>=ge)),se>>>=7,ue-=7}if(n.have+de>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=J;break}for(;de--;)n.lens[n.have++]=be}}if(n.mode===J)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=J;break}if(n.lenbits=9,ke={bits:n.lenbits},Se=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,ke),n.lenbits=ke.bits,Se){e.msg="invalid literal/lengths set",n.mode=J;break}if(n.distbits=6,n.distcode=n.distdyn,ke={bits:n.distbits},Se=s(c,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,ke),n.distbits=ke.bits,Se){e.msg="invalid distances set",n.mode=J;break}if(n.mode=G,t===d)break e;case G:n.mode=z;case z:if(ae>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=ue,o(e,ce),ie=e.next_out,te=e.output,oe=e.avail_out,ne=e.next_in,ee=e.input,ae=e.avail_in,se=n.hold,ue=n.bits,n.mode===O&&(n.back=-1);break}for(n.back=0;me=(Te=n.lencode[se&(1<<n.lenbits)-1])>>>16&255,ye=65535&Te,!((ge=Te>>>24)<=ue);){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(me&&0==(240&me)){for(xe=ge,_e=me,we=ye;me=(Te=n.lencode[we+((se&(1<<xe+_e)-1)>>xe)])>>>16&255,ye=65535&Te,!(xe+(ge=Te>>>24)<=ue);){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}se>>>=xe,ue-=xe,n.back+=xe}if(se>>>=ge,ue-=ge,n.back+=ge,n.length=ye,0===me){n.mode=Y;break}if(32&me){n.back=-1,n.mode=O;break}if(64&me){e.msg="invalid literal/length code",n.mode=J;break}n.extra=15&me,n.mode=V;case V:if(n.extra){for(Pe=n.extra;ue<Pe;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.length+=se&(1<<n.extra)-1,se>>>=n.extra,ue-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;me=(Te=n.distcode[se&(1<<n.distbits)-1])>>>16&255,ye=65535&Te,!((ge=Te>>>24)<=ue);){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(0==(240&me)){for(xe=ge,_e=me,we=ye;me=(Te=n.distcode[we+((se&(1<<xe+_e)-1)>>xe)])>>>16&255,ye=65535&Te,!(xe+(ge=Te>>>24)<=ue);){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}se>>>=xe,ue-=xe,n.back+=xe}if(se>>>=ge,ue-=ge,n.back+=ge,64&me){e.msg="invalid distance code",n.mode=J;break}n.offset=ye,n.extra=15&me,n.mode=j;case j:if(n.extra){for(Pe=n.extra;ue<Pe;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}n.offset+=se&(1<<n.extra)-1,se>>>=n.extra,ue-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=J;break}n.mode=H;case H:if(0===oe)break e;if(de=ce-oe,n.offset>de){if((de=n.offset-de)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=J;break}de>n.wnext?(de-=n.wnext,pe=n.wsize-de):pe=n.wnext-de,de>n.length&&(de=n.length),ve=n.window}else ve=te,pe=ie-n.offset,de=n.length;de>oe&&(de=oe),oe-=de,n.length-=de;do{te[ie++]=ve[pe++]}while(--de);0===n.length&&(n.mode=z);break;case Y:if(0===oe)break e;te[ie++]=n.length,oe--,n.mode=z;break;case Z:if(n.wrap){for(;ue<32;){if(0===ae)break e;ae--,se|=ee[ne++]<<ue,ue+=8}if(ce-=oe,e.total_out+=ce,n.total+=ce,ce&&(e.adler=n.check=n.flags?a(n.check,te,ce,ie-ce):i(n.check,te,ce,ie-ce)),ce=oe,(n.flags?se:re(se))!==n.check){e.msg="incorrect data check",n.mode=J;break}se=0,ue=0}n.mode=X;case X:if(n.wrap&&n.flags){for(;ue<32;){if(0===ae)break e;ae--,se+=ee[ne++]<<ue,ue+=8}if(se!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=J;break}se=0,ue=0}n.mode=K;case K:Se=v;break e;case J:Se=y;break e;case $:return x;case Q:default:return m}return e.next_out=ie,e.avail_out=oe,e.next_in=ne,e.avail_in=ae,n.hold=se,n.bits=ue,(n.wsize||ce!==e.avail_out&&n.mode<J&&(n.mode<Z||t!==h))&&fe(e,e.output,e.next_out,ce-e.avail_out)?(n.mode=$,x):(le-=e.avail_in,ce-=e.avail_out,e.total_in+=le,e.total_out+=ce,n.total+=ce,n.wrap&&ce&&(e.adler=n.check=n.flags?a(n.check,te,ce,e.next_out-ce):i(n.check,te,ce,e.next_out-ce)),e.data_type=n.bits+(n.last?64:0)+(n.mode===O?128:0)+(n.mode===G||n.mode===N?256:0),(0===le&&0===ce||t===h)&&Se===p&&(Se=_),Se)},t.inflateEnd=function(e){if(!e||!e.state)return m;var t=e.state;return t.window&&(t.window=null),e.state=null,p},t.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?m:(n.head=t,t.done=!1,p):m},t.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==I?m:n.mode===I&&i(1,t,r,0)!==n.check?y:fe(e,t,r,r)?(n.mode=$,x):(n.havedict=1,p):m},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,n){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,n){var r=n(8),i=4,a=0,o=1,s=2;function u(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,c=1,h=2,f=29,d=256,p=d+1+f,v=30,g=19,m=2*p+1,y=15,x=16,_=7,w=256,b=16,S=17,k=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],E=new Array(2*(p+2));u(E);var A=new Array(2*v);u(A);var R=new Array(512);u(R);var I=new Array(256);u(I);var O=new Array(f);u(O);var L,M,N,F=new Array(v);function B(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function q(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?R[e]:R[256+(e>>>7)]}function G(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function z(e,t,n){e.bi_valid>x-n?(e.bi_buf|=t<<e.bi_valid&65535,G(e,e.bi_buf),e.bi_buf=t>>x-e.bi_valid,e.bi_valid+=n-x):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function V(e,t,n){z(e,n[2*t],n[2*t+1])}function W(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function j(e,t,n){var r,i,a=new Array(y+1),o=0;for(r=1;r<=y;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=W(a[s]++,s))}}function H(e){var t;for(t=0;t<p;t++)e.dyn_ltree[2*t]=0;for(t=0;t<v;t++)e.dyn_dtree[2*t]=0;for(t=0;t<g;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Y(e){e.bi_valid>8?G(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Z(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function X(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&Z(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Z(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function K(e,t,n){var r,i,a,o,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?V(e,i,t):(V(e,(a=I[i])+d+1,t),0!==(o=P[a])&&z(e,i-=O[a],o),V(e,a=U(--r),n),0!==(o=T[a])&&z(e,r-=F[a],o))}while(s<e.last_lit);V(e,w,t)}function J(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=m,n=0;n<u;n++)0!==a[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)X(e,a,n);i=u;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],X(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,X(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,u=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(a=0;a<=y;a++)e.bl_count[a]=0;for(u[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<m;n++)(a=u[2*u[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,v++),u[2*r+1]=a,r>l||(e.bl_count[a]++,o=0,r>=d&&(o=f[r-d]),s=u[2*r],e.opt_len+=s*(a+o),h&&(e.static_len+=s*(c[2*r+1]+o)));if(0!==v){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>l||(u[2*i+1]!==a&&(e.opt_len+=(a-u[2*i+1])*u[2*i],u[2*i+1]=a),r--)}}(e,t),j(a,l,e.bl_count)}function $(e,t,n){var r,i,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<u&&i===o||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*b]++):s<=10?e.bl_tree[2*S]++:e.bl_tree[2*k]++,s=0,a=i,0===o?(u=138,l=3):i===o?(u=6,l=3):(u=7,l=4))}function Q(e,t,n){var r,i,a=-1,o=t[1],s=0,u=7,l=4;for(0===o&&(u=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<u&&i===o)){if(s<l)do{V(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(V(e,i,e.bl_tree),s--),V(e,b,e.bl_tree),z(e,s-3,2)):s<=10?(V(e,S,e.bl_tree),z(e,s-3,3)):(V(e,k,e.bl_tree),z(e,s-11,7));s=0,a=i,0===o?(u=138,l=3):i===o?(u=6,l=3):(u=7,l=4)}}u(F);var ee=!1;function te(e,t,n,i){z(e,(l<<1)+(i?1:0),3),function(e,t,n,i){Y(e),i&&(G(e,n),G(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}t._tr_init=function(e){ee||(function(){var e,t,n,r,i,a=new Array(y+1);for(n=0,r=0;r<f-1;r++)for(O[r]=n,e=0;e<1<<P[r];e++)I[n++]=r;for(I[n-1]=r,i=0,r=0;r<16;r++)for(F[r]=i,e=0;e<1<<T[r];e++)R[i++]=r;for(i>>=7;r<v;r++)for(F[r]=i<<7,e=0;e<1<<T[r]-7;e++)R[256+i++]=r;for(t=0;t<=y;t++)a[t]=0;for(e=0;e<=143;)E[2*e+1]=8,e++,a[8]++;for(;e<=255;)E[2*e+1]=9,e++,a[9]++;for(;e<=279;)E[2*e+1]=7,e++,a[7]++;for(;e<=287;)E[2*e+1]=8,e++,a[8]++;for(j(E,p+1,a),e=0;e<v;e++)A[2*e+1]=5,A[2*e]=W(e,5);L=new B(E,P,d+1,p,y),M=new B(A,T,0,v,y),N=new B(new Array(0),D,0,g,_)}(),ee=!0),e.l_desc=new q(e.dyn_ltree,L),e.d_desc=new q(e.dyn_dtree,M),e.bl_desc=new q(e.bl_tree,N),e.bi_buf=0,e.bi_valid=0,H(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,n,r){var u,l,f=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<d;t++)if(0!==e.dyn_ltree[2*t])return o;return a}(e)),J(e,e.l_desc),J(e,e.d_desc),f=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),J(e,e.bl_desc),t=g-1;t>=3&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),u=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=u&&(u=l)):u=l=n+5,n+4<=u&&-1!==t?te(e,t,n,r):e.strategy===i||l===u?(z(e,(c<<1)+(r?1:0),3),K(e,E,A)):(z(e,(h<<1)+(r?1:0),3),function(e,t,n,r){var i;for(z(e,t-257,5),z(e,n-1,5),z(e,r-4,4),i=0;i<r;i++)z(e,e.bl_tree[2*C[i]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,f+1),K(e,e.dyn_ltree,e.dyn_dtree)),H(e),r&&Y(e)},t._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(I[n]+d+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){z(e,c<<1,3),V(e,w,E),function(e){16===e.bi_valid?(G(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,n){var r,i=n(8),a=n(50),o=n(29),s=n(28),u=n(49),l=0,c=1,h=3,f=4,d=5,p=0,v=1,g=-2,m=-3,y=-5,x=-1,_=1,w=2,b=3,S=4,k=0,P=2,T=8,D=9,C=15,E=8,A=286,R=30,I=19,O=2*A+1,L=15,M=3,N=258,F=N+M+1,B=32,q=42,U=69,G=73,z=91,V=103,W=113,j=666,H=1,Y=2,Z=3,X=4,K=3;function J(e,t){return e.msg=u[t],t}function $(e){return(e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function te(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function re(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,l=e.window,c=e.w_mask,h=e.prev,f=e.strstart+N,d=l[a+o-1],p=l[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(l[(n=t)+o]===p&&l[n+o-1]===d&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<f);if(r=N-(f-a),a=f-N,r>o){if(e.match_start=t,o=r,r>=s)break;d=l[a+o-1],p=l[a+o]}}}while((t=h[t&c])>u&&0!=--i);return o<=e.lookahead?o:e.lookahead}function ae(e){var t,n,r,a,u,l,c,h,f,d,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-F)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=p?r-p:0}while(--n);t=n=p;do{r=e.prev[--t],e.prev[t]=r>=p?r-p:0}while(--n);a+=p}if(0===e.strm.avail_in)break;if(l=e.strm,c=e.window,h=e.strstart+e.lookahead,f=a,d=void 0,(d=l.avail_in)>f&&(d=f),n=0===d?0:(l.avail_in-=d,i.arraySet(c,l.input,l.next_in,d,h),1===l.state.wrap?l.adler=o(l.adler,c,d,h):2===l.state.wrap&&(l.adler=s(l.adler,c,d,h)),l.next_in+=d,l.total_in+=d,d),e.lookahead+=n,e.lookahead+e.insert>=M)for(u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+M-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<F&&0!==e.strm.avail_in)}function oe(e,t){for(var n,r;;){if(e.lookahead<F){if(ae(e),e.lookahead<F&&t===l)return H;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-F&&(e.match_length=ie(e,n)),e.match_length>=M)if(r=a._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<M-1?e.strstart:M-1,t===f?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Y}function se(e,t){for(var n,r,i;;){if(e.lookahead<F){if(ae(e),e.lookahead<F&&t===l)return H;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-F&&(e.match_length=ie(e,n),e.match_length<=5&&(e.strategy===_||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-M,r=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,r&&(te(e,!1),0===e.strm.avail_out))return H}else if(e.match_available){if((r=a._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===f?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Y}function ue(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function le(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=P,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?q:W,e.adler=2===t.wrap?0:1,t.last_flush=l,a._tr_init(t),p):J(e,g)}function ce(e){var t,n=le(e);return n===p&&((t=e.state).window_size=2*t.w_size,Q(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=M-1,t.match_available=0,t.ins_h=0),n}function he(e,t,n,r,a,o){if(!e)return g;var s=1;if(t===x&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>D||n!==T||r<8||r>15||t<0||t>9||o<0||o>S)return J(e,g);8===r&&(r=9);var u=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*O),this.dyn_dtree=new i.Buf16(2*(2*R+1)),this.bl_tree=new i.Buf16(2*(2*I+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(L+1),this.heap=new i.Buf16(2*A+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*A+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=u,u.strm=e,u.wrap=s,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=a+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+M-1)/M),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<a+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=t,u.strategy=o,u.method=n,ce(e)}r=[new ue(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===l)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,te(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-F&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===f?(te(e,!0),0===e.strm.avail_out?Z:X):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),H)})),new ue(4,4,8,4,oe),new ue(4,5,16,8,oe),new ue(4,6,32,32,oe),new ue(4,4,16,16,se),new ue(8,16,32,32,se),new ue(8,16,128,128,se),new ue(8,32,128,256,se),new ue(32,128,258,1024,se),new ue(32,258,258,4096,se)],t.deflateInit=function(e,t){return he(e,t,T,C,E,k)},t.deflateInit2=he,t.deflateReset=ce,t.deflateResetKeep=le,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?g:(e.state.gzhead=t,p):g},t.deflate=function(e,t){var n,i,o,u;if(!e||!e.state||t>d||t<0)return e?J(e,g):g;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===j&&t!==f)return J(e,0===e.avail_out?y:g);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===q)if(2===i.wrap)e.adler=0,ne(i,31),ne(i,139),ne(i,8),i.gzhead?(ne(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ne(i,255&i.gzhead.time),ne(i,i.gzhead.time>>8&255),ne(i,i.gzhead.time>>16&255),ne(i,i.gzhead.time>>24&255),ne(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),ne(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ne(i,255&i.gzhead.extra.length),ne(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=U):(ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,0),ne(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),ne(i,K),i.status=W);else{var m=T+(i.w_bits-8<<4)<<8;m|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=B),m+=31-m%31,i.status=W,re(i,m),0!==i.strstart&&(re(i,e.adler>>>16),re(i,65535&e.adler)),e.adler=1}if(i.status===U)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending!==i.pending_buf_size));)ne(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=G)}else i.status=G;if(i.status===G)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ne(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.gzindex=0,i.status=z)}else i.status=z;if(i.status===z)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),ee(e),o=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ne(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===u&&(i.status=V)}else i.status=V;if(i.status===V&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&ee(e),i.pending+2<=i.pending_buf_size&&(ne(i,255&e.adler),ne(i,e.adler>>8&255),e.adler=0,i.status=W)):i.status=W),0!==i.pending){if(ee(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&$(t)<=$(n)&&t!==f)return J(e,y);if(i.status===j&&0!==e.avail_in)return J(e,y);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==j){var x=i.strategy===w?function(e,t){for(var n;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===l)return H;break}if(e.match_length=0,n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===f?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Y}(i,t):i.strategy===b?function(e,t){for(var n,r,i,o,s=e.window;;){if(e.lookahead<=N){if(ae(e),e.lookahead<=N&&t===l)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(r=s[i=e.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){o=e.strstart+N;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=N-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(n=a._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===f?(te(e,!0),0===e.strm.avail_out?Z:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Y}(i,t):r[i.level].func(i,t);if(x!==Z&&x!==X||(i.status=j),x===H||x===Z)return 0===e.avail_out&&(i.last_flush=-1),p;if(x===Y&&(t===c?a._tr_align(i):t!==d&&(a._tr_stored_block(i,0,0,!1),t===h&&(Q(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),ee(e),0===e.avail_out))return i.last_flush=-1,p}return t!==f?p:i.wrap<=0?v:(2===i.wrap?(ne(i,255&e.adler),ne(i,e.adler>>8&255),ne(i,e.adler>>16&255),ne(i,e.adler>>24&255),ne(i,255&e.total_in),ne(i,e.total_in>>8&255),ne(i,e.total_in>>16&255),ne(i,e.total_in>>24&255)):(re(i,e.adler>>>16),re(i,65535&e.adler)),ee(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:v)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==q&&t!==U&&t!==G&&t!==z&&t!==V&&t!==W&&t!==j?J(e,g):(e.state=null,t===W?J(e,m):p):g},t.deflateSetDictionary=function(e,t){var n,r,a,s,u,l,c,h,f=t.length;if(!e||!e.state)return g;if(2===(s=(n=e.state).wrap)||1===s&&n.status!==q||n.lookahead)return g;for(1===s&&(e.adler=o(e.adler,t,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(Q(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new i.Buf8(n.w_size),i.arraySet(h,t,f-n.w_size,n.w_size,0),t=h,f=n.w_size),u=e.avail_in,l=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=t,ae(n);n.lookahead>=M;){r=n.strstart,a=n.lookahead-(M-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+M-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=M-1,ae(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=M-1,n.match_available=0,e.next_in=l,e.input=c,e.avail_in=u,n.wrap=s,p},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,n){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t){e.exports="function"==typeof pe?function(e,t){e.super_=t,e.prototype=pe(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=function(e){return e&&"object"==Lt(e)&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){(function(e,r){var i=n(31),a=n(52),o=n(51),s=n(48),u=n(45);for(var l in u)t[l]=u[l];function c(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,i(this.init_done,"close before init"),i(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||s.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},c.prototype.write=function(e,t,n,r,i,a,o){return this._write(!0,e,t,n,r,i,a,o)},c.prototype.writeSync=function(e,t,n,r,i,a,o){return this._write(!1,e,t,n,r,i,a,o)},c.prototype._write=function(n,a,o,s,u,l,c,h){if(i.equal(arguments.length,8),i(this.init_done,"write before init"),i(this.mode!==t.NONE,"already finalized"),i.equal(!1,this.write_in_progress,"write already in progress"),i.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,i.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==t.Z_NO_FLUSH&&a!==t.Z_PARTIAL_FLUSH&&a!==t.Z_SYNC_FLUSH&&a!==t.Z_FULL_FLUSH&&a!==t.Z_FINISH&&a!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==o&&(o=e.alloc(0),u=0,s=0),this.strm.avail_in=u,this.strm.input=o,this.strm.next_in=s,this.strm.avail_out=h,this.strm.output=l,this.strm.next_out=c,this.flush=a,!n)return this._process(),this._checkError()?this._afterSync():void 0;var f=this;return r.nextTick((function(){f._process(),f._after()})),this},c.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},c.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=s.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=s.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=s.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=s.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},c.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(e,n,r,a,o){i(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),i(e>=8&&e<=15,"invalid windowBits"),i(n>=-1&&n<=9,"invalid compression level"),i(r>=1&&r<=9,"invalid memlevel"),i(a===t.Z_FILTERED||a===t.Z_HUFFMAN_ONLY||a===t.Z_RLE||a===t.Z_FIXED||a===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(n,e,r,a,o),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(e,n,r,i,u){switch(this.level=e,this.windowBits=n,this.memLevel=r,this.strategy=i,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=s.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=u,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=s.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=c}).call(this,n(1).Buffer,n(3))},function(e,t,n){e.exports=n(20).PassThrough},function(e,t,n){e.exports=n(20).Transform},function(e,t,n){e.exports=n(2)},function(e,t,n){e.exports=n(19)},function(e,t,n){e.exports=a;var r=n(32),i=n(6);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}i.inherits=n(5),i.inherits(a,r),a.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){(function(e,t){!function(e,n){if(!e.setImmediate){var r,i,a,o,s,u=1,l={},c=!1,h=e.document,f=Ht&&Ht(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){a.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)},f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return l[u]=i,r(u),u++},f.clearImmediate=d}function d(e){delete l[e]}function p(e){if(c)setTimeout(p,0,e);else{var t=l[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(3))},function(e,t,n){(function(e){var r=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(62),t.setImmediate="undefined"!=typeof self&&xn||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&_n||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t){},function(e,t,n){var r=n(9).Buffer,i=n(64);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i=r.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=i,n=o,a.data.copy(t,n),o+=a.data.length,a=a.next;return i},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){e.exports=i;var r=n(21).EventEmitter;function i(){r.call(this)}n(5)(i,r),i.Readable=n(20),i.Writable=n(59),i.Duplex=n(58),i.Transform=n(57),i.PassThrough=n(56),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",u));var o=!1;function s(){o||(o=!0,e.end())}function u(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(c(),0===r.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",i),e.removeListener("drain",a),n.removeListener("end",s),n.removeListener("close",u),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",l),e.on("error",l),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e}},function(e,t,n){(function(e){var r=n(1).Buffer,i=n(67).Transform,a=n(55),o=n(30),s=n(31).ok,u=n(1).kMaxLength,l="Cannot create final Buffer. It would be larger than 0x"+u.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=V(a),h=0;h<c.length;h++){var f=c[h];f.match(/^Z/)&&m(t,f,{enumerable:!0,value:a[f],writable:!1})}for(var d={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=V(d),v=0;v<p.length;v++){var g=p[v];d[d[g]]=g}function y(e,t,n){var i=[],a=0;function o(){for(var t;null!==(t=e.read());)i.push(t),a+=t.length;e.once("readable",o)}function s(){var t,o=null;a>=u?o=new RangeError(l):t=r.concat(i,a),i=[],e.close(),n(o,t)}e.on("error",(function(t){e.removeListener("end",s),e.removeListener("readable",o),n(t)})),e.on("end",s),e.end(t),o()}function x(e,t){if("string"==typeof t&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Not a string or buffer");var n=e._finishFlushFlag;return e._processChunk(t,n)}function _(e){if(!(this instanceof _))return new _(e);C.call(this,e,a.DEFLATE)}function w(e){if(!(this instanceof w))return new w(e);C.call(this,e,a.INFLATE)}function b(e){if(!(this instanceof b))return new b(e);C.call(this,e,a.GZIP)}function S(e){if(!(this instanceof S))return new S(e);C.call(this,e,a.GUNZIP)}function k(e){if(!(this instanceof k))return new k(e);C.call(this,e,a.DEFLATERAW)}function P(e){if(!(this instanceof P))return new P(e);C.call(this,e,a.INFLATERAW)}function T(e){if(!(this instanceof T))return new T(e);C.call(this,e,a.UNZIP)}function D(e){return e===a.Z_NO_FLUSH||e===a.Z_PARTIAL_FLUSH||e===a.Z_SYNC_FLUSH||e===a.Z_FULL_FLUSH||e===a.Z_FINISH||e===a.Z_BLOCK}function C(e,n){var o=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,i.call(this,e),e.flush&&!D(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!D(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:a.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!r.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(n);var s=this;this._hadError=!1,this._handle.onerror=function(e,n){E(s),s._hadError=!0;var r=new Error(e);r.errno=n,r.code=t.codes[n],s.emit("error",r)};var u=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(u=e.level);var l=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(l=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,u,e.memLevel||t.Z_DEFAULT_MEMLEVEL,l,e.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=u,this._strategy=l,this.once("end",this.close),m(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function E(t,n){n&&e.nextTick(n),t._handle&&(t._handle.close(),t._handle=null)}function A(e){e.emit("close")}m(t,"codes",{enumerable:!0,value:Si(d),writable:!1}),t.Deflate=_,t.Inflate=w,t.Gzip=b,t.Gunzip=S,t.DeflateRaw=k,t.InflateRaw=P,t.Unzip=T,t.createDeflate=function(e){return new _(e)},t.createInflate=function(e){return new w(e)},t.createDeflateRaw=function(e){return new k(e)},t.createInflateRaw=function(e){return new P(e)},t.createGzip=function(e){return new b(e)},t.createGunzip=function(e){return new S(e)},t.createUnzip=function(e){return new T(e)},t.deflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new _(t),e,n)},t.deflateSync=function(e,t){return x(new _(t),e)},t.gzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new b(t),e,n)},t.gzipSync=function(e,t){return x(new b(t),e)},t.deflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new k(t),e,n)},t.deflateRawSync=function(e,t){return x(new k(t),e)},t.unzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new T(t),e,n)},t.unzipSync=function(e,t){return x(new T(t),e)},t.inflate=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new w(t),e,n)},t.inflateSync=function(e,t){return x(new w(t),e)},t.gunzip=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new S(t),e,n)},t.gunzipSync=function(e,t){return x(new S(t),e)},t.inflateRaw=function(e,t,n){return"function"==typeof t&&(n=t,t={}),y(new P(t),e,n)},t.inflateRawSync=function(e,t){return x(new P(t),e)},o.inherits(C,i),C.prototype.params=function(n,r,i){if(n<t.Z_MIN_LEVEL||n>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+n);if(r!=t.Z_FILTERED&&r!=t.Z_HUFFMAN_ONLY&&r!=t.Z_RLE&&r!=t.Z_FIXED&&r!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+r);if(this._level!==n||this._strategy!==r){var o=this;this.flush(a.Z_SYNC_FLUSH,(function(){s(o._handle,"zlib binding closed"),o._handle.params(n,r),o._hadError||(o._level=n,o._strategy=r,i&&i())}))}else e.nextTick(i)},C.prototype.reset=function(){return s(this._handle,"zlib binding closed"),this._handle.reset()},C.prototype._flush=function(e){this._transform(r.alloc(0),"",e)},C.prototype.flush=function(t,n){var i=this,o=this._writableState;("function"==typeof t||void 0===t&&!n)&&(n=t,t=a.Z_FULL_FLUSH),o.ended?n&&e.nextTick(n):o.ending?n&&this.once("end",n):o.needDrain?n&&this.once("drain",(function(){return i.flush(t,n)})):(this._flushFlag=t,this.write(r.alloc(0),"",n))},C.prototype.close=function(t){E(this,t),e.nextTick(A,this)},C.prototype._transform=function(e,t,n){var i,o=this._writableState,s=(o.ending||o.ended)&&(!e||o.length===e.length);return null===e||r.isBuffer(e)?this._handle?(s?i=this._finishFlushFlag:(i=this._flushFlag,e.length>=o.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(e,i,n)):n(new Error("zlib binding closed")):n(new Error("invalid input"))},C.prototype._processChunk=function(e,t,n){var i=e&&e.length,a=this._chunkSize-this._offset,o=0,c=this,h="function"==typeof n;if(!h){var f,d=[],p=0;this.on("error",(function(e){f=e})),s(this._handle,"zlib binding closed");do{var v=this._handle.writeSync(t,e,o,i,this._buffer,this._offset,a)}while(!this._hadError&&y(v[0],v[1]));if(this._hadError)throw f;if(p>=u)throw E(this),new RangeError(l);var g=r.concat(d,p);return E(this),g}s(this._handle,"zlib binding closed");var m=this._handle.write(t,e,o,i,this._buffer,this._offset,a);function y(u,l){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var f=a-l;if(s(f>=0,"have should not go down"),f>0){var v=c._buffer.slice(c._offset,c._offset+f);c._offset+=f,h?c.push(v):(d.push(v),p+=v.length)}if((0===l||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=r.allocUnsafe(c._chunkSize)),0===l){if(o+=i-u,i=u,!h)return!0;var g=c._handle.write(t,e,o,i,c._buffer,c._offset,c._chunkSize);return g.callback=y,void(g.buffer=e)}if(!h)return!1;n()}}m.buffer=e,m.callback=y},o.inherits(_,C),o.inherits(w,C),o.inherits(b,C),o.inherits(S,C),o.inherits(k,C),o.inherits(P,C),o.inherits(T,C)}).call(this,n(3))},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===e)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";function f(u){var f=function(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=t.elements.x00020010;return c.readFixedString(e,n.dataOffset,n.length)}(u),d=function(e){return"1.2.840.10008.1.2"!==e}(f),p=function(o,u){var c="undefined"==typeof window;if("1.2.840.10008.1.2.1.99"===o){if(t&&t.inflater){var h=t.inflater(e,u);return new a.default(s.default,h,0)}if(!0===c){var f=n(68),d=(0,l.default)(e,u,e.length-u),p=f.inflateRawSync(d),v=(0,r.default)(e,p.length+u);return e.copy(v,0,0,u),p.copy(v,u),new a.default(s.default,v,0)}if("undefined"!=typeof pako){var g=e.slice(u),m=pako.inflateRaw(g),y=(0,r.default)(e,m.length+u);return y.set(e.slice(0,u),0),y.set(m,u),new a.default(s.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===o?new a.default(i.default,e,u):new a.default(s.default,e,u)}(f,u.position),v=new o.default(p.byteArrayParser,p.byteArray,{});v.warnings=p.warnings;try{d?h.parseDicomDataSetExplicit(v,p,p.byteArray.length,t):h.parseDicomDataSetImplicit(v,p,p.byteArray.length,t)}catch(e){throw{exception:e,dataSet:v}}return v}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(d=(0,u.default)(e,t),f(d));var d};var r=d(n(23)),i=d(n(38)),a=d(n(12)),o=d(n(7)),s=d(n(22)),u=d(n(37)),l=d(n(11)),c=f(n(14)),h=f(n(16));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function d(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default="1.8.5"},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=f,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),a-=l}return(d?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=255&s,d+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[n+d]=255&o,d+=p,o/=256,l-=8);e[n+d-p]|=128*v}},function(e,t,n){t.byteLength=function(e){return 3*e.length/4-l(e)},t.toByteArray=function(e){var t,n,r,o,s,u=e.length;o=l(e),s=new a(3*u/4-o),n=o>0?u-4:u;var c=0;for(t=0;t<n;t+=4)r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],s[c++]=r>>16&255,s[c++]=r>>8&255,s[c++]=255&r;return 2===o?(r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,s[c++]=255&r):1===o&&(r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,s[c++]=r>>8&255,s[c++]=255&r),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a="",o=[],s=0,u=n-i;s<u;s+=16383)o.push(c(e,s,s+16383>u?u:s+16383));return 1===i?(t=e[n-1],a+=r[t>>2],a+=r[t<<4&63],a+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],a+=r[t>>10],a+=r[t>>4&63],a+=r[t<<2&63],a+="="),o.push(a),o.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function c(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t,n){function r(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function i(e,t,n){var i=t.fragments[n];return!(!r(e,i.position+i.length-2)&&!r(e,i.position+i.length-3))}function a(e,t,n){for(var r=n;r<t.fragments.length;r++)if(i(e,t,r))return r}m(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n&&n.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";n=n||t.fragments;for(var r=[],i=0;;){r.push(t.fragments[i].offset);var o=a(e,t,i);if(void 0===o||o===t.fragments.length-1)return r;i=o+1}}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function e(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var o in t.elements){var s=t.elements[o];if(!0!==n.omitPrivateAttibutes||!a.isPrivateTag(o))if(s.items){for(var u=[],l=0;l<s.items.length;l++)u.push(e(s.items[l].dataSet,n));r[o]=u}else{var c;c=void 0,s.length<n.maxElementLength&&(c=(0,i.default)(t,s)),r[o]=void 0!==c?c:{dataOffset:s.dataOffset,length:s.length}}}return r};var r,i=(r=n(43))&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(17))},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(e&&8===e.length){var n=ci(e.substring(0,4),10),r=ci(e.substring(4,6),10),i=ci(e.substring(6,8),10);if(t&&!0!==function(e,t,n){return!isNaN(n)&&t>0&&t<=12&&e>0&&e<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(t,n)}(i,r,n))throw"invalid DA '"+e+"'";return{year:n,month:r,day:i}}if(t)throw"invalid DA '"+e+"'"}},function(e,t,n){m(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.length>=2){var n=ci(e.substring(0,2),10),r=e.length>=4?ci(e.substring(2,4),10):void 0,i=e.length>=6?ci(e.substring(4,6),10):void 0,a=e.length>=8?e.substring(7,13):void 0,o=a?ci(a,10)*Math.pow(10,6-a.length):void 0;if(t&&(isNaN(n)||void 0!==r&&isNaN(r)||void 0!==i&&isNaN(i)||void 0!==o&&isNaN(o)||n<0||n>23||r&&(r<0||r>59)||i&&(i<0||i>59)||o&&(o<0||o>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:r,seconds:i,fractionalSeconds:o}}if(t)throw"invalid TM '"+e+"'"}},function(e,t,n){m(t,"__esModule",{value:!0}),t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(17),i=l(n(76)),a=l(n(75)),o=l(n(43)),s=l(n(74)),u=l(n(73));function l(e){return e&&e.__esModule?e:{default:e}}t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=i.default,t.parseDA=a.default,t.explicitElementToString=o.default,t.explicitDataSetToJS=s.default,t.createJPEGBasicOffsetTable=u.default},function(e,t,n){m(t,"__esModule",{value:!0}),t.readTag=t.readSequenceItem=t.readSequenceItemsImplicit=t.readSequenceItemsExplicit=t.readPart10Header=t.readEncapsulatedPixelDataFromFragments=t.readEncapsulatedPixelData=t.readEncapsulatedImageFrame=t.readDicomElementImplicit=t.readDicomElementExplicit=t.parseDicom=t.littleEndianByteArrayParser=t.findItemDelimitationItemAndSetElementLength=t.findEndOfEncapsulatedElement=t.findAndSetUNElementLength=t.DataSet=t.sharedCopy=t.ByteStream=t.bigEndianByteArrayParser=t.version=t.alloc=t.readFixedString=t.parseDicomDataSetImplicit=t.parseDicomDataSetExplicit=t.createJPEGBasicOffsetTable=t.explicitDataSetToJS=t.explicitElementToString=t.parseDA=t.parseTM=t.parsePN=t.isPrivateTag=t.isStringVr=void 0;var r=n(77),i=n(16),a=n(14),o=C(n(23)),s=C(n(70)),u=C(n(38)),l=C(n(12)),c=C(n(11)),h=C(n(7)),f=C(n(41)),d=C(n(42)),p=C(n(24)),v=C(n(22)),g=C(n(69)),y=C(n(15)),x=C(n(25)),_=C(n(27)),w=C(n(44)),b=C(n(18)),S=C(n(37)),k=C(n(40)),P=C(n(26)),T=C(n(13)),D=C(n(4));function C(e){return e&&e.__esModule?e:{default:e}}var E={isStringVr:r.isStringVr,isPrivateTag:r.isPrivateTag,parsePN:r.parsePN,parseTM:r.parseTM,parseDA:r.parseDA,explicitElementToString:r.explicitElementToString,explicitDataSetToJS:r.explicitDataSetToJS,createJPEGBasicOffsetTable:r.createJPEGBasicOffsetTable,parseDicomDataSetExplicit:i.parseDicomDataSetExplicit,parseDicomDataSetImplicit:i.parseDicomDataSetImplicit,readFixedString:a.readFixedString,alloc:o.default,version:s.default,bigEndianByteArrayParser:u.default,ByteStream:l.default,sharedCopy:c.default,DataSet:h.default,findAndSetUNElementLength:f.default,findEndOfEncapsulatedElement:d.default,findItemDelimitationItemAndSetElementLength:p.default,littleEndianByteArrayParser:v.default,parseDicom:g.default,readDicomElementExplicit:y.default,readDicomElementImplicit:x.default,readEncapsulatedImageFrame:_.default,readEncapsulatedPixelData:w.default,readEncapsulatedPixelDataFromFragments:b.default,readPart10Header:S.default,readSequenceItemsExplicit:k.default,readSequenceItemsImplicit:P.default,readSequenceItem:T.default,readTag:D.default};t.isStringVr=r.isStringVr,t.isPrivateTag=r.isPrivateTag,t.parsePN=r.parsePN,t.parseTM=r.parseTM,t.parseDA=r.parseDA,t.explicitElementToString=r.explicitElementToString,t.explicitDataSetToJS=r.explicitDataSetToJS,t.createJPEGBasicOffsetTable=r.createJPEGBasicOffsetTable,t.parseDicomDataSetExplicit=i.parseDicomDataSetExplicit,t.parseDicomDataSetImplicit=i.parseDicomDataSetImplicit,t.readFixedString=a.readFixedString,t.alloc=o.default,t.version=s.default,t.bigEndianByteArrayParser=u.default,t.ByteStream=l.default,t.sharedCopy=c.default,t.DataSet=h.default,t.findAndSetUNElementLength=f.default,t.findEndOfEncapsulatedElement=d.default,t.findItemDelimitationItemAndSetElementLength=p.default,t.littleEndianByteArrayParser=v.default,t.parseDicom=g.default,t.readDicomElementExplicit=y.default,t.readDicomElementImplicit=x.default,t.readEncapsulatedImageFrame=_.default,t.readEncapsulatedPixelData=w.default,t.readEncapsulatedPixelDataFromFragments=b.default,t.readPart10Header=S.default,t.readSequenceItemsExplicit=k.default,t.readSequenceItemsImplicit=P.default,t.readSequenceItem=T.default,t.readTag=D.default,t.default=E}])})),Pi=(bi=ki)&&bi.__esModule&&Object.prototype.hasOwnProperty.call(bi,"default")?bi.default:bi;function Ti(e,t){if(16===e.bitsAllocated){var n=t.buffer,r=t.byteOffset,i=t.length;r%2&&(n=n.slice(r),r=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(n,r,i/2):e.pixelData=new Int16Array(n,r,i/2);for(var a=0;a<e.pixelData.length;a++)e.pixelData[a]=(255&(o=e.pixelData[a]))<<8|o>>8&255}else 8===e.bitsAllocated&&(e.pixelData=t);var o;return e}function Di(e,t){var n=t.buffer,r=t.byteOffset,i=t.length;return 16===e.bitsAllocated?(r%2&&(n=n.slice(r),r=0),0===e.pixelRepresentation?e.pixelData=new Uint16Array(n,r,i/2):e.pixelData=new Int16Array(n,r,i/2)):8===e.bitsAllocated||1===e.bitsAllocated?e.pixelData=t:32===e.bitsAllocated&&(r%2&&(n=n.slice(r),r=0),e.pixelData=new Float32Array(n,r,i/4)),e}function Ci(e,t){if(8===e.bitsAllocated)return e.planarConfiguration?function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),u=0,l=a.getInt32(0,!0),c=0;c<l;++c){u=c*r;var h=a.getInt32(4*(c+1),!0),f=a.getInt32(4*(c+2),!0);0===f&&(f=n.length);for(var d=r*l;h<f;){var p=o[h++];if(p>=0&&p<=127)for(var v=0;v<p+1&&u<d;++v)s[u]=o[h++],u++;else if(p<=-1&&p>=-127)for(var g=o[h++],m=0;m<1-p&&u<d;++m)s[u]=g,u++}}return e.pixelData=new Uint8Array(i),e}(e,t):function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),u=0,l=a.getInt32(0,!0),c=0;c<l;++c){u=c;var h=a.getInt32(4*(c+1),!0),f=a.getInt32(4*(c+2),!0);0===f&&(f=n.length);for(var d=r*l;h<f;){var p=o[h++];if(p>=0&&p<=127)for(var v=0;v<p+1&&u<d;++v)s[u]=o[h++],u+=e.samplesPerPixel;else if(p<=-1&&p>=-127)for(var g=o[h++],m=0;m<1-p&&u<d;++m)s[u]=g,u+=e.samplesPerPixel}}return e.pixelData=new Uint8Array(i),e}(e,t);if(16===e.bitsAllocated)return function(e,t){for(var n=t,r=e.rows*e.columns,i=new ArrayBuffer(r*e.samplesPerPixel*2),a=new DataView(n.buffer,n.byteOffset),o=new Int8Array(n.buffer,n.byteOffset),s=new Int8Array(i),u=a.getInt32(0,!0),l=0;l<u;++l){var c=0,h=0===l?1:0,f=a.getInt32(4*(l+1),!0),d=a.getInt32(4*(l+2),!0);for(0===d&&(d=n.length);f<d;){var p=o[f++];if(p>=0&&p<=127)for(var v=0;v<p+1&&c<r;++v)s[2*c+h]=o[f++],c++;else if(p<=-1&&p>=-127)for(var g=o[f++],m=0;m<1-p&&c<r;++m)s[2*c+h]=g,c++}}0===e.pixelRepresentation?e.pixelData=new Uint16Array(i):e.pixelData=new Int16Array(i);return e}(e,t);throw new Error("unsupported pixel format for RLE")}var Ei=function(){var e=Sr(Ar.mark((function e(t,n){var r;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.transferSyntax,e.t0=r,e.next="1.2.840.10008.1.2"===e.t0||"1.2.840.10008.1.2.1"===e.t0||"1.2.840.10008.1.2.1.99"===e.t0?4:"1.2.840.10008.1.2.2"===e.t0?6:"1.2.840.10008.1.2.5"===e.t0?8:"1.2.840.10008.1.2.4.80"===e.t0?10:11;break;case 4:return t=Di(t,n),e.abrupt("break",12);case 6:return t=Ti(t,n),e.abrupt("break",12);case 8:return t=Ci(t,n),e.abrupt("break",12);case 10:case 11:return e.abrupt("break",12);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ai={x00080050:"AccessionNumber",x00400556:"AcquisitionContextDescription",x00400555:"AcquisitionContextSequence",x00080022:"AcquisitionDate",x0008002a:"AcquisitionDatetime",x00181401:"AcquisitionDeviceProcessingCode",x00181400:"AcquisitionDeviceProcessingDescription",x00181310:"AcquisitionMatrix",x00200012:"AcquisitionNumber",x00180073:"AcquisitionStartCondition",x00180074:"AcquisitionStartConditionData",x00180071:"AcquisitionTerminationCondition",x00180075:"AcquisitionTerminationConditionData",x00080032:"AcquisitionTime",x00181800:"AcquisitionTimeSynchronized",x00201004:"AcquisitionsinStudy",x300a0218:"ActiveSourceDiameter",x300a021a:"ActiveSourceLength",x00181242:"ActualFrameDuration",x00404035:"ActualHumanPerformersSequence",x0018002a:"AdditionalDrugSequence",x001021b0:"AdditionalPatientHistory",x00540302:"AdministrationRouteCodeSequence",x00380010:"AdmissionID",x00380020:"AdmittingDate",x00081084:"AdmittingDiagnosesCodeSequence",x00081080:"AdmittingDiagnosesDescription",x00380021:"AdmittingTime",x300a022c:"AirKermaRateReferenceDate",x300a022e:"AirKermaRateReferenceTime",x00082220:"AnatomicRegionModifierSequence",x00082218:"AnatomicRegionSequence",x00082229:"AnatomicStructure,SpaceorRegionSequence",x00700014:"AnchorPoint",x00700004:"AnchorPointAnnotationUnits",x00700015:"AnchorPointVisibility",x00180025:"AngioFlag",x00181141:"AngularPosition",x00181144:"AngularStep",x00540090:"AngularViewVector",x21300050:"AnnotationContentSequence",x20100030:"AnnotationDisplayFormatID",x20000065:"AnnotationFlag",x0040a180:"AnnotationGroupNumber",x20300010:"AnnotationPosition",x0040b020:"AnnotationSequence",x00181191:"AnodeTargetMaterial",x00286102:"ApplicableFrameRange",x30080116:"ApplicationSetupCheck",x300a0238:"ApplicationSetupManufacturer",x300a0236:"ApplicationSetupName",x300a0234:"ApplicationSetupNumber",x300a0230:"ApplicationSetupSequence",x300a0232:"ApplicationSetupType",x300a010a:"ApplicatorDescription",x300a0108:"ApplicatorID",x300a0107:"ApplicatorSequence",x300a0109:"ApplicatorType",x300e0002:"ApprovalStatus",x30060049:"AttachedContours",x00541101:"AttenuationCorrectionMethod",x50xx200e:"AudioComments",x50xx200c:"AudioSampleData",x50xx2002:"AudioSampleFormat",x50xx2000:"AudioType",x01000426:"AuthorizationEquipmentCertificationNumber",x00181154:"AveragePulseWidth",x00541200:"AxialAcceptance",x00541201:"AxialMash",x50xx0040:"AxisLabels",x50xx0030:"AxisUnits",x20200111:"BasicColorImageSequence",x20200110:"BasicGrayscaleImageSequence",x300a00c3:"BeamDescription",x300a0084:"BeamDose",x300a0082:"BeamDoseSpecificationPoint",x300a0120:"BeamLimitingDeviceAngle",x300a0046:"BeamLimitingDeviceAngleTolerance",x300800a0:"BeamLimitingDeviceLeafPairsSequence",x300a011a:"BeamLimitingDevicePositionSequence",x300a004a:"BeamLimitingDevicePositionTolerance",x300a0121:"BeamLimitingDeviceRotationDirection",x300a00b6:"BeamLimitingDeviceSequence",x300a0048:"BeamLimitingDeviceToleranceSequence",x300a0086:"BeamMeterset",x300a00c2:"BeamName",x300a00c0:"BeamNumber",x300a00b0:"BeamSequence",x30080230:"BeamStopperPosition",x300a00c4:"BeamType",x00181080:"BeatRejectionFlag",x00400296:"BillingItemSequence",x00400320:"BillingProcedureStepSequence",x00400324:"BillingSuppliesandDevicesSequence",x00285000:"Bi-PlaneAcquisitionSequence",x00280100:"BitsAllocated",x00280101:"BitsStored",x300a0106:"BlockData",x300a00fa:"BlockDivergence",x300a00fe:"BlockName",x300a00fc:"BlockNumber",x300a0104:"BlockNumberofPoints",x300a00f4:"BlockSequence",x300a0100:"BlockThickness",x300a0102:"BlockTransmission",x300a00f5:"BlockTrayID",x300a00f8:"BlockType",x00281203:"BluePaletteColorLookupTableData",x00281103:"BluePaletteColorLookupTableDescriptor",x00180015:"BodyPartExamined",x001811a0:"BodyPartThickness",x20100100:"BorderDensity",x00700003:"BoundingBoxAnnotationUnits",x00700011:"BoundingBoxBottomRightHandCorner",x00700012:"BoundingBoxTextHorizontalJustification",x00700010:"BoundingBoxTopLeftHandCorner",x300a0263:"BrachyAccessoryDeviceID",x300a0266:"BrachyAccessoryDeviceName",x300a026a:"BrachyAccessoryDeviceNominalThickness",x300a026c:"BrachyAccessoryDeviceNominalTransmission",x300a0262:"BrachyAccessoryDeviceNumber",x300a0260:"BrachyAccessoryDeviceSequence",x300a0264:"BrachyAccessoryDeviceType",x300a00a4:"BrachyApplicationSetupDose",x300a00a2:"BrachyApplicationSetupDoseSpecificationPoint",x30080160:"BrachyControlPointDeliveredSequence",x300a02d0:"BrachyControlPointSequence",x300c0055:"BrachyReferencedDoseReferenceSequence",x300a0200:"BrachyTreatmentTechnique",x300a0202:"BrachyTreatmentType",x00101081:"BranchofService",x00280301:"BurnedInAnnotation",x30080074:"CalculatedDoseReferenceDescription",x30080076:"CalculatedDoseReferenceDoseValue",x30080072:"CalculatedDoseReferenceNumber",x30080070:"CalculatedDoseReferenceSequence",x00540306:"CalibrationDataSequence",x00500004:"CalibrationImage",x00181090:"CardiacNumberofImages",x00181402:"CassetteOrientation",x00181403:"CassetteSize",x00181710:"CenterofCircularCollimator",x00181610:"CenterofCircularShutter",x00181145:"CenterofRotationOffset",x04000115:"CertificateofSigner",x04000110:"CertificateType",x04000310:"CertifiedTimestamp",x04000305:"CertifiedTimestampType",x003a0213:"ChannelBaseline",x003a0200:"ChannelDefinitionSequence",x003a020c:"ChannelDerivationDescription",x003a0203:"ChannelLabel",x300a0284:"ChannelLength",x54000112:"ChannelMaximumValue",x54000110:"ChannelMinimumValue",x300a0282:"ChannelNumber",x003a0218:"ChannelOffset",x003a0215:"ChannelSampleSkew",x003a0210:"ChannelSensitivity",x003a0212:"ChannelSensitivityCorrectionFactor",x003a0211:"ChannelSensitivityUnitsSequence",x300a0280:"ChannelSequence",x300a02b3:"ChannelShieldID",x300a02b4:"ChannelShieldName",x300a02b8:"ChannelShieldNominalThickness",x300a02ba:"ChannelShieldNominalTransmission",x300a02b2:"ChannelShieldNumber",x300a02b0:"ChannelShieldSequence",x003a0209:"ChannelSourceModifiersSequence",x003a0208:"ChannelSourceSequence",x003a0205:"ChannelStatus",x003a0214:"ChannelTimeSkew",x300a0286:"ChannelTotalTime",x00180040:"CineRate",x00080104:"CodeMeaning",x0008010d:"CodeSetExtensionCreatorUID",x0008010b:"CodeSetExtensionFlag",x00080100:"CodeValue",x00080102:"CodingSchemeDesignator",x00080103:"CodingSchemeVersion",x00541210:"CoincidenceWindowWidth",x20000063:"CollationFlag",x00181702:"CollimatorLeftVerticalEdge",x00181708:"CollimatorLowerHorizontalEdge",x00181704:"CollimatorRightVerticalEdge",x00181700:"CollimatorShape",x00181181:"CollimatorType",x00181706:"CollimatorUpperHorizontalEdge",x00181180:"Collimator/gridName",x20000062:"ColorImagePrintingFlag",x00181450:"ColumnAngulation",x00280011:"Columns",x00400310:"CommentsonRadiationDose",x00400280:"CommentsonthePerformedProcedureStep",x00400400:"CommentsontheScheduledProcedureStep",x300a00e8:"CompensatorColumns",x300a00e5:"CompensatorID",x300a00e4:"CompensatorNumber",x300a00e9:"CompensatorPixelSpacing",x300a00ea:"CompensatorPosition",x300a00e7:"CompensatorRows",x300a00e3:"CompensatorSequence",x300a00ec:"CompensatorThicknessData",x300a00eb:"CompensatorTransmissionData",x300a00ee:"CompensatorType",x0040a491:"CompletionFlag",x0040a492:"CompletionFlagDescription",x001811a2:"CompressionForce",x0040a168:"ConceptCodeSequence",x0040a043:"ConceptameCodeSequence",x00401008:"ConfidentialityCode",x00403001:"ConfidentialityConstraintonPatientDataDescription",x20100150:"ConfigurationInformation",x20100152:"ConfigurationInformationDescription",x300a0021:"ConstraintWeight",x00080023:"ContentDate",x0040a730:"ContentSequence",x0040a504:"ContentTemplateSequence",x00080033:"ContentTime",x00080107:"ContextGroupLocalVersion",x00080106:"ContextGroupVersion",x0008010f:"ContextIdentifier",x0040a050:"ContinuityOfContent",x30060050:"ContourData",x30060042:"ContourGeometricType",x30060016:"ContourImageSequence",x30060048:"ContourNumber",x30060045:"ContourOffsetVector",x30060040:"ContourSequence",x30060044:"ContourSlabThickness",x00102110:"ContrastAllergies",x00181047:"ContrastFlowDuration(s)",x00181046:"ContrastFlowRate(s)",x00286112:"ContrastFrameAveraging",x00180014:"Contrast/BolusAdministrationRouteSequence",x00180010:"Contrast/BolusAgent",x00180012:"Contrast/BolusAgentSequence",x00181048:"Contrast/BolusIngredient",x00181049:"Contrast/BolusIngredientConcentration",x00181040:"Contrast/BolusRoute",x00181042:"Contrast/BolusStartTime",x00181043:"Contrast/BolusStopTime",x00181044:"Contrast/BolusTotalDose",x00181041:"Contrast/BolusVolume",x300a02d4:"ControlPoint3DPosition",x30080040:"ControlPointDeliverySequence",x300a0112:"ControlPointIndex",x300a02d2:"ControlPointRelativePosition",x300a0111:"ControlPointSequence",x00080064:"ConversionType",x00181210:"ConvolutionKernel",x50xx0112:"CoordinateStartValue",x50xx0114:"CoordinateStepValue",x004008da:"CoordinateSystemAxisCodeSequence",x00280051:"CorrectedImage",x00181243:"CountRate",x00102150:"CountryofResidence",x00180070:"CountsAccumulated",x00541400:"CountsIncluded",x00541002:"CountsSource",x00185026:"CranialThermalIndex",x21000040:"CreationDate",x21000050:"CreationTime",x300a010c:"CumulativeDoseReferenceCoefficient",x30080052:"CumulativeDosetoDoseReference",x300a0134:"CumulativeMetersetWeight",x300a02d6:"CumulativeTimeWeight",x30080022:"CurrentFractionNumber",x00380300:"CurrentPatientLocation",x0040a375:"CurrentRequestedProcedureEvidenceSequence",x30080200:"CurrentTreatmentStatus",x50xx1001:"CurveActivationLayer",x50xx3000:"CurveData",x50xx0110:"CurveDataDescriptor",x00080025:"CurveDate",x50xx0022:"CurveDescription",x50xx0005:"CurveDimensions",x50xx2500:"CurveLabel",x00200024:"CurveNumber",x50xx0106:"CurveRange",x00080035:"CurveTime",x00180090:"DataCollectionDiameter",x04000020:"DataElementsSigned",x00540063:"DataInformationSequence",xfffcfffc:"DataSetTrailingPadding",x50xx0103:"DataValueRepresentation",x0040a121:"Date",x00181200:"DateofLastCalibration",x0018700c:"DateofLastDetectorCalibration",x00181012:"DateofSecondaryCapture",x0040a120:"DateTime",x00181318:"dB/dt",x00541401:"DeadTimeCorrectionFlag",x00541324:"DeadTimeFactor",x00541102:"DecayCorrection",x00541321:"DecayFactor",x202000a2:"Decimate/CropResult",x201000a6:"DefaultMagnificationType",x20100054:"DefaultPrinterResolutionID",x201000a8:"DefaultSmoothingType",x30080134:"DeliveredChannelTotalTime",x30080044:"DeliveredMeterset",x30080138:"DeliveredNumberofPulses",x30080036:"DeliveredPrimaryMeterset",x3008013c:"DeliveredPulseRepetitionInterval",x30080037:"DeliveredSecondaryMeterset",x3008003b:"DeliveredTreatmentTime",x300a0023:"DeliveryMaximumDose",x300a0022:"DeliveryWarningDose",x00185050:"DepthofScanField",x00082111:"DerivationDescription",x21000140:"DestinationAE",x00187016:"DetectorActivationOffsetFromExposure",x00187026:"DetectorActiveDimension(s)",x00187028:"DetectorActiveOrigin",x00187024:"DetectorActiveShape",x00187014:"DetectorActiveTime",x0018701a:"DetectorBinning",x00187000:"DetectorConditionsNominalFlag",x00187005:"DetectorConfiguration",x00187006:"DetectorDescription",x00187020:"DetectorElementPhysicalSize",x00541203:"DetectorElementSize",x00187022:"DetectorElementSpacing",x0018700a:"DetectorID",x00540022:"DetectorInformationSequence",x00541104:"DetectorLinesofResponseUsed",x00187008:"DetectorMode",x00181530:"DetectorPrimaryAngle",x00181531:"DetectorSecondaryAngle",x00187001:"DetectorTemperature",x00187012:"DetectorTimeSinceLastExposure",x00187004:"DetectorType",x00540020:"DetectorVector",x00500020:"DeviceDescription",x00500016:"DeviceDiameter",x00500017:"DeviceDiameterUnits",x00500014:"DeviceLength",x00500010:"DeviceSequence",x00181000:"DeviceSerialNumber",x00500018:"DeviceVolume",x30020034:"DiaphragmPosition",x00181023:"DigitalImageFormatAcquired",x04000105:"DigitalSignatureDateTime",x04000100:"DigitalSignatureUID",xfffafffa:"DigitalSignaturesSequence",x00182020:"DigitizingDeviceTransportDirection",x00041220:"DirectoryRecordSequence",x00041430:"DirectoryRecordType",x00380030:"DischargeDate",x00380044:"DischargeDiagnosisCodeSequence",x00380040:"DischargeDiagnosisDescription",x00380032:"DischargeTime",x00182006:"DisplayWindowLabelVector",x00700053:"DisplayedAreaBottomRightHandCorner",x0070005a:"DisplayedAreaSelectionSequence",x00700052:"DisplayedAreaTopLeftHandCorner",x00181110:"DistanceSourcetoDetector",x00400306:"DistanceSourcetoEntrance",x00181111:"DistanceSourcetoPatient",x00400307:"DistanceSourcetoSupport",x4008011a:"DistributionAddress",x40080119:"DistributionName",x00186034:"DopplerCorrectionAngle",x00186038:"DopplerSampleVolumeXPosition",x0018603a:"DopplerSampleVolumeYPosition",x00541322:"DoseCalibrationFactor",x30040006:"DoseComment",x3004000e:"DoseGridScaling",x30080048:"DoseRateDelivered",x300a0115:"DoseRateSet",x300a0016:"DoseReferenceDescription",x300a0012:"DoseReferenceNumber",x300a0018:"DoseReferencePointCoordinates",x300a0010:"DoseReferenceSequence",x300a0014:"DoseReferenceStructureType",x300a0020:"DoseReferenceType",x3004000a:"DoseSummationType",x30040004:"DoseType",x30040002:"DoseUnits",x30040012:"DoseValue",x30040058:"DVHData",x30040052:"DVHDoseScaling",x30040072:"DVHMaximumDose",x30040074:"DVHMeanDose",x30040070:"DVHMinimumDose",x30040042:"DVHNormalizationDoseValue",x30040040:"DVHNormalizationPoint",x30040056:"DVHNumberofBins",x30040060:"DVHReferencedROISequence",x30040062:"DVHROIContributionType",x30040050:"DVHSequence",x30040001:"DVHType",x30040054:"DVHVolumeUnits",x00180086:"EchoNumber(s)",x00180081:"EchoTime",x00180091:"EchoTrainLength",x00180072:"EffectiveSeriesDuration",x20100110:"EmptyImageDensity",x300c0009:"EndCumulativeMetersetWeight",x3008007a:"EndMeterset",x00540012:"EnergyWindowInformationSequence",x00540014:"EnergyWindowLowerLimit",x00540018:"EnergyWindowName",x00540308:"EnergyWindowNumber",x00540013:"EnergyWindowRangeSequence",x00540015:"EnergyWindowUpperLimit",x00540010:"EnergyWindowVector",x00400302:"EntranceDose",x00408302:"EntranceDoseinmGy",x00181114:"EstimatedRadiographicMagnificationFactor",x00102160:"EthnicGroup",x00082130:"EventElapsedTime(s)",x00082132:"EventTimerName(s)",x21000020:"ExecutionStatus",x21000030:"ExecutionStatusInfo",x00404011:"ExpectedCompletionDateandTime",x00400303:"ExposedArea",x00181152:"Exposure",x00187060:"ExposureControlMode",x00187062:"ExposureControlModeDescription",x0040030e:"ExposureDoseSequence",x00181153:"ExposureinuAs",x30020030:"ExposureSequence",x00187064:"ExposureStatus",x00181150:"ExposureTime",x00188150:"ExposureTimeinmS",x00187010:"ExposuresonDetectorSinceLastCalibration",x00187011:"ExposuresonDetectorSinceManufactured",x00181404:"ExposuresonPlate",x00080058:"FailedSOPInstanceUIDList",x00081198:"FailedSOPSequence",x00081197:"FailureReason",x00181149:"FieldofViewDimension(s)",x00187034:"FieldofViewHorizontalFlip",x00187030:"FieldofViewOrigin",x00187032:"FieldofViewRotation",x00181147:"FieldofViewShape",x00020001:"FileMetaInformationVersion",x00041212:"File-setConsistencyFlag",x00041141:"File-setDescriptorFileID",x00041130:"File-setID",x00402017:"FillerOrderNumber/ImagingServiceRequest",x21300030:"FilmBoxContentSequence",x00400321:"FilmConsumptionSequence",x20000040:"FilmDestination",x20100040:"FilmOrientation",x20000050:"FilmSessionLabel",x20100050:"FilmSizeID",x003a0221:"FilterHighFrequency",x003a0220:"FilterLowFrequency",x00187050:"FilterMaterial",x00187054:"FilterThicknessMaximum",x00187052:"FilterThicknessMinimum",x00181160:"FilterType",x300a010e:"FinalCumulativeMetersetWeight",x300a02c8:"FinalCumulativeTimeWeight",x30080054:"FirstTreatmentDate",x300a0196:"FixationDeviceDescription",x300a0194:"FixationDeviceLabel",x300a0198:"FixationDevicePosition",x300a0190:"FixationDeviceSequence",x300a0192:"FixationDeviceType",x00181314:"FlipAngle",x00181182:"FocalDistance",x00181190:"FocalSpot(s)",x00185012:"FocusDepth",x300a0071:"FractionGroupNumber",x300a0070:"FractionGroupSequence",x30080220:"FractionGroupSummarySequence",x30080224:"FractionGroupType",x30020029:"FractionNumber",x300a007b:"FractionPattern",x30080240:"FractionStatusSummarySequence",x00181066:"FrameDelay",x00280009:"FrameIncrementPointer",x00182002:"FrameLabelVector",x00286020:"FrameNumbersofInterest(FOI)",x300600c0:"FrameofReferenceRelationshipSequence",x300600c8:"FrameofReferenceTransformationComment",x300600c6:"FrameofReferenceTransformationMatrix",x300600c4:"FrameofReferenceTransformationType",x00200052:"FrameofReferenceUID",x00182003:"FramePrimaryAngleVector",x00541300:"FrameReferenceTime",x00182004:"FrameSecondaryAngleVector",x00181063:"FrameTime",x00181065:"FrameTimeVector",x00286022:"Frame(s)ofInterestDescription",x00181064:"FramingType",x300a011e:"GantryAngle",x300a0044:"GantryAngleTolerance",x300a011f:"GantryRotationDirection",x00181121:"Gantry/DetectorSlew",x00181120:"Gantry/DetectorTilt",x00540062:"GatedInformationSequence",x00404002:"GeneralPurposePerformedProcedureStepStatus",x00404003:"GeneralPurposeScheduledProcedureStepPriority",x00404001:"GeneralPurposeScheduledProcedureStepStatus",x00181170:"GeneratorPower",x00700001:"GraphicAnnotationSequence",x00700005:"GraphicAnnotationUnits",x00700022:"GraphicData",x00700020:"GraphicDimensions",x00700024:"GraphicFilled",x00700002:"GraphicLayer",x00700068:"GraphicLayerDescription",x00700062:"GraphicLayerOrder",x00700066:"GraphicLayerRecommendedDisplayGrayscaleValue",x00700067:"GraphicLayerRecommendedDisplayRGBValue",x00700060:"GraphicLayerSequence",x00700009:"GraphicObjectSequence",x00700023:"GraphicType",x00281202:"GreenPaletteColorLookupTableData",x00281102:"GreenPaletteColorLookupTableDescriptor",x00181166:"Grid",x00187040:"GridAbsorbingMaterial",x00187046:"GridAspectRatio",x0018704c:"GridFocalDistance",x3004000c:"GridFrameOffsetVector",x00187048:"GridPeriod",x00187044:"GridPitch",x00187041:"GridSpacingMaterial",x00187042:"GridThickness",x00020000:"GroupLength",x00040000:"GroupLength",x00400314:"HalfValueLayer",x00181011:"HardcopyCreationDeviceID",x0018101b:"HardcopyDeviceManufacturer'sModelName",x00181017:"HardcopyDeviceManufacturer",x0018101a:"HardcopyDeviceSoftwareVersion",x00181088:"HeartRate",x00280102:"HighBit",x00181082:"HighR-RValue",x300a00c7:"High-DoseTechniqueType",x00603008:"HistogramBinWidth",x00603020:"HistogramData",x00603010:"HistogramExplanation",x00603004:"HistogramFirstBinValue",x00603006:"HistogramLastBinValue",x00603002:"HistogramNumberofBins",x00603000:"HistogramSequence",x00404009:"HumanPerformerCodeSequence",x00404037:"HumanPerformer'sName",x00404036:"HumanPerformer'sOrganization",x00880200:"IconImageSequence",x0040a525:"IdenticalDocumentsSequence",x2010015e:"Illumination",x0018115e:"ImageAreaDoseProduct",x21300040:"ImageBoxContentSequence",x2000006a:"ImageBoxPresentationLUTFlag",x0040071a:"ImageCenterPointCoordinatesSequence",x00204000:"ImageComments",x20100010:"ImageDisplayFormat",x60xx0051:"ImageFrameOrigin",x00700041:"ImageHorizontalFlip",x00540400:"ImageID",x00541330:"ImageIndex",x00200062:"ImageLaterality",x00200037:"ImageOrientation(Patient)",x21300060:"ImageOverlayBoxContentSequence",x20000067:"ImageOverlayFlag",x30020011:"ImagePlanePixelSpacing",x20200010:"ImagePosition",x00200032:"ImagePosition(Patient)",x00700042:"ImageRotation",x00185210:"ImageTransformationMatrix",x00185212:"ImageTranslationVector",x00181067:"ImageTriggerDelay",x00080008:"ImageType",x00180085:"ImagedNucleus",x00181164:"ImagerPixelSpacing",x00201002:"ImagesinAcquisition",x300a00cc:"ImagingDevice-SpecificAcquisitionParameters",x00180084:"ImagingFrequency",x00402400:"ImagingServiceRequestComments",x00281300:"ImplantPresent",x00020012:"ImplementationClassUID",x00020013:"ImplementationVersionName",x40080300:"Impressions",x00404020:"InputAvailabilityFlag",x00404021:"InputInformationSequence",x00080056:"InstanceAvailability",x00080012:"InstanceCreationDate",x00080013:"InstanceCreationTime",x00080014:"InstanceCreatorUID",x00200013:"InstanceNumber",x00080081:"InstitutionAddress",x00080082:"InstitutionCodeSequence",x00080080:"InstitutionName",x00081040:"InstitutionalDepartmentName",x00181162:"IntensifierSize",x00500019:"Inter-markerDistance",x40080112:"InterpretationApprovalDate",x40080113:"InterpretationApprovalTime",x40080111:"InterpretationApproverSequence",x4008010c:"InterpretationAuthor",x40080117:"InterpretationDiagnosisCodeSequence",x40080115:"InterpretationDiagnosisDescription",x40080200:"InterpretationID",x40080202:"InterpretationIDIssuer",x40080100:"InterpretationRecordedDate",x40080101:"InterpretationRecordedTime",x40080102:"InterpretationRecorder",x40080212:"InterpretationStatusID",x4008010b:"InterpretationText",x4008010a:"InterpretationTranscriber",x40080108:"InterpretationTranscriptionDate",x40080109:"InterpretationTranscriptionTime",x40080210:"InterpretationTypeID",x00181083:"IntervalsAcquired",x00181084:"IntervalsRejected",x00180029:"InterventionDrugCodeSequence",x00180028:"InterventionDrugDose",x00180026:"InterventionDrugInformationSequence",x00180034:"InterventionDrugName",x00180035:"InterventionDrugStartTime",x00180027:"InterventionDrugStopTime",x00180038:"InterventionalStatus",x00180036:"InterventionalTherapySequence",x00180082:"InversionTime",x300a012c:"IsocenterPosition",x00402004:"IssueDateofImagingServiceRequest",x00402005:"IssueTimeofImagingServiceRequest",x00380011:"IssuerofAdmissionID",x00100021:"IssuerofPatientID",xfffee000:"Item",xfffee00d:"ItemDelimitationItem",x00200019:"ItemNumber",x00183100:"IVUSAcquisition",x00183102:"IVUSGatedRate",x00183101:"IVUSPullbackRate",x00183103:"IVUSPullbackStartFrameNumber",x00183104:"IVUSPullbackStopFrameNumber",x00180060:"KVP",x00280107:"LargestImagePixelValue",x00280111:"LargestImagePixelValueinPlane",x00280109:"LargestPixelValueinSeries",x001021d0:"LastMenstrualDate",x00200060:"Laterality",x300a00be:"LeafPositionBoundaries",x300a011c:"Leaf/JawPositions",x00183105:"LesionNumber",x00200026:"LookupTable(LUT)Number",x00282110:"LossyImageCompression",x00282112:"LossyImageCompressionRatio",x00181081:"LowR-RValue",x00283006:"LUTData",x00283002:"LUTDescriptor",x00283003:"LUTExplanation",x04000015:"MACAlgorithm",x04000010:"MACCalculationTransferSyntaxUID",x04000005:"MACIDnumber",x4ffe0001:"MACParametersSequence",x00180087:"MagneticFieldStrength",x20100060:"MagnificationType",x20400074:"MagnifytoNumberofColumns",x00080070:"Manufacturer",x00081090:"Manufacturer'sModelName",x00080105:"MappingResource",x00286110:"MaskFrameNumbers",x00286101:"MaskOperation",x00286190:"MaskOperationExplanation",x00286030:"MaskPointer(s)",x00286114:"MaskSub-pixelShift",x00286100:"MaskSubtractionSequence",x300a00e1:"MaterialID",x20100130:"MaxDensity",x20100154:"MaximumCollatedFilms",x50xx0105:"MaximumCoordinateValue",x20000061:"MaximumMemoryAllocation",x30080012:"MeasuredDoseDescription",x30080064:"MeasuredDoseReferenceNumber",x30080010:"MeasuredDoseReferenceSequence",x30080014:"MeasuredDoseType",x30080016:"MeasuredDoseValue",x0040a300:"MeasuredValueSequence",x004008ea:"MeasurementUnitsCodeSequence",x00400295:"MeasuringUnitsSequence",x00185022:"MechanicalIndex",x200000a2:"MediaInstalledSequence",x00020002:"MediaStorageSOPClassUID",x00020003:"MediaStorageSOPInstanceUID",x00102000:"MedicalAlerts",x00101090:"MedicalRecordLocator",x20000030:"MediumType",x20000060:"MemoryAllocation",x200000a0:"MemoryBitDepth",x30020032:"MetersetExposure",x00101080:"MilitaryRank",x20100120:"MinDensity",x50xx0104:"MinimumCoordinateValue",x00080061:"ModalitiesinStudy",x00080060:"Modality",x00283000:"ModalityLUTSequence",x00283004:"ModalityLUTType",x0040a195:"ModifierCodeSequence",x30080056:"MostRecentTreatmentDate",x00180023:"MRAcquisitionType",x00041504:"MRDRDirectoryRecordOffset",x00404006:"MultipleCopiesFlag",x003a0020:"MultiplexGroupLabel",x00181068:"MultiplexGroupTimeOffset",x00081060:"NameofPhysician(s)ReadingStudy",x00401010:"NamesofIntendedRecipientsofResults",x300a0114:"NominalBeamEnergy",x300a0015:"NominalBeamEnergyUnit",x00181062:"NominalInterval",x300a001a:"NominalPriorDose",x00182010:"NominalScannedPixelSpacing",x00404032:"Non-DICOMOutputCodeSequence",x30040008:"NormalizationPoint",x003a0223:"NotchFilterBandwidth",x003a0222:"NotchFilterFrequency",x00180083:"NumberofAverages",x300a0080:"NumberofBeams",x300a00f0:"NumberofBlocks",x300a00ed:"NumberofBoli",x300a00a0:"NumberofBrachyApplicationSetups",x50xx2004:"NumberofChannels",x300a00e0:"NumberofCompensators",x30060046:"NumberofContourPoints",x300a0110:"NumberofControlPoints",x20000010:"NumberofCopies",x00540021:"NumberofDetectors",x00540011:"NumberofEnergyWindows",x00082129:"NumberofEventTimers",x21000170:"NumberofFilms",x300a0079:"NumberofFractionPatternDigitsPerDay",x3008005a:"NumberofFractionsDelivered",x300a0078:"NumberofFractionsPlanned",x00280008:"NumberofFrames",x60xx0015:"NumberofFramesinOverlay",x00540033:"NumberofFramesinPhase",x00540053:"NumberofFramesinRotation",x00700021:"NumberofGraphicPoints",x300a00bc:"NumberofLeaf/JawPairs",x00201204:"NumberofPatientRelatedInstances",x00201202:"NumberofPatientRelatedSeries",x00201200:"NumberofPatientRelatedStudies",x00180089:"NumberofPhaseEncodingSteps",x00540031:"NumberofPhases",x50xx0010:"NumberofPoints",x300a028a:"NumberofPulses",x00041600:"NumberofReferences",x00540051:"NumberofRotations",x00540061:"NumberofR-RIntervals",x50xx2006:"NumberofSamples",x00201209:"NumberofSeriesRelatedInstances",x00540081:"NumberofSlices",x00082124:"NumberofStages",x00201208:"NumberofStudyRelatedInstances",x00201206:"NumberofStudyRelatedSeries",x00186050:"NumberofTableBreakPoints",x00186056:"NumberofTableEntries",x00200105:"NumberofTemporalPositions",x00540101:"NumberofTimeSlices",x00540071:"NumberofTimeSlots",x00181495:"NumberofTomosynthesisSourceImages",x00540211:"NumberofTriggersinPhase",x0008212a:"NumberofViewsinStage",x003a0005:"NumberofWaveformChannels",x003a0010:"NumberofWaveformSamples",x300a00d0:"NumberofWedges",x0040a30a:"NumericValue",x0040a032:"ObservationDateTime",x30060082:"ObservationNumber",x00102180:"Occupation",x00041420:"OffsetofReferencedLower-LevelDirectoryEntity",x00041200:"OffsetoftheFirstDirectoryRecordoftheRootDirectoryEntity",x00041202:"OffsetoftheLastDirectoryRecordoftheRootDirectoryEntity",x00041400:"OffsetoftheNextDirectoryRecord",x00081070:"Operators'Name",x00402010:"OrderCallbackPhoneNumber",x00402008:"OrderEnteredBy",x00402009:"OrderEnterer'sLocation",x300a002a:"OrganatRiskFull-volumeDose",x300a002b:"OrganatRiskLimitDose",x300a002c:"OrganatRiskMaximumDose",x300a002d:"OrganatRiskOverdoseVolumeFraction",x00400316:"OrganDose",x00400318:"OrganExposed",x213000c0:"OriginalImageSequence",x21000070:"Originator",x201000a7:"OtherMagnificationTypesAvailable",x200000a4:"OtherMediaAvailableSequence",x00101000:"OtherPatientIDs",x00101001:"OtherPatientNames",x201000a9:"OtherSmoothingTypesAvailable",x00201070:"OtherStudyNumbers",x00404033:"OutputInformationSequence",x00185000:"OutputPower",x60xx1001:"OverlayActivationLayer",x20400082:"OverlayBackgroundDensity",x60xx0102:"OverlayBitPosition",x60xx0100:"OverlayBitsAllocated",x60xx0011:"OverlayColumns",x60xx3000:"OverlayData",x00080024:"OverlayDate",x60xx0022:"OverlayDescription",x20400080:"OverlayForegroundDensity",x60xx1500:"OverlayLabel",x20400060:"OverlayMagnificationType",x00200022:"OverlayNumber",x20400072:"OverlayorImageMagnification",x60xx0050:"OverlayOrigin",x20400020:"OverlayPixelDataSequence",x60xx0052:"OverlayPlaneOrigin",x60xx0012:"OverlayPlanes",x60xx0010:"OverlayRows",x20400070:"OverlaySmoothingType",x60xx0045:"OverlaySubtype",x00080034:"OverlayTime",x60xx0040:"OverlayType",x30080062:"OverrideParameterPointer",x30080066:"OverrideReason",x30080060:"OverrideSequence",x21000160:"OwnerID",x00182001:"PageNumberVector",x00281199:"PaletteColorLookupTableUID",x00281350:"PartialView",x00281351:"PartialViewDescription",x300a0184:"PatientAdditionalPosition",x00104000:"PatientComments",x00540414:"PatientGantryRelationshipCodeSequence",x00100020:"PatientID",x00200020:"PatientOrientation",x00540410:"PatientOrientationCodeSequence",x00540412:"PatientOrientationModifierCodeSequence",x00185100:"PatientPosition",x300a0182:"PatientSetupNumber",x300a0180:"PatientSetupSequence",x00380500:"PatientState",x300a0122:"PatientSupportAngle",x300a004c:"PatientSupportAngleTolerance",x300a0123:"PatientSupportRotationDirection",x00401004:"PatientTransportArrangements",x00100010:"Patient'sName",x00100102:"Patient'sPrimaryLanguageCodeModifierSequence",x00100101:"Patient'sPrimaryLanguageCodeSequence",x00102154:"Patient'sTelephoneNumbers",x00101040:"Patient'sAddress",x00101010:"Patient'sAge",x00100030:"Patient'sBirthDate",x00101005:"Patient'sBirthName",x00100032:"Patient'sBirthTime",x00380400:"Patient'sInstitutionResidence",x00100050:"Patient'sInsurancePlanCodeSequence",x00101060:"Patient'sMother'sBirthName",x001021f0:"Patient'sReligiousPreference",x00100040:"Patient'sSex",x00101020:"Patient'sSize",x00101030:"Patient'sWeight",x00540038:"PauseBetweenFrames",x00180094:"PercentPhaseFieldofView",x00180093:"PercentSampling",x00400243:"PerformedLocation",x0040a372:"PerformedProcedureCodeSequence",x00400254:"PerformedProcedureStepDescription",x00400250:"PerformedProcedureStepEndDate",x00400251:"PerformedProcedureStepEndTime",x00400253:"PerformedProcedureStepID",x00400244:"PerformedProcedureStepStartDate",x00400245:"PerformedProcedureStepStartTime",x00400252:"PerformedProcedureStepStatus",x00400255:"PerformedProcedureTypeDescription",x00404007:"PerformedProcessingApplicationsCodeSequence",x00400260:"PerformedProtocolCodeSequence",x00400340:"PerformedSeriesSequence",x00400241:"PerformedStationAETitle",x00404029:"PerformedStationClassCodeSequence",x00404030:"PerformedStationGeographicLocationCodeSequence",x00400242:"PerformedStationName",x00404028:"PerformedStationNameCodeSequence",x00404019:"PerformedWorkitemCodeSequence",x00081050:"PerformingPhysician'sName",x0040a123:"PersonName",x0040a385:"PertinentOtherEvidenceSequence",x00540036:"PhaseDelay",x00181312:"PhaseEncodingDirection",x00540032:"PhaseInformationSequence",x00540030:"PhaseVector",x00181261:"PhosphorType",x00280004:"PhotometricInterpretation",x00187065:"PhototimerSetting",x0018602c:"PhysicalDeltaX",x0018602e:"PhysicalDeltaY",x00186024:"PhysicalUnitsXDirection",x00186026:"PhysicalUnitsYDirection",x40080114:"PhysicianApprovingInterpretation",x00081048:"Physician(s)ofRecord",x00280034:"PixelAspectRatio",x00180095:"PixelBandwidth",x0018604e:"PixelComponentDataType",x00186046:"PixelComponentMask",x00186044:"PixelComponentOrganization",x0018604c:"PixelComponentPhysicalUnits",x00186048:"PixelComponentRangeStart",x0018604a:"PixelComponentRangeStop",x7fe00010:"PixelData",x00281040:"PixelIntensityRelationship",x00281041:"PixelIntensityRelationshipSign",x00280120:"PixelPaddingValue",x00280103:"PixelRepresentation",x00280030:"PixelSpacing",x004008d8:"PixelSpacingSequence",x00402016:"PlacerOrderNumber/ImagingServiceRequest",x00280006:"PlanarConfiguration",x00280012:"Planes",x300a00ca:"PlannedVerificationImageSequence",x00181004:"PlateID",x00181260:"PlateType",x20200020:"Polarity",x00201040:"PositionReferenceIndicator",x00181500:"PositionerMotion",x00181510:"PositionerPrimaryAngle",x00181520:"PositionerPrimaryAngleIncrement",x00181511:"PositionerSecondaryAngle",x00181521:"PositionerSecondaryAngleIncrement",x00181508:"PositionerType",x00185021:"PostprocessingFunction",x0040a360:"PredecessorDocumentsSequence",x00181244:"PreferredPlaybackSequencing",x001021c0:"PregnancyStatus",x00400012:"Pre-Medication",x300a000e:"PrescriptionDescription",x00700082:"PresentationCreationDate",x00700083:"PresentationCreationTime",x00700084:"PresentationCreator'sName",x00700081:"PresentationDescription",x00080068:"PresentationIntentType",x00700080:"PresentationLabel",x21300080:"PresentationLUTContentSequence",x20000069:"PresentationLUTFlag",x20500010:"PresentationLUTSequence",x20500020:"PresentationLUTShape",x00700102:"PresentationPixelAspectRatio",x00700103:"PresentationPixelMagnificationRatio",x00700101:"PresentationPixelSpacing",x00700100:"PresentationSizeMode",x00082230:"PrimaryAnatomicStructureModifierSequence",x00082228:"PrimaryAnatomicStructureSequence",x300a00b3:"PrimaryDosimeterUnit",x00541310:"Primary(Prompts)CountsAccumulated",x21200050:"PrintJobDescriptionSequence",x21000010:"PrintJobID",x21300010:"PrintManagementCapabilitiesSequence",x20000020:"PrintPriority",x21100099:"PrintQueueID",x21300015:"PrinterCharacteristicsSequence",x2000001e:"PrinterConfigurationSequence",x21100030:"PrinterName",x20100376:"PrinterPixelSpacing",x20100052:"PrinterResolutionID",x21100010:"PrinterStatus",x21100020:"PrinterStatusInfo",x200000a1:"PrintingBitDepth",x0008010c:"PrivateCodingSchemeCreatorUID",x00020102:"PrivateInformation",x00020100:"PrivateInformationCreatorUID",x00041432:"PrivateRecordUID",x00081032:"ProcedureCodeSequence",x00185020:"ProcessingFunction",x00185104:"ProjectionEponymousNameCodeSequence",x213000a0:"ProposedStudySequence",x00181030:"ProtocolName",x00186032:"PulseRepetitionFrequency",x300a028c:"PulseRepetitionInterval",x0040a170:"PurposeofReferenceCodeSequence",x00181085:"PVCRejection",x00280300:"QualityControlImage",x00400294:"Quantity",x00400293:"QuantitySequence",x00080052:"Query/RetrieveLevel",x21200010:"QueueStatus",x00286040:"RWavePointer",x00181142:"RadialPosition",x30020020:"RadiationMachineName",x30020022:"RadiationMachineSAD",x30020024:"RadiationMachineSSD",x0018115a:"RadiationMode",x00181155:"RadiationSetting",x300a00c6:"RadiationType",x00540300:"RadionuclideCodeSequence",x00181075:"RadionuclideHalfLife",x00181076:"RadionuclidePositronFraction",x00181074:"RadionuclideTotalDose",x00180031:"Radiopharmaceutical",x00540304:"RadiopharmaceuticalCodeSequence",x00540016:"RadiopharmaceuticalInformationSequence",x00181070:"RadiopharmaceuticalRoute",x00181077:"RadiopharmaceuticalSpecificActivity",x00181072:"RadiopharmaceuticalStartTime",x00181073:"RadiopharmaceuticalStopTime",x00181071:"RadiopharmaceuticalVolume",x00181712:"RadiusofCircularCollimator",x00181612:"RadiusofCircularShutter",x00541100:"RandomsCorrectionMethod",x00321030:"ReasonforStudy",x00402001:"ReasonfortheImagingServiceRequest",x00401002:"ReasonfortheRequestedProcedure",x00181250:"ReceivingCoil",x00082144:"RecommendedDisplayFrameRate",x00281090:"RecommendedViewingMode",x00181100:"ReconstructionDiameter",x00541103:"ReconstructionMethod",x00041410:"RecordIn-useFlag",x300800d0:"RecordedBlockSequence",x30080120:"RecordedBrachyAccessoryDeviceSequence",x30080130:"RecordedChannelSequence",x30080150:"RecordedChannelShieldSequence",x300800c0:"RecordedCompensatorSequence",x30080140:"RecordedSourceApplicatorSequence",x30080100:"RecordedSourceSequence",x300800b0:"RecordedWedgeSequence",x00181156:"RectificationType",x00281201:"RedPaletteColorLookupTableData",x00281101:"RedPaletteColorLookupTableDescriptor",x300a022a:"ReferenceAirKermaRate",x300a00c8:"ReferenceImageNumber",x00186028:"ReferencePixelPhysicalValueX",x0018602a:"ReferencePixelPhysicalValueY",x00186020:"ReferencePixelX0",x00186022:"ReferencePixelY0",x40080103:"ReferencetoRecordedSound",x20100520:"ReferencedBasicAnnotationBoxSequence",x300c0006:"ReferencedBeamNumber",x300c0004:"ReferencedBeamSequence",x300c00e0:"ReferencedBlockNumber",x300c00b0:"ReferencedBolusSequence",x30080122:"ReferencedBrachyAccessoryDeviceNumber",x300c000c:"ReferencedBrachyApplicationSetupNumber",x300c000a:"ReferencedBrachyApplicationSetupSequence",x30080092:"ReferencedCalculatedDoseReferenceNumber",x30080090:"ReferencedCalculatedDoseReferenceSequence",x30080152:"ReferencedChannelShieldNumber",x300c00d0:"ReferencedCompensatorNumber",x0040db73:"ReferencedContentItemIdentifier",x300c00f0:"ReferencedControlPointIndex",x00081145:"ReferencedCurveSequence",x0040a13a:"ReferencedDatetime",x300c0051:"ReferencedDoseReferenceNumber",x300c0050:"ReferencedDoseReferenceSequence",x300c0080:"ReferencedDoseSequence",x00041500:"ReferencedFileID",x20000500:"ReferencedFilmBoxSequence",x20100500:"ReferencedFilmSessionSequence",x300c0022:"ReferencedFractionGroupNumber",x300c0020:"ReferencedFractionGroupSequence",x30080223:"ReferencedFractionNumber",x00081160:"ReferencedFrameNumber",x0040a136:"ReferencedFrameNumbers",x30060010:"ReferencedFrameofReferenceSequence",x30060024:"ReferencedFrameofReferenceUID",x00404016:"ReferencedGeneralPurposeScheduledProcedureStepSequence",x00404023:"ReferencedGeneralPurposeScheduledProcedureStepTransactionUID",x20100510:"ReferencedImageBoxSequence",x00081140:"ReferencedImageSequence",x0008114a:"ReferencedInstanceSequence",x40080050:"ReferencedInterpretationSequence",x30080082:"ReferencedMeasuredDoseReferenceNumber",x30080080:"ReferencedMeasuredDoseReferenceSequence",x00400220:"ReferencedNon-ImageCompositeSOPInstanceSequence",x50xx2610:"ReferencedOverlayGroup",x20400011:"ReferencedOverlayPlaneGroups",x20400010:"ReferencedOverlayPlaneSequence",x00081130:"ReferencedOverlaySequence",x50xx2600:"ReferencedOverlaySequence",x00380004:"ReferencedPatientAliasSequence",x00081120:"ReferencedPatientSequence",x300c006a:"ReferencedPatientSetupNumber",x20500500:"ReferencedPresentationLUTSequence",x21000500:"ReferencedPrintJobSequence",x21200070:"ReferencedPrintJobSequence",x00400330:"ReferencedProcedureStepSequence",x300c0007:"ReferencedReferenceImageNumber",x300c0042:"ReferencedReferenceImageSequence",x0040a370:"ReferencedRequestSequence",x00081100:"ReferencedResultsSequence",x30060084:"ReferencedROINumber",x300c0002:"ReferencedRTPlanSequence",x0040a132:"ReferencedSamplePositions",x00081115:"ReferencedSeriesSequence",x00081150:"ReferencedSOPClassUID",x00041510:"ReferencedSOPClassUIDinFile",x00081155:"ReferencedSOPInstanceUID",x00041511:"ReferencedSOPInstanceUIDinFile",x00081199:"ReferencedSOPSequence",x30080142:"ReferencedSourceApplicatorNumber",x300c000e:"ReferencedSourceNumber",x20000510:"ReferencedStoredPrintSequence",x300c0060:"ReferencedStructureSetSequence",x00081111:"ReferencedStudyComponentSequence",x00081110:"ReferencedStudySequence",x0040a138:"ReferencedTimeOffsets",x300c00a0:"ReferencedToleranceTableNumber",x00041512:"ReferencedTransferSyntaxUIDinFile",x30080030:"ReferencedTreatmentRecordSequence",x300c0040:"ReferencedVerificationImageSequence",x00081125:"ReferencedVisitSequence",x0040a0b0:"ReferencedWaveformChannels",x0008113a:"ReferencedWaveformSequence",x300c00c0:"ReferencedWedgeNumber",x00080090:"ReferringPhysician'sName",x00080094:"ReferringPhysician'sTelephoneNumbers",x00080092:"ReferringPhysician'sAddress",x20100160:"ReflectedAmbientLight",x00186014:"RegionDataType",x00186016:"RegionFlags",x0018601c:"RegionLocationMaxX1",x0018601e:"RegionLocationMaxY1",x00186018:"RegionLocationMinX0",x0018601a:"RegionLocationMinY0",x00102152:"RegionofResidence",x00186012:"RegionSpatialFormat",x300600c2:"RelatedFrameofReferenceUID",x300600a0:"RelatedRTROIObservationsSequence",x0040a010:"RelationshipType",x00181405:"RelativeX-rayExposure",x00404022:"RelevantInformationSequence",x300a007a:"RepeatFractionCycleLength",x00180080:"RepetitionTime",x3002000a:"ReportedValuesOrigin",x00401009:"ReportingPriority",x00286010:"RepresentativeFrameNumber",x00541004:"ReprojectionMethod",x00400275:"RequestAttributesSequence",x00321070:"RequestedContrastAgent",x20200040:"RequestedDecimate/CropBehavior",x20200030:"RequestedImageSize",x202000a0:"RequestedImageSizeFlag",x00321064:"RequestedProcedureCodeSequence",x00401400:"RequestedProcedureComments",x00321060:"RequestedProcedureDescription",x00401001:"RequestedProcedureID",x00401005:"RequestedProcedureLocation",x00401003:"RequestedProcedurePriority",x20200050:"RequestedResolutionID",x00404031:"RequestedSubsequentWorkitemCodeSequence",x00321032:"RequestingPhysician",x00321033:"RequestingService",x00281052:"RescaleIntercept",x00281053:"RescaleSlope",x00281054:"RescaleType",x00540017:"ResidualSyringeCounts",x00404015:"ResultingGeneralPurposePerformedProcedureStepsSequence",x40084000:"ResultsComments",x40080118:"ResultsDistributionListSequence",x40080040:"ResultsID",x40080042:"ResultsIDIssuer",x00080054:"RetrieveAETitle",x300e0004:"ReviewDate",x300e0005:"ReviewTime",x300e0008:"ReviewerName",x60xx1301:"ROIArea",x30060039:"ROIContourSequence",x30060028:"ROIDescription",x3006002a:"ROIDisplayColor",x30060036:"ROIGenerationAlgorithm",x30060038:"ROIGenerationDescription",x300600a6:"ROIInterpreter",x60xx1302:"ROIMean",x30060026:"ROIName",x30060022:"ROINumber",x30060088:"ROIObservationDescription",x30060085:"ROIObservationLabel",x300600b0:"ROIPhysicalPropertiesSequence",x300600b2:"ROIPhysicalProperty",x300600b4:"ROIPhysicalPropertyValue",x60xx1303:"ROIStandardDeviation",x3006002c:"ROIVolume",x00181140:"RotationDirection",x00540052:"RotationInformationSequence",x00182030:"RotationofScannedFilm",x00540050:"RotationVector",x00380016:"RouteofAdmissions",x00280010:"Rows",x00540060:"R-RIntervalVector",x300a00b8:"RTBeamLimitingDeviceType",x30040010:"RTDoseROISequence",x30020004:"RTImageDescription",x30020002:"RTImageLabel",x30020003:"RTImageName",x30020010:"RTImageOrientation",x3002000c:"RTImagePlane",x30020012:"RTImagePosition",x30020026:"RTImageSID",x300a0006:"RTPlanDate",x300a0004:"RTPlanDescription",x300a000c:"RTPlanGeometry",x300a0002:"RTPlanLabel",x300a0003:"RTPlanName",x300a0055:"RTPlanRelationship",x300a0007:"RTPlanTime",x30060014:"RTReferencedSeriesSequence",x30060012:"RTReferencedStudySequence",x30060030:"RTRelatedROISequence",x30060086:"RTROIIdentificationCodeSequence",x300600a4:"RTROIInterpretedType",x30060080:"RTROIObservationsSequence",x30060033:"RTROIRelationship",x30080162:"SafePositionExitDate",x30080164:"SafePositionExitTime",x30080166:"SafePositionReturnDate",x30080168:"SafePositionReturnTime",x50xx2008:"SampleRate",x00280002:"SamplesperPixel",x003a001a:"SamplingFrequency",x00181316:"SAR",x00181143:"ScanArc",x00181302:"ScanLength",x00180022:"ScanOptions",x00181300:"ScanVelocity",x00180020:"ScanningSequence",x00541105:"ScatterCorrectionMethod",x00541323:"ScatterFractionFactor",x0038001a:"ScheduledAdmissionDate",x0038001b:"ScheduledAdmissionTime",x0038001c:"ScheduledDischargeDate",x0038001d:"ScheduledDischargeTime",x00404034:"ScheduledHumanPerformersSequence",x0038001e:"ScheduledPatientInstitutionResidence",x00400006:"ScheduledPerformingPhysician'sName",x00400007:"ScheduledProcedureStepDescription",x00400004:"ScheduledProcedureStepEndDate",x00400005:"ScheduledProcedureStepEndTime",x00400009:"ScheduledProcedureStepID",x00400011:"ScheduledProcedureStepLocation",x00400100:"ScheduledProcedureStepSequence",x00400002:"ScheduledProcedureStepStartDate",x00404005:"ScheduledProcedureStepStartDateandTime",x00400003:"ScheduledProcedureStepStartTime",x00400020:"ScheduledProcedureStepStatus",x00404004:"ScheduledProcessingApplicationsCodeSequence",x00400008:"ScheduledProtocolCodeSequence",x00400001:"ScheduledStationAETitle",x00404026:"ScheduledStationClassCodeSequence",x00404027:"ScheduledStationGeographicLocationCodeSequence",x00400010:"ScheduledStationName",x00404025:"ScheduledStationNameCodeSequence",x00400270:"ScheduledStepAttributesSequence",x00321020:"ScheduledStudyLocation",x00321021:"ScheduledStudyLocationAETitle(s)",x00321000:"ScheduledStudyStartDate",x00321001:"ScheduledStudyStartTime",x00321010:"ScheduledStudyStopDate",x00321011:"ScheduledStudyStopTime",x00404018:"ScheduledWorkitemCodeSequence",x00181010:"SecondaryCaptureDeviceID",x00181016:"SecondaryCaptureDeviceManufacturer",x00181018:"SecondaryCaptureDeviceManufacturer'sModelName",x00181019:"SecondaryCaptureDeviceSoftwareVersion(s)",x00541311:"SecondaryCountsAccumulated",x00541220:"SecondaryCountsType",x00281223:"SegmentedBluePaletteColorLookupTableData",x00281222:"SegmentedGreenPaletteColorLookupTableData",x00281221:"SegmentedRedPaletteColorLookupTableData",x00186000:"Sensitivity",xfffee0dd:"SequenceDelimitationItem",x00180024:"SequenceName",x00186011:"SequenceofUltrasoundRegions",x00180021:"SequenceVariant",x00080021:"SeriesDate",x0008103e:"SeriesDescription",x00201000:"SeriesinStudy",x0020000e:"SeriesInstanceUID",x00200011:"SeriesNumber",x00080031:"SeriesTime",x00541000:"SeriesType",x300a01ba:"SetupDeviceDescription",x300a01b8:"SetupDeviceLabel",x300a01bc:"SetupDeviceParameter",x300a01b4:"SetupDeviceSequence",x300a01b6:"SetupDeviceType",x300a01d0:"SetupReferenceDescription",x300a01b0:"SetupTechnique",x300a01b2:"SetupTechniqueDescription",x300a01a6:"ShieldingDeviceDescription",x300a01a4:"ShieldingDeviceLabel",x300a01a8:"ShieldingDevicePosition",x300a01a0:"ShieldingDeviceSequence",x300a01a2:"ShieldingDeviceType",x00181602:"ShutterLeftVerticalEdge",x00181608:"ShutterLowerHorizontalEdge",x00181623:"ShutterOverlayGroup",x00181622:"ShutterPresentationValue",x00181604:"ShutterRightVerticalEdge",x00181600:"ShutterShape",x00181606:"ShutterUpperHorizontalEdge",x04000120:"Signature",x00181086:"SkipBeats",x00201041:"SliceLocation",x00182005:"SliceLocationVector",x00541320:"SliceSensitivityFactor",x00180050:"SliceThickness",x00540080:"SliceVector",x004006fa:"SlideIdentifier",x00280106:"SmallestImagePixelValue",x00280110:"SmallestImagePixelValueinPlane",x00280108:"SmallestPixelValueinSeries",x001021a0:"SmokingStatus",x20100080:"SmoothingType",x00185027:"SoftTissueThermalIndex",x00185028:"SoftTissue-focusThermalIndex",x00185029:"SoftTissue-surfaceThermalIndex",x00283110:"SoftcopyVOILUTSequence",x00181020:"SoftwareVersion(s)",x01000424:"SOPAuthorizationComment",x01000420:"SOPAuthorizationDateandTime",x00080016:"SOPClassUID",x0008115a:"SOPClassesSupported",x01000410:"SOPInstanceStatus",x00080018:"SOPInstanceUID",x00020016:"SourceApplicationEntityTitle",x300a0291:"SourceApplicatorID",x300a0296:"SourceApplicatorLength",x300a0298:"SourceApplicatorManufacturer",x300a0294:"SourceApplicatorName",x300a0290:"SourceApplicatorNumber",x300a02a0:"SourceApplicatorStepSize",x300a0292:"SourceApplicatorType",x300a029c:"SourceApplicatorWallNominalThickness",x300a029e:"SourceApplicatorWallNominalTransmission",x300a0222:"SourceEncapsulationNominalThickness",x300a0224:"SourceEncapsulationNominalTransmission",x00082112:"SourceImageSequence",x300a0228:"SourceIsotopeHalfLife",x300a0226:"SourceIsotopeName",x300a0216:"SourceManufacturer",x300a0288:"SourceMovementType",x300a0212:"SourceNumber",x300a0210:"SourceSequence",x30080105:"SourceSerialNumber",x300a00ba:"SourcetoBeamLimitingDeviceDistance",x300a00f6:"SourcetoBlockTrayDistance",x300a00e6:"SourcetoCompensatorTrayDistance",x30020028:"SourcetoReferenceObjectDistance",x300a0130:"SourcetoSurfaceDistance",x300a00da:"SourcetoWedgeTrayDistance",x300a0214:"SourceType",x003a020a:"SourceWaveformSequence",x300a00b4:"Source-AxisDistance",x00180088:"SpacingBetweenSlices",x00181050:"SpatialResolution",x00380050:"SpecialNeeds",x00080005:"SpecificCharacterSet",x00041142:"SpecificCharacterSetofFile-setDescriptorFile",x30080132:"SpecifiedChannelTotalTime",x30080042:"SpecifiedMeterset",x30080136:"SpecifiedNumberofPulses",x30080032:"SpecifiedPrimaryMeterset",x3008013a:"SpecifiedPulseRepetitionInterval",x30080033:"SpecifiedSecondaryMeterset",x3008003a:"SpecifiedTreatmentTime",x0040050a:"SpecimenAccessionNumber",x00400551:"SpecimenIdentifier",x00400550:"SpecimenSequence",x0040059a:"SpecimenTypeCodeSequence",x0040000a:"StageCodeSequence",x00082120:"StageName",x00082122:"StageNumber",x00540200:"StartAngle",x300c0008:"StartCumulativeMetersetWeight",x30080078:"StartMeterset",x00082142:"StartTrim",x00081010:"StationName",x00186036:"SteeringAngle",x00082143:"StopTrim",x00880130:"StorageMediaFile-setID",x00880140:"StorageMediaFile-setUID",x30060008:"StructureSetDate",x30060006:"StructureSetDescription",x30060002:"StructureSetLabel",x30060004:"StructureSetName",x30060020:"StructureSetROISequence",x30060009:"StructureSetTime",x00321040:"StudyArrivalDate",x00321041:"StudyArrivalTime",x00324000:"StudyComments",x00321050:"StudyCompletionDate",x00321051:"StudyCompletionTime",x00321055:"StudyComponentStatusID",x00080020:"StudyDate",x00081030:"StudyDescription",x00200010:"StudyID",x00320012:"StudyIDIssuer",x0020000d:"StudyInstanceUID",x0032000c:"StudyPriorityID",x00320034:"StudyReadDate",x00320035:"StudyReadTime",x0032000a:"StudyStatusID",x00080030:"StudyTime",x00320032:"StudyVerifiedDate",x00320033:"StudyVerifiedTime",x200000a8:"SupportedImageDisplayFormatsSequence",x300a012e:"SurfaceEntryPoint",x0018106c:"SynchronizationChannel",x00200200:"SynchronizationFrameofReferenceUID",x0018106a:"SynchronizationTrigger",x00181045:"SyringeCounts",x00181138:"TableAngle",x00181130:"TableHeight",x00181136:"TableLateralIncrement",x00181137:"TableLongitudinalIncrement",x00181134:"TableMotion",x0018605a:"TableofParameterValues",x00186058:"TableofPixelValues",x00186052:"TableofXBreakPoints",x00186054:"TableofYBreakPoints",x300a0125:"TableTopEccentricAngle",x300a004e:"TableTopEccentricAngleTolerance",x300a0124:"TableTopEccentricAxisDistance",x300a0126:"TableTopEccentricRotationDirection",x300a012a:"TableTopLateralPosition",x300a0053:"TableTopLateralPositionTolerance",x300a01d6:"TableTopLateralSetupDisplacement",x300a0129:"TableTopLongitudinalPosition",x300a0052:"TableTopLongitudinalPositionTolerance",x300a01d4:"TableTopLongitudinalSetupDisplacement",x300a0128:"TableTopVerticalPosition",x300a0051:"TableTopVerticalPositionTolerance",x300a01d2:"TableTopVerticalSetupDisplacement",x00181131:"TableTraverse",x0018113a:"TableType",x00181135:"TableVerticalIncrement",x300a0027:"TargetMaximumDose",x300a0025:"TargetMinimumDose",x300a0026:"TargetPrescriptionDose",x300a0028:"TargetUnderdoseVolumeFraction",x0040db0d:"TemplateExtensionCreatorUID",x0040db0b:"TemplateExtensionFlag",x0040db0c:"TemplateExtensionOrganizationUID",x0040db00:"TemplateIdentifier",x0040db07:"TemplateLocalVersion",x300a0244:"TemplateName",x300a0240:"TemplateNumber",x300a0242:"TemplateType",x0040db06:"TemplateVersion",x00200100:"TemporalPositionIdentifier",x0040a130:"TemporalRangeType",x00200110:"TemporalResolution",x00700008:"TextObjectSequence",x20300020:"TextString",x0040a160:"TextValue",x00180039:"TherapyDescription",x00180037:"TherapyType",x00185024:"ThermalIndex",x00286120:"TIDOffset",x0040a122:"Time",x00181802:"TimeDistributionProtocol",x00181201:"TimeofLastCalibration",x0018700e:"TimeofLastDetectorCalibration",x00181014:"TimeofSecondaryCapture",x00540100:"TimeSliceVector",x00540072:"TimeSlotInformationSequence",x00540073:"TimeSlotTime",x00540070:"TimeSlotVector",x00181801:"TimeSource",x00080201:"TimezoneOffsetFromUTC",x0018603c:"TM-LinePositionX0",x00186040:"TM-LinePositionX1",x0018603e:"TM-LinePositionY0",x00186042:"TM-LinePositionY1",x300a0043:"ToleranceTableLabel",x300a0042:"ToleranceTableNumber",x300a0040:"ToleranceTableSequence",x00181470:"TomoAngle",x00181491:"TomoClass",x00181460:"TomoLayerHeight",x00181480:"TomoTime",x00181490:"TomoType",x00880910:"TopicAuthor",x00880912:"TopicKeyWords",x00880906:"TopicSubject",x00880904:"TopicTitle",x300a00f2:"TotalBlockTrayFactor",x300a00e2:"TotalCompensatorTrayFactor",x00400301:"TotalNumberofExposures",x300a0250:"TotalReferenceAirKerma",x50xx200a:"TotalTime",x00400300:"TotalTimeofFluoroscopy",x00081195:"TransactionUID",x00185010:"TransducerData",x00186030:"TransducerFrequency",x00082246:"TransducerOrientationModifierSequence",x00082244:"TransducerOrientationSequence",x00082242:"TransducerPositionModifierSequence",x00082240:"TransducerPositionSequence",x00186031:"TransducerType",x00020010:"TransferSyntaxUID",x300a02a4:"TransferTubeLength",x300a02a2:"TransferTubeNumber",x00181251:"TransmittingCoil",x00541202:"TransverseMash",x30080024:"TreatmentControlPointDate",x30080025:"TreatmentControlPointTime",x30080250:"TreatmentDate",x300a00ce:"TreatmentDeliveryType",x300a000a:"TreatmentIntent",x300a00b2:"TreatmentMachineName",x300a0206:"TreatmentMachineSequence",x300a0009:"TreatmentProtocols",x30080110:"TreatmentSessionApplicationSetupSequence",x30080020:"TreatmentSessionBeamSequence",x300a000b:"TreatmentSites",x30080202:"TreatmentStatusComment",x30080050:"TreatmentSummaryCalculatedDoseReferenceSequence",x300800e0:"TreatmentSummaryMeasuredDoseReferenceSequence",x3008002b:"TreatmentTerminationCode",x3008002a:"TreatmentTerminationStatus",x30080251:"TreatmentTime",x3008002c:"TreatmentVerificationStatus",x0018106e:"TriggerSamplePosition",x00181061:"TriggerSourceorType",x00181060:"TriggerTime",x00181069:"TriggerTimeOffset",x00540210:"TriggerVector",x00181094:"TriggerWindow",x20100140:"Trim",x50xx0020:"TypeofData",x00540202:"TypeofDetectorMotion",x00181161:"TypeofFilters",x0040a124:"UID",x00280014:"UltrasoundColorDataPresent",x00700006:"UnformattedTextValue",x00541001:"Units",x0040a040:"ValueType",x00181315:"VariableFlipAngleFlag",x0040a030:"VerificationDateTime",x0040a493:"VerificationFlag",x0040a088:"VerifyingObserverIdentificationCodeSequence",x0040a075:"VerifyingObserverName",x0040a073:"VerifyingObserverSequence",x0040a027:"VerifyingOrganization",x00181720:"VerticesofthePolygonalCollimator",x00181620:"VerticesofthePolygonalShutter",x00181022:"VideoImageFormatAcquired",x00540220:"ViewCodeSequence",x00540222:"ViewModifierCodeSequence",x00082127:"ViewName",x00082128:"ViewNumber",x00185101:"ViewPosition",x00384000:"VisitComments",x00380008:"VisitStatusID",x00283010:"VOILUTSequence",x54001004:"WaveformBitsAllocated",x003a021a:"WaveformBitsStored",x003a0202:"WaveformChannelNumber",x54001010:"WaveformData",x003a0004:"WaveformOriginality",x5400100a:"WaveformPaddingValue",x54001006:"WaveformSampleInterpretation",x54000100:"WaveformSequence",x300a00d5:"WedgeAngle",x300a00d6:"WedgeFactor",x300a00d4:"WedgeID",x300a00d2:"WedgeNumber",x300a00d8:"WedgeOrientation",x300a0118:"WedgePosition",x300a0116:"WedgePositionSequence",x300a00d1:"WedgeSequence",x300a00d3:"WedgeType",x00181301:"WholeBodyTechnique",x00281050:"WindowCenter",x00281055:"WindowCenter&WidthExplanation",x00281051:"WindowWidth",x00181183:"XFocusCenter",x0040072a:"XoffsetinSlideCoordinateSystem",x3002000e:"X-RayImageReceptorAngle",x3002000d:"X-RayImageReceptorTranslation",x00400312:"X-RayOutput",x00181151:"X-rayTubeCurrent",x00188151:"X-RayTubeCurrentinmA",x00181184:"YFocusCenter",x0040073a:"YoffsetinSlideCoordinateSystem",x0040074a:"ZoffsetinSlideCoordinateSystem",x00280032:"ZoomCenter",x00280031:"ZoomFactor"},Ri={x00189305:"Revolution​Time",x00083010:"Irradiation​Event​UID",x00189306:"Single​Collimation​Width",x00189307:"Total​Collimation​Width",x00189309:"Table​Speed",x00189310:"Table​Feed​Per​Rotation",x00189311:"Spiral​Pitch​Factor",x00209241:"Nominal​Percentage​Of​Cardiac​Phase"},Ii=function(e,t,n){if(!(n<128))return"data too long to show.";if(2===n)return e.uint16(t);if(4===n)return e.uint32(t);var r=e.string(t);if(function(e){return/^[\x00-\x7F]*$/.test(e)}(r)){if(void 0!==r)return r}else if(2!==n&&4!==n)return"binary data";return 0===n?"":void 0},Oi=function(e){var t={};try{for(var n in e.elements){var r,i,a=e.elements[n],o=a.tag,s=a.vr,u=a.length,l=null!==(r=null!==(i=Ai[o])&&void 0!==i?i:Ri[o])&&void 0!==r?r:"Unknown";t[o.toLocaleLowerCase()]={tag:o,vr:s,length:u,attr:l,value:Ii(e,o,u)},"Unknown"===l&&console.log("dump unknown key",o)}}catch(e){console.error("dump error",e)}return t},Li=function(e,t){return"x".concat(e.toString(16).padStart(4,"0")).concat(t.toString(16).padStart(4,"0"))},Mi={PhotometricInterpretation:Li(40,4),TransferSyntaxUID:Li(2,16),BitsAllocated:Li(40,256),Rows:Li(40,16),Columns:Li(40,17),SamplesperPixel:Li(40,2),PixelRepresentation:Li(40,259),PlanarConfiguration:Li(40,6),PixelAspectRatio:Li(40,52),RescaleSlope:Li(40,4179),RescaleIntercept:Li(40,4178),SmallestImagePixelValue:Li(40,262),LargestImagePixelValue:Li(40,23),WindowCenter:Li(40,4176),WindowWidth:Li(40,4177),InstanceNumber:Li(32,19),LossyImageCompression:Li(40,8464),LossyImageCompressionRatio:Li(40,8466),LossyImageCompressionMethod:Li(40,8468),StudyDate:Li(8,32),StudyTime:Li(8,48),SeriesNumber:Li(32,17),AccessionNumber:Li(8,80),PatientID:Li(16,32),PatientName:Li(16,16),PatientSex:Li(16,64),PatientAge:Li(16,1010),ImagerPixelSpacing_CT:Li(40,48),ImagerPixelSpacing_CR:Li(24,4452),PatientOrientation_CT:Li(32,55),PatientOrientation_CR:Li(32,32),PatientPosition_CT:Li(32,50),PatientPosition_CR:Li(24,20736),SliceThickness:Li(24,80),SpacingBetweenSlices:Li(24,136),Modality:Li(8,96),StudyInstanceUID:Li(32,13),SeriesInstanceUID:Li(32,14)},Ni=function(e){var t,n,r=Fi(e,Mi.ImagerPixelSpacing_CT,2)||Fi(e,Mi.ImagerPixelSpacing_CR,2);return{byteArray:e.byteArray,elements:e.elements,transferSyntax:e.string(Mi.TransferSyntaxUID),bitsAllocated:e.uint16(Mi.BitsAllocated),rows:e.uint16(Mi.Rows),columns:e.uint16(Mi.Columns),samplesPerPixel:e.uint16(Mi.SamplesperPixel),pixelRepresentation:e.uint16(Mi.PixelRepresentation),planarConfiguration:e.uint16(Mi.PlanarConfiguration),pixelAspectRatio:e.string(Mi.PixelAspectRatio),rowPixelSpacing:r[0],columnPixelSpacing:r[1],slope:e.floatString(Mi.RescaleSlope)||1,intercept:e.floatString(Mi.RescaleIntercept)||0,photometricInterpretation:e.string(Mi.PhotometricInterpretation),invert:"MONOCHROME1"===e.string(Mi.PhotometricInterpretation),color:"RGB"===e.string(Mi.PhotometricInterpretation),minPixelValue:e.uint16(Mi.SmallestImagePixelValue),maxPixelValue:e.uint16(Mi.LargestImagePixelValue),windowCenter:(null===(t=Fi(e,Mi.WindowCenter,1))||void 0===t?void 0:t[0])||50,windowWidth:(null===(n=Fi(e,Mi.WindowWidth,1))||void 0===n?void 0:n[0])||255,instanceNumber:e.intString(Mi.InstanceNumber),imageOrientationPatient:Fi(e,Mi.PatientOrientation_CT,6)||Fi(e,Mi.PatientOrientation_CR,6)||[1,0,0,0,1,0],imagePositionPatient:Fi(e,Mi.PatientPosition_CT,3)||Fi(e,Mi.PatientPosition_CT,3)||[0,0,0],sliceThickness:Bi(e,Mi.SliceThickness)||1,spacingBetweenSlices:Bi(e,Mi.SpacingBetweenSlices),imageCompression:Ui({lossyImageCompression:e.string(Mi.LossyImageCompression),lossyImageCompressionRatio:""|e.string(Mi.LossyImageCompressionRatio),lossyImageCompressionMethod:e.string(Mi.LossyImageCompressionMethod)||""}),studyDate:e.string(Mi.StudyDate),studyTime:e.string(Mi.StudyTime),seriesNum:e.string(Mi.SeriesNumber),accessionNumber:e.string(Mi.AccessionNumber),patientId:e.string(Mi.PatientID),patientName:qi(e,Mi.PatientName)||"",patientSex:e.string(Mi.PatientSex)||"",patientAge:e.string(Mi.PatientAge)||"",studyId:e.string(Mi.StudyInstanceUID),seriesId:e.string(Mi.SeriesInstanceUID)}},Fi=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],i=e.string(t);if(i){var a=i.split("\\");if(!(n&&a.length<n)){for(var o=0;o<a.length;o++)r.push(vi(a[o]));return r}}},Bi=function(e,t){var n=e.string(t);if(n)return vi(n)},qi=function(e,t){var n=e.elements[t];if(n&&n.length>0){var r=function(e,t,n){if(n<0)throw new Error("dicomParser.readFixedString - length cannot be less than 0");if(t+n>e.length)throw new Error("dicomParser.readFixedString: attempt to read past end of buffer");for(var r,i=[],a=0;a<n;a++){if(0===(r=e[t+a]))return t+=n,i;i.push(r)}return i}(e.byteArray,n.dataOffset,n.length).map((function(e){return"%"+e.toString(16)})).join("");try{return decodeURIComponent(r).trim()}catch(e){return}}};var Ui=function(e){var t=e.lossyImageCompression,n=e.lossyImageCompressionRatio,r=e.lossyImageCompressionMethod;return"01"===t&&""!==n?(r||"Lossy: ")+" "+vi(n).toFixed(2)+" : 1":"Lossless / Uncompressed"},Gi=void 0,zi=void 0,Vi=function(e,t){var n=t.elements.x7fe00010;return n?n.encapsulatedPixelData?Wi(e,t):ji(t):null},Wi=function(e,t){var n,r,i=t.elements.x7fe00010;if(null!=i&&null!==(n=i.basicOffsetTable)&&void 0!==n&&n.length)return zi(e,i,0);if((r=e).intString("x00280008")!==r.elements.x7fe00010.fragments.length){var a=Gi(e,i);return zi(e,i,0,a)}return readEncapsulatedPixelDataFromFragments(e,i,0)},ji=function(e){var t=e.elements.x7fe00010,n=e.rows,r=e.columns,i=e.samplesPerPixel,a=e.bitsAllocated,o=e.byteArray,s=t.dataOffset,u=n*r*i;return 8===a?new Uint8Array(o.buffer,s,u):16===a?new Uint8Array(o.buffer,s,2*u):1===a?function(e,t,n){for(var r=new Uint8Array(n),i=0;i<n;i++){var a=e[Math.floor(i/8)+t],o=i%8;r[i]=isBitSet(a,o)?1:0}return r}(o,s,u):32===a?new Uint8Array(o.buffer,s,4*u):void 0},Hi=function(){var e=Sr(Ar.mark((function e(t,n){var r,i;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=null,i=t.transferSyntax,e.t0=i,e.next="1.2.840.10008.1.2"===e.t0||"1.2.840.10008.1.2.1"===e.t0||"1.2.840.10008.1.2.2"===e.t0||"1.2.840.10008.1.2.1.99"===e.t0||"1.2.840.10008.1.2.5"===e.t0||"1.2.840.10008.1.2.4.80"===e.t0?5:9;break;case 5:return e.next=7,Ei(t,n);case 7:return r=e.sent,e.abrupt("break",10);case 9:r=new wr((function(e,t){t(new Error("No decoder for transfer syntax:".concat(i)))}));case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Yi=function(e){if(e.sizeInBytes=e.pixelData.byteLength,!e.minPixelValue||!e.maxPixelValue){var t=Zi(e.pixelData),n=t.min,r=t.max;e.minPixelValue=n,e.maxPixelValue=r}return delete e.elements,delete e.byteArray,e},Zi=function(e){for(var t,n=9007199254740991,r=-9007199254740991,i=e.length,a=0;a<i;)t=e[a],n=Math.min(n,t),r=Math.max(r,t),a+=1;return{min:n,max:r}},Xi=null,Ki=function(){var e=Sr(Ar.mark((function e(t){var n,r,i;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0,a=new Uint8Array(t),n=Pi.parseDicom(a),Xi||(Xi=Oi(n)),r=Ni(n),i=Vi(n,r),e.next=6,Hi(r,i);case 6:return r=e.sent,e.abrupt("return",Yi(r));case 8:case"end":return e.stop()}var a}),e)})));return function(t){return e.apply(this,arguments)}}(),Ji=function(){var e=Sr(Ar.mark((function e(t){var n;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t},e.abrupt("return",n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var $i=function(e){function t(e,t,n,r){function i(t){"function"!=typeof self.postMessage?e.ports[0].postMessage(t):self.postMessage(t)}n?("undefined"!=typeof console&&"error"in console&&console.error("Worker caught an error:",n),i([t,{message:n.message}])):i([t,null,r])}function n(e,n,r,i){var a,o=function(e,t){try{return{res:e(t)}}catch(e){return{err:e}}}(n,i);o.err?t(e,r,o.err):!(a=o.res)||"object"!==Lt(a)&&"function"!=typeof a||"function"!=typeof a.then?t(e,r,null,o.res):o.res.then((function(n){t(e,r,null,n)}),(function(n){t(e,r,n)}))}self.addEventListener("message",(function(r){var i=r.data;if(ue(i)&&2===i.length){var a=i[0],o=i[1];"function"!=typeof e?t(r,a,new Error("Please pass a function into register().")):n(r,e,a,o)}}))},Qi=function(){var e=Sr(Ar.mark((function e(t){var n,r;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.arrayBuffer();case 4:return n=e.sent,e.next=7,Ki(n);case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ea=function(){var e=Sr(Ar.mark((function e(t){var n,r;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.arrayBuffer();case 4:return n=e.sent,e.next=7,Ji(n);case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ta=$i(function(){var e=Sr(Ar.mark((function e(t){var n,r,i,a,o,s;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.imageUrl,r=t.seriesId,i=t.index,a=t.plane,"dicom"!==(o=t.format)){e.next=7;break}return e.next=4,Qi(n);case 4:s=e.sent,e.next=13;break;case 7:if("webimage"!==o){e.next=13;break}return e.next=10,ea(n);case 10:s=e.sent,e.next=13;break;case 13:return e.abrupt("return",{seriesId:r,index:i,plane:a,image:s});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),na=/Windows NT 5\.1.+Chrome\/49/.test(navigator.userAgent),ra=function(){function e(){kr(this,e),this.workers=[],this.taskManager=null,this.cacheManager=null,this.initLoader()}var t,n;return Tr(e,[{key:"initLoader",value:function(){var e=na?2:Math.min(navigator.hardwareConcurrency-1,5);this.workers=Zn(new Array(e),(function(e,t){return t+1})).map((function(e){var t=new ta,n=new Kr(t);return n.id=e,n.working=!1,n})),console.log(this.workers)}},{key:"load",value:(n=Sr(Ar.mark((function e(){var t,n,r,i,a,o,s,u,l,c,h,f,d,p;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.taskManager.hasPendingTask()){e.next=2;break}return e.abrupt("return");case 2:if(0!==this.workers.length){e.next=5;break}return this._startCheck(),e.abrupt("return");case 5:if(t=this.taskManager.pendingTask.shift(),n=t.seriesId,r=t.index,i=t.plane,a=t.resolve,!(o=this.cacheManager.getItem(n,r,i))){e.next=12;break}return null==a||a(o),this._startCheck(),e.abrupt("return");case 12:return(s=this.workers.shift()).working=!0,u=t.resolve,delete t.resolve,e.next=18,s.postMessage(t);case 18:return l=e.sent,s.working=!1,this.workers.push(s),c=l.seriesId,h=l.plane,f=l.index,d=l.image,e.next=24,$r(d,t);case 24:return p=e.sent,this.cacheManager.cacheItem(c,{key:f,value:p},h),null==u||u(p),e.next=29,this.delay(0);case 29:this._startCheck();case 30:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadSeries",value:function(e,t){for(var n=this,r=this.taskManager.getTask(e,t);r.length;)this.taskManager.addPendingTask(r.shift());this.taskManager.sort(this.taskManager.pendingTask),this.workers.forEach((function(){n.load()}))}},{key:"_startCheck",value:function(){this.workers.length>0?this.load():this.taskManager.hasPendingTask()?this._rafInterval=requestAnimationFrame(this._startCheck.bind(this)):cancelAnimationFrame(this._rafInterval)}},{key:"delay",value:(t=Sr(Ar.mark((function e(t,n){return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new wr((function(e){setTimeout(e,t,n)})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}();p(p.S,"Date",{now:function(){return(new Date).getTime()}});var ia=l.Date.now,aa=function(){function e(){kr(this,e),this.tasks=[],this.pendingTask=[]}return Tr(e,[{key:"getTasks",value:function(){return this.tasks}},{key:"addTask",value:function(e){this.tasks.push(new oa(e))}},{key:"pickTask",value:function(){return this.tasks.shift()}},{key:"modifyTaskPriority",value:function(e,t,n){this.tasks=this.tasks.map((function(r){return(null==r?void 0:r[e])===t&&(r.priority=n),r})),this.sort(this.tasks)}},{key:"sort",value:function(e){e.sort((function(e,t){return e.priority-t.priority}))}},{key:"getTask",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.length,i=t[0],a=t[1],o=t[2],s=function(e){return e},u=function(e){return e.seriesId===i},l=function(e){return e.seriesId===i&&e.plane===a},c=function(e){return e.seriesId===i&&e.plane===a&&e.index===o},h=[s,u,l,c];return this.getTasks().filter(h[r])}},{key:"hasPendingTask",value:function(){return this.pendingTask.length>0}},{key:"addPendingTask",value:function(e){var t=this.pendingTask.findIndex((function(t){return t.plane===e.plane&&t.seriesId===e.seriesId&&t.index===e.index}));if(-1!==t){var n=this.pendingTask[t];n.priority=ia(),this.pendingTask.splice(t,1,n)}else e.priority=ia(),this.pendingTask.push(e);this.sort(this.pendingTask)}}]),e}(),oa=function e(t){kr(this,e);var n=t.url,r=void 0===n?"":n,i=t.seriesId,a=void 0===i?"":i,o=t.plane,s=void 0===o?"":o,u=t.index,l=t.format,c=void 0===l?"dicom":l;this.priority=0,this.imageUrl=r,this.seriesId=a,this.plane=s,this.index=u,this.format=c},sa=function(){function e(){kr(this,e),this.taskManager=null}return Tr(e,[{key:"buildPreloadTask",value:function(e){for(var t=Math.max(8,4),n=e.plane,r=e.index,i=e.seriesId,a=[],o=1,s=1;o<=t;o++,s++){if(s<=8){var u=r+s,l=this.taskManager.getTask(i,n,u)[0];l&&a.push(l)}if(o<=4){var c=r-o,h=this.taskManager.getTask(i,n,c)[0];h&&a.push(h)}}for(;a.length;)this.taskManager.addPendingTask(a.shift())}}]),e}(),ua=function(){function e(){kr(this,e),this.loaderManager=new ra,this.preloadManager=new sa,this.cacheManager=new Hr,this.taskManager=new aa,this.loaderManager.cacheManager=this.cacheManager,this.loaderManager.taskManager=this.taskManager,this.preloadManager.taskManager=this.taskManager,window.__TX_RESOURCE__=this}var t;return Tr(e,[{key:"addItemUrls",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"axis",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"dicom";t.forEach((function(t,a){n.taskManager.addTask({seriesId:e,url:t,plane:r,index:a,format:i})}))}},{key:"cacheItems",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"axis";t.forEach((function(t){n.cacheItem(e,t,r)}))}},{key:"cacheItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"axis";this.cacheManager.cacheItem(e,t,n)}},{key:"getImage",value:(t=Sr(Ar.mark((function e(t,n){var r,i=this,a=arguments;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:"axis",e.abrupt("return",new wr((function(e,a){var o=i.cacheManager.getItem(t,n,r);if(o)return e(o),i.preloadManager.buildPreloadTask({seriesId:t,plane:r,index:n}),void i.loaderManager.load();var s=i.taskManager.getTask(t,r,n)[0];s?(s.resolve=e,i.taskManager.addPendingTask(s),i.taskManager.sort(i.taskManager.pendingTask),i.preloadManager.buildPreloadTask({seriesId:t,plane:r,index:n}),i.loaderManager.load()):console.error("not have task ".concat(t,", ").concat(r,", ").concat(n,"."))})));case 2:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"loadSeries",value:function(e,t){this.loaderManager.loadSeries(e,t)}},{key:"purgeCache",value:function(e,t){this.cacheManager.purge(e,t)}},{key:"getImages",value:function(e,t){return this.cacheManager.getItems(e,t)}},{key:"getIllegalIndex",value:function(e,t,n,r){var i=this.taskManager.getTasks(t,n).length;return r&&e>=i?0:Math.max(0,Math.min(e,i-1))}}]),e}(),la=[].slice,ca={},ha=function(e,t,n){if(!(t in ca)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";ca[t]=Function("F,a","return new F("+r.join(",")+")")}return ca[t](e,n)},fa=Function.bind||function(e){var t=c(this),n=la.call(arguments,1),r=function r(){var i=n.concat(la.call(arguments));return this instanceof r?ha(t,i.length,i):wn(t,i,e)};return S(t.prototype)&&(r.prototype=t.prototype),r},da=(u.Reflect||{}).construct,pa=f((function(){function e(){}return!(da((function(){}),[],e)instanceof e)})),va=!f((function(){da((function(){}))}));p(p.S+p.F*(pa||va),"Reflect",{construct:function(e,t){c(e),ye(t);var n=arguments.length<3?e:c(arguments[2]);if(va&&!pa)return da(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(fa.apply(e,r))}var i=n.prototype,a=fe(S(i)?i:Object.prototype),o=Function.apply.call(e,a,t);return S(o)?o:a}});var ga=l.Reflect.construct;function ma(e,t){return(ma=Er||function(e,t){return e.__proto__=t,e})(e,t)}function ya(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=pe(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ma(e,t)}function xa(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _a(e,t){if(t&&("object"===Lt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return xa(e)}function wa(e){return(wa=Er?Ht:function(e){return e.__proto__||Ht(e)})(e)}var ba=function(e){return null!=e},Sa={object:!0,function:!0,undefined:!0},ka=function(e){if(!function(e){return!!ba(e)&&hasOwnProperty.call(Sa,Lt(e))}(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}},Pa=/^\s*class[\s{/}]/,Ta=Function.prototype.toString,Da=function(e){return!!function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!ka(e)}(e)&&!Pa.test(Ta.call(e))},Ca=Ra,Ea=!Ca||f((function(){var e={},t={},n=St(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=Ca({},e)[n]||V(Ca({},t)).join("")!=r}))?function(e,t){for(var n=U(e),r=arguments.length,i=1,a=ae.f,o=oe.f;r>i;)for(var s,u=H(arguments[i++]),l=a?G(u).concat(a(u)):G(u),c=l.length,h=0;c>h;)s=l[h++],d&&!o.call(u,s)||(n[s]=u[s]);return n}:Ca;p(p.S+p.F,"Object",{assign:Ea});var Aa,Ra=l.Object.assign,Ia=function(e){return null!=e},Oa=V,La=function(){try{return V("primitive"),!0}catch(e){return!1}}()?V:function(e){return Oa(Ia(e)?Object(e):e)},Ma=function(e){if(!Ia(e))throw new TypeError("Cannot use null or undefined");return e},Na=Math.max,Fa="function"==typeof Ra&&(Ra(Aa={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),Aa.foo+Aa.bar+Aa.trzy==="razdwatrzy")?Ra:function(e,t){var n,r,i,a=Na(arguments.length,2);for(e=Object(Ma(e)),i=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},r=1;r<a;++r)La(t=arguments[r]).forEach(i);if(void 0!==n)throw n;return e},Ba=Array.prototype.forEach,qa=pe,Ua=function(e,t){var n;for(n in e)t[n]=e[n]},Ga=function(e){var t=qa(null);return Ba.call(arguments,(function(e){Ia(e)&&Ua(Object(e),t)})),t},za="razdwatrzy",Va=String.prototype.indexOf,Wa="function"==typeof za.contains&&!0===za.contains("dwa")&&!1===za.contains("foo")?String.prototype.contains:function(e){return Va.call(this,e,arguments[1])>-1},ja=s((function(e){(e.exports=function(e,t){var n,r,i,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],ba(e)?(n=Wa.call(e,"c"),r=Wa.call(e,"e"),i=Wa.call(e,"w")):(n=i=!0,r=!1),o={value:t,configurable:n,enumerable:r,writable:i},a?Fa(Ga(a),o):o}).gs=function(e,t,n){var r,i,a,o;return"string"!=typeof e?(a=n,n=t,t=e,e=null):a=arguments[3],ba(t)?Da(t)?ba(n)?Da(n)||(a=n,n=void 0):n=void 0:(a=t,t=n=void 0):t=void 0,ba(e)?(r=Wa.call(e,"c"),i=Wa.call(e,"e")):(r=!0,i=!1),o={get:t,set:n,configurable:r,enumerable:i},a?Fa(Ga(a),o):o}})),Ha=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},Ya=s((function(e,t){var n,r,i,a,o,s,u,l=Function.prototype.apply,c=Function.prototype.call,h=pe,f=m,d=me,p=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var r,a;return Ha(t),a=this,n.call(this,e,r=function(){i.call(a,e,r),l.call(t,this,arguments)}),r.__eeOnceListener__=t,this},o={on:n=function(e,t){var n;return Ha(t),p.call(this,"__ee__")?n=this.__ee__:(n=v.value=h(null),f(this,"__ee__",v),v.value=null),n[e]?"object"===Lt(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:r,off:i=function(e,t){var n,r,i,a;if(Ha(t),!p.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"===Lt(r=n[e]))for(a=0;i=r[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[a?0:1]:r.splice(a,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:a=function(e){var t,n,r,i,a;if(p.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===Lt(i)){for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)l.call(r,this,a)}else switch(arguments.length){case 1:c.call(i,this);break;case 2:c.call(i,this,arguments[1]);break;case 3:c.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];l.call(i,this,a)}}},s={on:ja(n),once:ja(r),off:ja(i),emit:ja(a)},u=d({},s),e.exports=t=function(e){return null==e?h(u):d(Object(e),s)},t.methods=o}));Ya.methods;var Za,Xa,Ka=function(e){!Za||Za.length<e?(Za=Buffer.allocUnsafe(32*e),t.default.randomFillSync(Za),Xa=0):Xa+e>Za.length&&(t.default.randomFillSync(Za),Xa=0);var n=Za.subarray(Xa,Xa+e);return Xa+=e,n},Ja=function(e,t){return function(e,t,n){var r=(2<<31-Math.clz32(e.length-1|1))-1,i=Math.ceil(1.6*r*t/e.length);return function(){for(var a="";;)for(var o=n(i),s=i;s--;)if((a+=e[o[s]&r]||"").length===t)return a}}(e,t,Ka)},$a=function(){function e(t){kr(this,e),Ya(this),this.id=(null==t?void 0:t.id)||Ja("12345abcde",8)()}return Tr(e,[{key:"destroy",value:function(){}}]),e}();function Qa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eo(e){if(void 0!==St&&null!=e[Ot]||null!=e["@@iterator"])return Zn(e)}function to(e,t){if(e){if("string"==typeof e)return Qa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Zn(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qa(e,t):void 0}}function no(e){return function(e){if(ue(e))return Qa(e)}(e)||eo(e)||to(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ro(e){if(ue(e))return e}function io(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ao(e,t){return ro(e)||function(e,t){var n=null==e?null:void 0!==St&&e[Ot]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||to(e,t)||io()}var oo="internal_enter_frame",so=window.requestAnimationFrame||function(e){return setInterval(e,30)},uo=window.cancelAnimationFrame||function(e){clearInterval(e)},lo=function(){function e(){kr(this,e),Ya(this),this._fps=30,this.fpsInterval=Math.ceil(1e3/this._fps),this.lastRenderTime=ia()}return Tr(e,[{key:"render",value:function(){if(this.isRunning){var e=this.lastRenderTime,t=this.fpsInterval,n=ia();if(n-e<t)return uo(this.rafInterval),void(this.rafInterval=so(this.render.bind(this)));this.lastRenderTime=n,this.emit(oo)}}},{key:"startRender",value:function(){this.isRunning=!0,this.rafInterval=so(this.render.bind(this))}},{key:"stopRender",value:function(){this.isRunning=!1,uo(this.rafInterval)}},{key:"fps",get:function(){return this._fps},set:function(e){this.fps!==+e&&(this._fps=+e,0!==e?this.fpsInterval=Math.ceil(1e3/+e):uo(this.rafInterval))}}]),e}();function co(e,t){var n=void 0!==St&&e[Ot]||e["@@iterator"];if(!n){if(ue(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ho(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Zn(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ho(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var fo=function(){function e(t){kr(this,e),this.deferredQueue=new jr,this.stage=t,this.stage.on(oo,this.onValidate.bind(this))}return Tr(e,[{key:"invalidate",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.deferredQueue.set(e,n),this.stage.startRender()}},{key:"validateNow",value:function(){this.onValidate()}},{key:"onValidate",value:function(){var e;if(0!==this.deferredQueue.size){var t,n=co(null===(e=this.deferredQueue)||void 0===e?void 0:e.entries());try{for(n.s();!(t=n.n()).done;){var r=ao(t.value,2),i=r[0],a=r[1];null==i||i.apply(void 0,no(a)),this.deferredQueue.delete(i)}}catch(e){n.e(e)}finally{n.f()}this.deferredQueue.size>0&&this.validateNow()}else this.stage.stopRender()}}]),e}(),po=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,e),this.option=t,this.initialize(),window.__TX_CORE__=this}return Tr(e,[{key:"initialize",value:function(){var e=this.option;this.stage=new lo,this.stage.fps=+e.fps||30,this.renderSchedule=new fo(this.stage)}}]),e}(),vo=20,go=20,mo={HOVER:{"default-color":"#5BD1AE",".node-anchor":"#5BD1AE",".node-item":"#5BD1AE",".node-label":"#5BD1AE"},NORMAL:{"default-color":"#2AC7F6",".node-anchor":"#2AC7F6",".node-item":"#2AC7F6",".node-label":"#2AC7F6"}},yo="node-anchor",xo="node-item",_o="node-dashline",wo="node-label",bo={STACK_SCROLL:"stack_scroll",STACK_WHEEL_SCROLL:"stack_wheel_scroll",MAGNIFYING:"magnifying",WWWC:"wwwc",LENGTH:"length",ANGLE:"angle",PROBE:"probe",ELLIPSE_ROI:"ellipse_roi",POLYGON:"polygon",ROTATION:"rotation",SCALE:"scale",TRANSLATE:"translate"},So={DATA_CREATED:"tx_data_created",DATA_UPDATED:"tx_data_updated",DATA_REMOVED:"tx_data_removed",TOOL_TRANSLATE:"tx_tool_translate",TOOL_ROTATION:"tx_tool_rotation",TOOL_SCALE:"tx_tool_scale",TOOL_WWWC:"tx_tool_wwwc",TOOL_STACK_CHANGE:"tx_stack_change",TOOL_FLIPH:"tx_tool_flipH",TOOL_FLIPV:"tx_tool_flipV",TOOL_INVERT:"tx_tool_invert"},ko={x:0,y:0,width:0,height:0,rotate:0,scale:1,rootWidth:0,rootHeight:0,centerX:0,centerY:0},Po={};function To(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Do=function(e){ya(n,$a);var t=To(n);function n(){var e;return kr(this,n),(e=t.call(this)).playInterval=null,e}return Tr(n,[{key:"rotation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_ROTATION,{rotate:e,dispatch:t})}},{key:"wwwc",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_WWWC,{wwwc:e,dispatch:t})}},{key:"flipH",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_FLIPH,{h:e,dispatch:t})}},{key:"flipV",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_FLIPV,{v:e,dispatch:t})}},{key:"invert",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_INVERT,{invert:e,dispatch:t})}},{key:"scale",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.emit(So.TOOL_SCALE,{scale:e,dispatch:t})}},{key:"reset",value:function(){var e=Po.rotate,t=Po.x,n=Po.y,r=Po.scale;this.emit(So.TOOL_ROTATION,{rotate:e}),this.emit(So.TOOL_TRANSLATE,{offset:{x:t,y:n}}),this.emit(So.TOOL_SCALE,{scale:r}),this.emit(So.TOOL_WWWC,{wwwc:{ww:0,wc:0}}),this.emit(So.TOOL_FLIPH,{h:!1}),this.emit(So.TOOL_FLIPV,{v:!1}),this.emit(So.TOOL_INVERT,{invert:!1})}},{key:"play",value:function(e){var t=this;clearInterval(this.playInterval);var n=Math.max(.25,Math.min(e,5));this.playInterval=setInterval((function(){t.emit(So.TOOL_STACK_CHANGE,{delta:1,loop:!0})}),1e3/n)}},{key:"stop",value:function(){clearInterval(this.playInterval)}}]),n}();Function.prototype.debounce=function(e,t){var n=this,r=null,i=e;return function(){var e=t||this,a=arguments;function o(){n.apply(e,a),r=null}r&&clearTimeout(r),r=setTimeout(o,i)}},Function.prototype.throttle=function(e,t){var n=this,r=null,i=e;return function(){var e=t||this,a=arguments,o=ia();(!r||o-r>=i)&&(r=o,n.apply(e,a))}};var Co=oe.f,Eo=function(e){return function(t){for(var n,r=Y(t),i=G(r),a=i.length,o=0,s=[];a>o;)n=i[o++],d&&!Co.call(r,n)||s.push(e?[n,r[n]]:r[n]);return s}},Ao=Eo(!1);p(p.S,"Object",{values:function(e){return Ao(e)}});var Ro=l.Object.values,Io=Math.PI/180;var Oo="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},Lo={_global:Oo,version:"8.1.3",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(e){}.toString()),dblClickWindow:400,getAngle:function(e){return Lo.angleDeg?e*Io:e},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return Lo.DD.isDragging},isDragReady:function(){return!!Lo.DD.node},document:Oo.document,_injectGlobal:function(e){Oo.Konva=e}},Mo=function(e){Lo[e.prototype.getClassName()]=e};Lo._injectGlobal(Lo);var No=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1,0,0];kr(this,e),this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}return Tr(e,[{key:"reset",value:function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}},{key:"copy",value:function(){return new e(this.m)}},{key:"copyInto",value:function(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}},{key:"point",value:function(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}},{key:"translate",value:function(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}},{key:"scale",value:function(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;return this.m[0]=r,this.m[1]=i,this.m[2]=a,this.m[3]=o,this}},{key:"getTranslation",value:function(){return{x:this.m[4],y:this.m[5]}}},{key:"skew",value:function(e,t){var n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,a=this.m[3]+this.m[1]*e;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=o,this}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=o,this}},{key:"getMatrix",value:function(){return this.m}},{key:"setAbsolutePosition",value:function(e,t){var n=this.m[0],r=this.m[1],i=this.m[2],a=this.m[3],o=this.m[4],s=(n*(t-this.m[5])-r*(e-o))/(n*a-r*i),u=(e-o-i*s)/n;return this.translate(u,s)}},{key:"decompose",value:function(){var e=this.m[0],t=this.m[1],n=this.m[2],r=this.m[3],i=e*r-t*n,a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=e||0!=t){var o=Math.sqrt(e*e+t*t);a.rotation=t>0?Math.acos(e/o):-Math.acos(e/o),a.scaleX=o,a.scaleY=i/o,a.skewX=(e*n+t*r)/i,a.skewY=0}else if(0!=n||0!=r){var s=Math.sqrt(n*n+r*r);a.rotation=Math.PI/2-(r>0?Math.acos(-n/s):-Math.acos(n/s)),a.scaleX=i/s,a.scaleY=s,a.skewX=0,a.skewY=(e*n+t*r)/i}return a.rotation=Vo._getRotation(a.rotation),a}}]),e}(),Fo=Math.PI/180,Bo=180/Math.PI,qo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},Uo=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,Go=[],zo="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(e){setTimeout(e,60)},Vo={_isElement:function(e){return!(!e||1!=e.nodeType)},_isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},_isPlainObject:function(e){return!!e&&e.constructor===Object},_isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},_isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&!isNaN(e)&&isFinite(e)},_isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},_isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},isObject:function(e){return e instanceof Object},isValidSelector:function(e){if("string"!=typeof e)return!1;var t=e[0];return"#"===t||"."===t||t===t.toUpperCase()},_sign:function(e){return 0===e||e>0?1:-1},requestAnimFrame:function(e){Go.push(e),1===Go.length&&zo((function(){var e=Go;Go=[],e.forEach((function(e){e()}))}))},createCanvasElement:function(){var e=document.createElement("canvas");try{e.style=e.style||{}}catch(e){}return e},createImageElement:function(){return document.createElement("img")},_isInDocument:function(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_urlToImage:function(e,t){var n=Vo.createImageElement();n.onload=function(){t(n)},n.src=e},_rgbToHex:function(e,t,n){return((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},_hexToRgb:function(e){e=e.replace("#","");var t=ci(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},getRandomColor:function(){for(var e=(16777215*Math.random()<<0).toString(16);e.length<6;)e="0"+e;return"#"+e},getRGB:function(e){var t;return e in qo?{r:(t=qo[e])[0],g:t[1],b:t[2]}:"#"===e[0]?this._hexToRgb(e.substring(1)):"rgb("===e.substr(0,4)?(t=Uo.exec(e.replace(/ /g,"")),{r:ci(t[1],10),g:ci(t[2],10),b:ci(t[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(e){return e=e||"black",Vo._namedColorToRBA(e)||Vo._hex3ColorToRGBA(e)||Vo._hex6ColorToRGBA(e)||Vo._rgbColorToRGBA(e)||Vo._rgbaColorToRGBA(e)||Vo._hslColorToRGBA(e)},_namedColorToRBA:function(e){var t=qo[e.toLowerCase()];return t?{r:t[0],g:t[1],b:t[2],a:1}:null},_rgbColorToRGBA:function(e){if(0===e.indexOf("rgb(")){var t=(e=e.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:1}}},_rgbaColorToRGBA:function(e){if(0===e.indexOf("rgba(")){var t=(e=e.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:t[3]}}},_hex6ColorToRGBA:function(e){if("#"===e[0]&&7===e.length)return{r:ci(e.slice(1,3),16),g:ci(e.slice(3,5),16),b:ci(e.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(e){if("#"===e[0]&&4===e.length)return{r:ci(e[1]+e[1],16),g:ci(e[2]+e[2],16),b:ci(e[3]+e[3],16),a:1}},_hslColorToRGBA:function(e){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(e)){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e),n=ro(d=t)||eo(d)||to(d)||io();n[0];var r,i,a,o=n.slice(1),s=Number(o[0])/360,u=Number(o[1])/100,l=Number(o[2])/100;if(0===u)return a=255*l,{r:Math.round(a),g:Math.round(a),b:Math.round(a),a:1};for(var c=2*l-(r=l<.5?l*(1+u):l+u-l*u),h=[0,0,0],f=0;f<3;f++)(i=s+1/3*-(f-1))<0&&i++,i>1&&i--,a=6*i<1?c+6*(r-c)*i:2*i<1?r:3*i<2?c+(r-c)*(2/3-i)*6:c,h[f]=255*a;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}var d},haveIntersection:function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},cloneObject:function(e){var t={};for(var n in e)this._isPlainObject(e[n])?t[n]=this.cloneObject(e[n]):this._isArray(e[n])?t[n]=this.cloneArray(e[n]):t[n]=e[n];return t},cloneArray:function(e){return e.slice(0)},degToRad:function(e){return e*Fo},radToDeg:function(e){return e*Bo},_degToRad:function(e){return Vo.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),Vo.degToRad(e)},_radToDeg:function(e){return Vo.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),Vo.radToDeg(e)},_getRotation:function(e){return Lo.angleDeg?Vo.radToDeg(e):e},_capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},throw:function(e){throw new Error("Konva error: "+e)},error:function(e){console.error("Konva error: "+e)},warn:function(e){Lo.showWarnings&&console.warn("Konva warning: "+e)},each:function(e,t){for(var n in e)t(n,e[n])},_inRange:function(e,t,n){return t<=e&&e<n},_getProjectionToSegment:function(e,t,n,r,i,a){var o,s,u,l=(e-n)*(e-n)+(t-r)*(t-r);if(0==l)o=e,s=t,u=(i-n)*(i-n)+(a-r)*(a-r);else{var c=((i-e)*(n-e)+(a-t)*(r-t))/l;c<0?(o=e,s=t,u=(e-i)*(e-i)+(t-a)*(t-a)):c>1?(o=n,s=r,u=(n-i)*(n-i)+(r-a)*(r-a)):u=((o=e+c*(n-e))-i)*(o-i)+((s=t+c*(r-t))-a)*(s-a)}return[o,s,u]},_getProjectionToLine:function(e,t,n){var r=Vo.cloneObject(e),i=Number.MAX_VALUE;return t.forEach((function(a,o){if(n||o!==t.length-1){var s=t[(o+1)%t.length],u=Vo._getProjectionToSegment(a.x,a.y,s.x,s.y,e.x,e.y),l=u[0],c=u[1],h=u[2];h<i&&(r.x=l,r.y=c,i=h)}})),r},_prepareArrayForTween:function(e,t,n){var r,i=[],a=[];if(e.length>t.length){var o=t;t=e,e=o}for(r=0;r<e.length;r+=2)i.push({x:e[r],y:e[r+1]});for(r=0;r<t.length;r+=2)a.push({x:t[r],y:t[r+1]});var s=[];return a.forEach((function(e){var t=Vo._getProjectionToLine(e,i,n);s.push(t.x),s.push(t.y)})),s},_prepareToStringify:function(e){var t;for(var n in e.visitedByCircularReferenceRemoval=!0,e)if(e.hasOwnProperty(n)&&e[n]&&"object"==Lt(e[n]))if(t=Ge(e,n),e[n].visitedByCircularReferenceRemoval||Vo._isElement(e[n])){if(!t.configurable)return null;delete e[n]}else if(null===Vo._prepareToStringify(e[n])){if(!t.configurable)return null;delete e[n]}return delete e.visitedByCircularReferenceRemoval,e},_assign:function(e,t){for(var n in t)e[n]=t[n];return e},_getFirstPointerId:function(e){return e.touches?e.changedTouches[0].identifier:999}},Wo={get isDragging(){var e=!1;return Wo._dragElements.forEach((function(t){"dragging"===t.dragStatus&&(e=!0)})),e},justDragged:!1,get node(){var e;return Wo._dragElements.forEach((function(t){e=t.node})),e},_dragElements:new jr,_drag:function(e){var t=[];Wo._dragElements.forEach((function(n,r){var i=n.node,a=i.getStage();a.setPointersPositions(e),void 0===n.pointerId&&(n.pointerId=Vo._getFirstPointerId(e));var o=a._changedPointerPositions.find((function(e){return e.id===n.pointerId}));if(o){if("dragging"!==n.dragStatus){var s=i.dragDistance();if(Math.max(Math.abs(o.x-n.startPointerPos.x),Math.abs(o.y-n.startPointerPos.y))<s)return;if(i.startDrag({evt:e}),!i.isDragging())return}i._setDragPosition(e,n),t.push(i)}})),t.forEach((function(t){t.fire("dragmove",{type:"dragmove",target:t,evt:e},!0)}))},_endDragBefore:function(e){Wo._dragElements.forEach((function(t){var n=t.node.getStage();if(e&&n.setPointersPositions(e),n._changedPointerPositions.find((function(e){return e.id===t.pointerId}))){"dragging"!==t.dragStatus&&"stopped"!==t.dragStatus||(Wo.justDragged=!0,Lo._mouseListenClick=!1,Lo._touchListenClick=!1,Lo._pointerListenClick=!1,t.dragStatus="stopped");var r=t.node.getLayer()||t.node instanceof Lo.Stage&&t.node;r&&r.batchDraw()}}))},_endDragAfter:function(e){Wo._dragElements.forEach((function(t,n){"stopped"===t.dragStatus&&t.node.fire("dragend",{type:"dragend",target:t.node,evt:e},!0),"dragging"!==t.dragStatus&&Wo._dragElements.delete(n)}))}};Lo.isBrowser&&(window.addEventListener("mouseup",Wo._endDragBefore,!0),window.addEventListener("touchend",Wo._endDragBefore,!0),window.addEventListener("mousemove",Wo._drag),window.addEventListener("touchmove",Wo._drag),window.addEventListener("mouseup",Wo._endDragAfter,!1),window.addEventListener("touchend",Wo._endDragAfter,!1)),p(p.S,"Reflect",{get:function e(t,n){var r,i,a=arguments.length<3?t:arguments[2];return ye(t)===a?t[n]:(r=Be.f(t,n))?x(r,"value")?r.value:void 0!==r.get?r.get.call(a):void 0:S(i=Wt(t))?e(i,n,a):void 0}});var jo=l.Reflect.get;function Ho(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wa(e)););return e}function Yo(e,t,n){return(Yo="undefined"!=typeof Reflect&&jo?jo:function(e,t,n){var r=Ho(e,t);if(r){var i=Ge(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Zo(e){return Vo._isString(e)?'"'+e+'"':"[object Number]"===Object.prototype.toString.call(e)||Vo._isBoolean(e)?e:Object.prototype.toString.call(e)}function Xo(){if(Lo.isUnminified)return function(e,t){return Vo._isNumber(e)||Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),e}}function Ko(){if(Lo.isUnminified)return function(e,t){return Vo._isNumber(e)||"auto"===e||Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),e}}function Jo(){if(Lo.isUnminified)return function(e,t){return Vo._isString(e)||Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),e}}function $o(){if(Lo.isUnminified)return function(e,t){var n=Vo._isString(e),r="[object CanvasGradient]"===Object.prototype.toString.call(e)||e&&e.addColorStop;return n||r||Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),e}}function Qo(){if(Lo.isUnminified)return function(e,t){return!0===e||!1===e||Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),e}}var es={addGetterSetter:function(e,t,n,r,i){es.addGetter(e,t,n),es.addSetter(e,t,r,i),es.addOverloadedGetterSetter(e,t)},addGetter:function(e,t,n){var r="get"+Vo._capitalize(t);e.prototype[r]=e.prototype[r]||function(){var e=this.attrs[t];return void 0===e?n:e}},addSetter:function(e,t,n,r){var i="set"+Vo._capitalize(t);e.prototype[i]||es.overWriteSetter(e,t,n,r)},overWriteSetter:function(e,t,n,r){var i="set"+Vo._capitalize(t);e.prototype[i]=function(e){return n&&null!=e&&(e=n.call(this,e,t)),this._setAttr(t,e),r&&r.call(this),this}},addComponentsGetterSetter:function(e,t,n,r,i){var a,o,s=n.length,u=Vo._capitalize,l="get"+u(t),c="set"+u(t);e.prototype[l]=function(){var e={};for(a=0;a<s;a++)e[o=n[a]]=this.getAttr(t+u(o));return e};var h=function(e){if(Lo.isUnminified)return function(t,n){return Vo.isObject(t)||Vo.warn(Zo(t)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+e),t}}(n);e.prototype[c]=function(e){var n,a=this.attrs[t];for(n in r&&(e=r.call(this,e)),h&&h.call(this,e,t),e)e.hasOwnProperty(n)&&this._setAttr(t+u(n),e[n]);return this._fireChangeEvent(t,a,e),i&&i.call(this),this},es.addOverloadedGetterSetter(e,t)},addOverloadedGetterSetter:function(e,t){var n=Vo._capitalize(t),r="set"+n,i="get"+n;e.prototype[t]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter:function(e,t,n,r){Vo.error("Adding deprecated "+t);var i="get"+Vo._capitalize(t),a=t+" property is deprecated and will be removed soon. Look at Konva change log for more information.";e.prototype[i]=function(){Vo.error(a);var e=this.attrs[t];return void 0===e?n:e},es.addSetter(e,t,r,(function(){Vo.error(a)})),es.addOverloadedGetterSetter(e,t)},backCompat:function(e,t){Vo.each(t,(function(t,n){var r=e.prototype[n],i="get"+Vo._capitalize(t),a="set"+Vo._capitalize(t);function o(){r.apply(this,arguments),Vo.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}e.prototype[t]=o,e.prototype[i]=o,e.prototype[a]=o}))},afterSetFilter:function(){this._filterUpToDate=!1}};function ts(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}function ns(e){var t,n,r=[],i=e.length,a=Vo;for(t=0;t<i;t++)n=e[t],a._isNumber(n)?n=Math.round(1e3*n)/1e3:a._isString(n)||(n+=""),r.push(n);return r}var rs=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],is=function(){function e(t){kr(this,e),this.canvas=t,this._context=t._canvas.getContext("2d"),Lo.enableTrace&&(this.traceArr=[],this._enableTrace())}return Tr(e,[{key:"fillShape",value:function(e){e.fillEnabled()&&this._fill(e)}},{key:"_fill",value:function(e){}},{key:"strokeShape",value:function(e){e.hasStroke()&&this._stroke(e)}},{key:"_stroke",value:function(e){}},{key:"fillStrokeShape",value:function(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}},{key:"getTrace",value:function(e,t){var n,r,i,a,o=this.traceArr,s=o.length,u="";for(n=0;n<s;n++)(i=(r=o[n]).method)?(a=r.args,u+=i,e?u+="()":Vo._isArray(a[0])?u+="(["+a.join(",")+"])":(t&&(a=a.map((function(e){return"number"==typeof e?Math.floor(e):e}))),u+="("+a.join(",")+")")):(u+=r.property,e||(u+="="+r.val)),u+=";";return u}},{key:"clearTrace",value:function(){this.traceArr=[]}},{key:"_trace",value:function(e){var t=this.traceArr;t.push(e),t.length>=100&&t.shift()}},{key:"reset",value:function(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}},{key:"getCanvas",value:function(){return this.canvas}},{key:"clear",value:function(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}},{key:"_applyLineCap",value:function(e){var t=e.getLineCap();t&&this.setAttr("lineCap",t)}},{key:"_applyOpacity",value:function(e){var t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)}},{key:"_applyLineJoin",value:function(e){var t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}},{key:"setAttr",value:function(e,t){this._context[e]=t}},{key:"arc",value:function(e,t,n,r,i,a){this._context.arc(e,t,n,r,i,a)}},{key:"arcTo",value:function(e,t,n,r,i){this._context.arcTo(e,t,n,r,i)}},{key:"beginPath",value:function(){this._context.beginPath()}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){this._context.bezierCurveTo(e,t,n,r,i,a)}},{key:"clearRect",value:function(e,t,n,r){this._context.clearRect(e,t,n,r)}},{key:"clip",value:function(){this._context.clip()}},{key:"closePath",value:function(){this._context.closePath()}},{key:"createImageData",value:function(e,t){var n=arguments;return 2===n.length?this._context.createImageData(e,t):1===n.length?this._context.createImageData(e):void 0}},{key:"createLinearGradient",value:function(e,t,n,r){return this._context.createLinearGradient(e,t,n,r)}},{key:"createPattern",value:function(e,t){return this._context.createPattern(e,t)}},{key:"createRadialGradient",value:function(e,t,n,r,i,a){return this._context.createRadialGradient(e,t,n,r,i,a)}},{key:"drawImage",value:function(e,t,n,r,i,a,o,s,u){var l=arguments,c=this._context;3===l.length?c.drawImage(e,t,n):5===l.length?c.drawImage(e,t,n,r,i):9===l.length&&c.drawImage(e,t,n,r,i,a,o,s,u)}},{key:"ellipse",value:function(e,t,n,r,i,a,o,s){this._context.ellipse(e,t,n,r,i,a,o,s)}},{key:"isPointInPath",value:function(e,t){return this._context.isPointInPath(e,t)}},{key:"fill",value:function(e){e?this._context.fill(e):this._context.fill()}},{key:"fillRect",value:function(e,t,n,r){this._context.fillRect(e,t,n,r)}},{key:"strokeRect",value:function(e,t,n,r){this._context.strokeRect(e,t,n,r)}},{key:"fillText",value:function(e,t,n,r){r?this._context.fillText(e,t,n,r):this._context.fillText(e,t,n)}},{key:"measureText",value:function(e){return this._context.measureText(e)}},{key:"getImageData",value:function(e,t,n,r){return this._context.getImageData(e,t,n,r)}},{key:"lineTo",value:function(e,t){this._context.lineTo(e,t)}},{key:"moveTo",value:function(e,t){this._context.moveTo(e,t)}},{key:"rect",value:function(e,t,n,r){this._context.rect(e,t,n,r)}},{key:"putImageData",value:function(e,t,n){this._context.putImageData(e,t,n)}},{key:"quadraticCurveTo",value:function(e,t,n,r){this._context.quadraticCurveTo(e,t,n,r)}},{key:"restore",value:function(){this._context.restore()}},{key:"rotate",value:function(e){this._context.rotate(e)}},{key:"save",value:function(){this._context.save()}},{key:"scale",value:function(e,t){this._context.scale(e,t)}},{key:"setLineDash",value:function(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}},{key:"getLineDash",value:function(){return this._context.getLineDash()}},{key:"setTransform",value:function(e,t,n,r,i,a){this._context.setTransform(e,t,n,r,i,a)}},{key:"stroke",value:function(e){e?this._context.stroke(e):this._context.stroke()}},{key:"strokeText",value:function(e,t,n,r){this._context.strokeText(e,t,n,r)}},{key:"transform",value:function(e,t,n,r,i,a){this._context.transform(e,t,n,r,i,a)}},{key:"translate",value:function(e,t){this._context.translate(e,t)}},{key:"_enableTrace",value:function(){var e,t,n=this,r=rs.length,i=this.setAttr,a=function(e){var r,i=n[e];n[e]=function(){return t=ns(Array.prototype.slice.call(arguments,0)),r=i.apply(n,arguments),n._trace({method:e,args:t}),r}};for(e=0;e<r;e++)a(rs[e]);n.setAttr=function(){i.apply(n,arguments);var e=arguments[0],t=arguments[1];"shadowOffsetX"!==e&&"shadowOffsetY"!==e&&"shadowBlur"!==e||(t/=this.canvas.getPixelRatio()),n._trace({property:e,val:t})}}},{key:"_applyGlobalCompositeOperation",value:function(e){var t=e.attrs.globalCompositeOperation;!t||"source-over"===t||this.setAttr("globalCompositeOperation",t)}}]),e}();["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(e){m(is.prototype,e,{get:function(){return this._context[e]},set:function(t){this._context[e]=t}})}));var as,os=function(e){ya(n,is);var t=ts(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_fillColor",value:function(e){var t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}},{key:"_fillPattern",value:function(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}},{key:"_fillLinearGradient",value:function(e){var t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}},{key:"_fillRadialGradient",value:function(e){var t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}},{key:"_fill",value:function(e){var t=e.fill(),n=e.getFillPriority();if(t&&"color"===n)this._fillColor(e);else{var r=e.getFillPatternImage();if(r&&"pattern"===n)this._fillPattern(e);else{var i=e.getFillLinearGradientColorStops();if(i&&"linear-gradient"===n)this._fillLinearGradient(e);else{var a=e.getFillRadialGradientColorStops();a&&"radial-gradient"===n?this._fillRadialGradient(e):t?this._fillColor(e):r?this._fillPattern(e):i?this._fillLinearGradient(e):a&&this._fillRadialGradient(e)}}}}},{key:"_strokeLinearGradient",value:function(e){var t=e.getStrokeLinearGradientStartPoint(),n=e.getStrokeLinearGradientEndPoint(),r=e.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(var a=0;a<r.length;a+=2)i.addColorStop(r[a],r[a+1]);this.setAttr("strokeStyle",i)}}},{key:"_stroke",value:function(e){var t=e.dash(),n=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!n){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),n||this.restore()}}},{key:"_applyShadow",value:function(e){var t,n,r,i=null!==(t=e.getShadowRGBA())&&void 0!==t?t:"black",a=null!==(n=e.getShadowBlur())&&void 0!==n?n:5,o=null!==(r=e.getShadowOffset())&&void 0!==r?r:{x:0,y:0},s=e.getAbsoluteScale(),u=this.canvas.getPixelRatio(),l=s.x*u,c=s.y*u;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",a*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",o.x*l),this.setAttr("shadowOffsetY",o.y*c)}}]),n}(),ss=function(e){ya(n,is);var t=ts(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_fill",value:function(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}},{key:"strokeShape",value:function(e){e.hasHitStroke()&&this._stroke(e)}},{key:"_stroke",value:function(e){if(e.hasHitStroke()){var t=e.getStrokeScaleEnabled();if(!t){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(e);var r=e.hitStrokeWidth(),i="auto"===r?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}]),n}();function us(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var ls=function(){function e(t){kr(this,e),this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var n=(t||{}).pixelRatio||Lo.pixelRatio||function(){if(as)return as;var e=Vo.createCanvasElement().getContext("2d");return as=(Lo._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}();this.pixelRatio=n,this._canvas=Vo.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return Tr(e,[{key:"getContext",value:function(){return this.context}},{key:"getPixelRatio",value:function(){return this.pixelRatio}},{key:"setPixelRatio",value:function(e){var t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}},{key:"setWidth",value:function(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";var t=this.pixelRatio;this.getContext()._context.scale(t,t)}},{key:"setHeight",value:function(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";var t=this.pixelRatio;this.getContext()._context.scale(t,t)}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setSize",value:function(e,t){this.setWidth(e||0),this.setHeight(t||0)}},{key:"toDataURL",value:function(e,t){try{return this._canvas.toDataURL(e,t)}catch(e){try{return this._canvas.toDataURL()}catch(e){return Vo.error("Unable to get data URL. "+e.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}]),e}();es.addGetterSetter(ls,"pixelRatio",void 0,Xo());var cs=function(e){ya(n,ls);var t=us(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:0,height:0};return kr(this,n),(e=t.call(this,r)).context=new os(xa(e)),e.setSize(r.width,r.height),e}return n}(),hs=function(e){ya(n,ls);var t=us(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:0,height:0};return kr(this,n),(e=t.call(this,r)).hitCanvas=!0,e.context=new ss(xa(e)),e.setSize(r.width,r.height),e}return n}(),fs=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(" "),ds=1,ps=function(){function e(t){kr(this,e),this._id=ds++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new jr,this._attachedDepsListeners=new jr,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}return Tr(e,[{key:"hasChildren",value:function(){return!1}},{key:"_clearCache",value:function(e){"transform"!==e&&"absoluteTransform"!==e||!this._cache.get(e)?e?this._cache.delete(e):this._cache.clear():this._cache.get(e).dirty=!0}},{key:"_getCache",value:function(e,t){var n=this._cache.get(e);return(void 0===n||("transform"===e||"absoluteTransform"===e)&&!0===n.dirty)&&(n=t.call(this),this._cache.set(e,n)),n}},{key:"_calculate",value:function(e,t,n){var r=this;if(!this._attachedDepsListeners.get(e)){var i=t.map((function(e){return e+"Change.konva"})).join(" ");this.on(i,(function(){r._clearCache(e)})),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,n)}},{key:"_getCanvasCache",value:function(){return this._cache.get("canvas")}},{key:"_clearSelfAndDescendantCache",value:function(e){this._clearCache(e),"absoluteTransform"===e&&this.fire("absoluteTransformChange")}},{key:"clearCache",value:function(){return this._cache.delete("canvas"),this._clearSelfAndDescendantCache(),this._requestDraw(),this}},{key:"cache",value:function(e){var t=e||{},n={};void 0!==t.x&&void 0!==t.y&&void 0!==t.width&&void 0!==t.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var r=Math.ceil(t.width||n.width),i=Math.ceil(t.height||n.height),a=t.pixelRatio,o=void 0===t.x?n.x:t.x,s=void 0===t.y?n.y:t.y,u=t.offset||0,l=t.drawBorder||!1,c=t.hitCanvasPixelRatio||1;if(r&&i){o-=u,s-=u;var h=new cs({pixelRatio:a,width:r+=2*u,height:i+=2*u}),f=new cs({pixelRatio:a,width:0,height:0}),d=new hs({pixelRatio:c,width:r,height:i}),p=h.getContext(),v=d.getContext();return d.isCache=!0,h.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,!1===t.imageSmoothingEnabled&&(h.getContext()._context.imageSmoothingEnabled=!1,f.getContext()._context.imageSmoothingEnabled=!1),p.save(),v.save(),p.translate(-o,-s),v.translate(-o,-s),this._isUnderCache=!0,this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this.drawScene(h,this),this.drawHit(d,this),this._isUnderCache=!1,p.restore(),v.restore(),l&&(p.save(),p.beginPath(),p.rect(0,0,r,i),p.closePath(),p.setAttr("strokeStyle","red"),p.setAttr("lineWidth",5),p.stroke(),p.restore()),this._cache.set("canvas",{scene:h,filter:f,hit:d,x:o,y:s}),this._requestDraw(),this}Vo.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}},{key:"isCached",value:function(){return this._cache.has("canvas")}},{key:"getClientRect",value:function(e){throw new Error('abstract "getClientRect" method call')}},{key:"_transformedRect",value:function(e,t){var n,r,i,a,o=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],s=this.getAbsoluteTransform(t);return o.forEach((function(e){var t=s.point(e);void 0===n&&(n=i=t.x,r=a=t.y),n=Math.min(n,t.x),r=Math.min(r,t.y),i=Math.max(i,t.x),a=Math.max(a,t.y)})),{x:n,y:r,width:i-n,height:a-r}}},{key:"_drawCachedSceneCanvas",value:function(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);var t=this._getCanvasCache();e.translate(t.x,t.y);var n=this._getCachedSceneCanvas(),r=n.pixelRatio;e.drawImage(n._canvas,0,0,n.width/r,n.height/r),e.restore()}},{key:"_drawCachedHitCanvas",value:function(e){var t=this._getCanvasCache(),n=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),e.restore()}},{key:"_getCachedSceneCanvas",value:function(){var e,t,n,r,i=this.filters(),a=this._getCanvasCache(),o=a.scene,s=a.filter,u=s.getContext();if(i){if(!this._filterUpToDate){var l=o.pixelRatio;s.setSize(o.width/o.pixelRatio,o.height/o.pixelRatio);try{for(e=i.length,u.clear(),u.drawImage(o._canvas,0,0,o.getWidth()/l,o.getHeight()/l),t=u.getImageData(0,0,s.getWidth(),s.getHeight()),n=0;n<e;n++)"function"==typeof(r=i[n])?(r.call(this,t),u.putImageData(t,0,0)):Vo.error("Filter should be type of function, but got "+Lt(r)+" instead. Please check correct filters")}catch(e){Vo.error("Unable to apply filter. "+e.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return s}return o}},{key:"on",value:function(e,t){if(this._cache&&this._cache.delete("allEventListeners"),3===arguments.length)return this._delegate.apply(this,arguments);var n,r,i,a,o=e.split(" "),s=o.length;for(n=0;n<s;n++)i=(r=o[n].split("."))[0],a=r[1]||"",this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:a,handler:t});return this}},{key:"off",value:function(e,t){var n,r,i,a,o,s=(e||"").split(" "),u=s.length;if(this._cache&&this._cache.delete("allEventListeners"),!e)for(r in this.eventListeners)this._off(r);for(n=0;n<u;n++)if(a=(i=s[n].split("."))[0],o=i[1],a)this.eventListeners[a]&&this._off(a,o,t);else for(r in this.eventListeners)this._off(r,o,t);return this}},{key:"dispatchEvent",value:function(e){var t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}},{key:"addEventListener",value:function(e,t){return this.on(e,(function(e){t.call(this,e.evt)})),this}},{key:"removeEventListener",value:function(e){return this.off(e),this}},{key:"_delegate",value:function(e,t,n){var r=this;this.on(e,(function(e){for(var i=e.target.findAncestors(t,!0,r),a=0;a<i.length;a++)(e=Vo.cloneObject(e)).currentTarget=i[a],n.call(i[a],e)}))}},{key:"remove",value:function(){return this.isDragging()&&this.stopDrag(),Wo._dragElements.delete(this._id),this._remove(),this}},{key:"_clearCaches",value:function(){this._clearSelfAndDescendantCache("absoluteTransform"),this._clearSelfAndDescendantCache("absoluteOpacity"),this._clearSelfAndDescendantCache("absoluteScale"),this._clearSelfAndDescendantCache("stage"),this._clearSelfAndDescendantCache("visible"),this._clearSelfAndDescendantCache("listening")}},{key:"_remove",value:function(){this._clearCaches();var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}},{key:"destroy",value:function(){return this.remove(),this}},{key:"getAttr",value:function(e){var t="get"+Vo._capitalize(e);return Vo._isFunction(this[t])?this[t]():this.attrs[e]}},{key:"getAncestors",value:function(){for(var e=this.getParent(),t=[];e;)t.push(e),e=e.getParent();return t}},{key:"getAttrs",value:function(){return this.attrs||{}}},{key:"setAttrs",value:function(e){var t=this;return this._batchTransformChanges((function(){var n,r;if(!e)return t;for(n in e)"children"!==n&&(r="set"+Vo._capitalize(n),Vo._isFunction(t[r])?t[r](e[n]):t._setAttr(n,e[n]))})),this}},{key:"isListening",value:function(){return this._getCache("listening",this._isListening)}},{key:"_isListening",value:function(e){if(!this.listening())return!1;var t=this.getParent();return!t||t===e||this===e||t._isListening(e)}},{key:"isVisible",value:function(){return this._getCache("visible",this._isVisible)}},{key:"_isVisible",value:function(e){if(!this.visible())return!1;var t=this.getParent();return!t||t===e||this===e||t._isVisible(e)}},{key:"shouldDrawHit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._isVisible(e)&&this._isListening(e);var n=this.getLayer(),r=!1;Wo._dragElements.forEach((function(e){"dragging"===e.dragStatus&&("Stage"===e.node.nodeType||e.node.getLayer()===n)&&(r=!0)}));var i=!t&&!Lo.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!i}},{key:"show",value:function(){return this.visible(!0),this}},{key:"hide",value:function(){return this.visible(!1),this}},{key:"getZIndex",value:function(){return this.index||0}},{key:"getAbsoluteZIndex",value:function(){var e,t,n,r,i=this.getDepth(),a=this,o=0;return"Stage"!==a.nodeType&&function s(u){for(e=[],t=u.length,n=0;n<t;n++)r=u[n],o++,"Shape"!==r.nodeType&&(e=e.concat(r.getChildren().slice())),r._id===a._id&&(n=t);e.length>0&&e[0].getDepth()<=i&&s(e)}(a.getStage().getChildren()),o}},{key:"getDepth",value:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e}},{key:"_batchTransformChanges",value:function(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")),this._needClearTransformCache=!1}},{key:"setPosition",value:function(e){var t=this;return this._batchTransformChanges((function(){t.x(e.x),t.y(e.y)})),this}},{key:"getPosition",value:function(){return{x:this.x(),y:this.y()}}},{key:"getRelativePointerPosition",value:function(){if(!this.getStage())return null;var e=this.getStage().getPointerPosition();if(!e)return null;var t=this.getAbsoluteTransform().copy();return t.invert(),t.point(e)}},{key:"getAbsolutePosition",value:function(e){for(var t=!1,n=this.parent;n;){if(n.isCached()){t=!0;break}n=n.parent}t&&!e&&(e=!0);var r=this.getAbsoluteTransform(e).getMatrix(),i=new No,a=this.offset();return i.m=r.slice(),i.translate(a.x,a.y),i.getTranslation()}},{key:"setAbsolutePosition",value:function(e){var t=this._clearTransform();this.attrs.x=t.x,this.attrs.y=t.y,delete t.x,delete t.y,this._clearCache("transform");var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(e.x,e.y),e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(t),this.setPosition({x:e.x,y:e.y}),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"),this}},{key:"_setTransform",value:function(e){var t;for(t in e)this.attrs[t]=e[t]}},{key:"_clearTransform",value:function(){var e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}},{key:"move",value:function(e){var t=e.x,n=e.y,r=this.x(),i=this.y();return void 0!==t&&(r+=t),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this}},{key:"_eachAncestorReverse",value:function(e,t){var n,r,i=[],a=this.getParent();if(!t||t._id!==this._id){for(i.unshift(this);a&&(!t||a._id!==t._id);)i.unshift(a),a=a.parent;for(n=i.length,r=0;r<n;r++)e(i[r])}}},{key:"rotate",value:function(e){return this.rotation(this.rotation()+e),this}},{key:"moveToTop",value:function(){if(!this.parent)return Vo.warn("Node has no parent. moveToTop function is ignored."),!1;var e=this.index;return this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0}},{key:"moveUp",value:function(){if(!this.parent)return Vo.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index;return e<this.parent.getChildren().length-1&&(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0)}},{key:"moveDown",value:function(){if(!this.parent)return Vo.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0)}},{key:"moveToBottom",value:function(){if(!this.parent)return Vo.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}},{key:"setZIndex",value:function(e){if(!this.parent)return Vo.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&Vo.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}},{key:"getAbsoluteOpacity",value:function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)}},{key:"_getAbsoluteOpacity",value:function(){var e=this.opacity(),t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}},{key:"moveTo",value:function(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}},{key:"toObject",value:function(){var e,t,n,r,i={},a=this.getAttrs();for(e in i.attrs={},a)t=a[e],Vo.isObject(t)&&!Vo._isPlainObject(t)&&!Vo._isArray(t)||(n="function"==typeof this[e]&&this[e],delete a[e],r=n?n.call(this):null,a[e]=t,r!==t&&(i.attrs[e]=t));return i.className=this.getClassName(),Vo._prepareToStringify(i)}},{key:"toJSON",value:function(){return _i(this.toObject())}},{key:"getParent",value:function(){return this.parent}},{key:"findAncestors",value:function(e,t,n){var r=[];t&&this._isMatch(e)&&r.push(this);for(var i=this.parent;i;){if(i===n)return r;i._isMatch(e)&&r.push(i),i=i.parent}return r}},{key:"isAncestorOf",value:function(e){return!1}},{key:"findAncestor",value:function(e,t,n){return this.findAncestors(e,t,n)[0]}},{key:"_isMatch",value:function(e){if(!e)return!1;if("function"==typeof e)return e(this);var t,n,r=e.replace(/ /g,"").split(","),i=r.length;for(t=0;t<i;t++)if(n=r[t],Vo.isValidSelector(n)||(Vo.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Vo.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Vo.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}},{key:"getLayer",value:function(){var e=this.getParent();return e?e.getLayer():null}},{key:"getStage",value:function(){return this._getCache("stage",this._getStage)}},{key:"_getStage",value:function(){var e=this.getParent();return e?e.getStage():void 0}},{key:"fire",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.target=t.target||this,n?this._fireAndBubble(e,t):this._fire(e,t),this}},{key:"getAbsoluteTransform",value:function(e){return e?this._getAbsoluteTransform(e):this._getCache("absoluteTransform",this._getAbsoluteTransform)}},{key:"_getAbsoluteTransform",value:function(e){var t;if(e)return t=new No,this._eachAncestorReverse((function(e){var n=e.transformsEnabled();"all"===n?t.multiply(e.getTransform()):"position"===n&&t.translate(e.x()-e.offsetX(),e.y()-e.offsetY())}),e),t;t=this._cache.get("absoluteTransform")||new No,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();var n=this.transformsEnabled();if("all"===n)t.multiply(this.getTransform());else if("position"===n){var r=this.attrs.x||0,i=this.attrs.y||0,a=this.attrs.offsetX||0,o=this.attrs.offsetY||0;t.translate(r-a,i-o)}return t.dirty=!1,t}},{key:"getAbsoluteScale",value:function(e){for(var t=this;t;)t._isUnderCache&&(e=t),t=t.getParent();var n=this.getAbsoluteTransform(e).decompose();return{x:n.scaleX,y:n.scaleY}}},{key:"getAbsoluteRotation",value:function(){return this.getAbsoluteTransform().decompose().rotation}},{key:"getTransform",value:function(){return this._getCache("transform",this._getTransform)}},{key:"_getTransform",value:function(){var e,t,n=this._cache.get("transform")||new No;n.reset();var r=this.x(),i=this.y(),a=Lo.getAngle(this.rotation()),o=null!==(e=this.attrs.scaleX)&&void 0!==e?e:1,s=null!==(t=this.attrs.scaleY)&&void 0!==t?t:1,u=this.attrs.skewX||0,l=this.attrs.skewY||0,c=this.attrs.offsetX||0,h=this.attrs.offsetY||0;return 0===r&&0===i||n.translate(r,i),0!==a&&n.rotate(a),0===u&&0===l||n.skew(u,l),1===o&&1===s||n.scale(o,s),0===c&&0===h||n.translate(-1*c,-1*h),n.dirty=!1,n}},{key:"clone",value:function(e){var t,n,r,i,a,o=Vo.cloneObject(this.attrs);for(t in e)o[t]=e[t];var s=new this.constructor(o);for(t in this.eventListeners)for(r=(n=this.eventListeners[t]).length,i=0;i<r;i++)(a=n[i]).name.indexOf("konva")<0&&(s.eventListeners[t]||(s.eventListeners[t]=[]),s.eventListeners[t].push(a));return s}},{key:"_toKonvaCanvas",value:function(e){e=e||{};var t=this.getClientRect(),n=this.getStage(),r=void 0!==e.x?e.x:t.x,i=void 0!==e.y?e.y:t.y,a=e.pixelRatio||1,o=new cs({width:e.width||t.width||(n?n.width():0),height:e.height||t.height||(n?n.height():0),pixelRatio:a}),s=o.getContext();return s.save(),(r||i)&&s.translate(-1*r,-1*i),this.drawScene(o),s.restore(),o}},{key:"toCanvas",value:function(e){return this._toKonvaCanvas(e)._canvas}},{key:"toDataURL",value:function(e){var t=(e=e||{}).mimeType||null,n=e.quality||null,r=this._toKonvaCanvas(e).toDataURL(t,n);return e.callback&&e.callback(r),r}},{key:"toImage",value:function(e){if(!e||!e.callback)throw"callback required for toImage method config argument";var t=e.callback;delete e.callback,Vo._urlToImage(this.toDataURL(e),(function(e){t(e)}))}},{key:"setSize",value:function(e){return this.width(e.width),this.height(e.height),this}},{key:"getSize",value:function(){return{width:this.width(),height:this.height()}}},{key:"getClassName",value:function(){return this.className||this.nodeType}},{key:"getType",value:function(){return this.nodeType}},{key:"getDragDistance",value:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Lo.dragDistance}},{key:"_off",value:function(e,t,n){var r,i,a,o=this.eventListeners[e];for(r=0;r<o.length;r++)if(i=o[r].name,a=o[r].handler,!("konva"===i&&"konva"!==t||t&&i!==t||n&&n!==a)){if(o.splice(r,1),0===o.length){delete this.eventListeners[e];break}r--}}},{key:"_fireChangeEvent",value:function(e,t,n){this._fire(e+"Change",{oldVal:t,newVal:n})}},{key:"addName",value:function(e){if(!this.hasName(e)){var t=this.name(),n=t?t+" "+e:e;this.name(n)}return this}},{key:"hasName",value:function(e){if(!e)return!1;var t=this.name();return!!t&&-1!==(t||"").split(/\s/g).indexOf(e)}},{key:"removeName",value:function(e){var t=(this.name()||"").split(/\s/g),n=t.indexOf(e);return-1!==n&&(t.splice(n,1),this.name(t.join(" "))),this}},{key:"setAttr",value:function(e,t){var n=this["set"+Vo._capitalize(e)];return Vo._isFunction(n)?n.call(this,t):this._setAttr(e,t),this}},{key:"_requestDraw",value:function(){if(Lo.autoDrawEnabled){var e=this.getLayer()||this.getStage();null==e||e.batchDraw()}}},{key:"_setAttr",value:function(e,t){var n=this.attrs[e];(n!==t||Vo.isObject(t))&&(null==t?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,n,t),this._requestDraw())}},{key:"_setComponentAttr",value:function(e,t,n){var r;void 0!==n&&((r=this.attrs[e])||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=n,this._fireChangeEvent(e,r,n))}},{key:"_fireAndBubble",value:function(e,t,n){if(t&&"Shape"===this.nodeType&&(t.target=this),!(("mouseenter"===e||"mouseleave"===e)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(e,t);var r=("mouseenter"===e||"mouseleave"===e)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!r&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n):this._fireAndBubble.call(this.parent,e,t))}}},{key:"_getProtoListeners",value:function(e){var t=this._cache.get("allEventListeners");if(!t){t={};for(var n=Ht(this);n;)if(n.eventListeners){for(var r in n.eventListeners){var i=n.eventListeners[r],a=t[r]||[];t[r]=i.concat(a)}n=Ht(n)}else n=Ht(n);this._cache.set("allEventListeners",t)}return t[e]}},{key:"_fire",value:function(e,t){(t=t||{}).currentTarget=this,t.type=e;var n=this._getProtoListeners(e);if(n)for(var r=0;r<n.length;r++)n[r].handler.call(this,t);var i=this.eventListeners[e];if(i)for(r=0;r<i.length;r++)i[r].handler.call(this,t)}},{key:"draw",value:function(){return this.drawScene(),this.drawHit(),this}},{key:"_createDragElement",value:function(e){var t=e?e.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition(),i=n._getPointerById(t)||n._changedPointerPositions[0]||r;Wo._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-r.x,y:i.y-r.y},dragStatus:"ready",pointerId:t})}},{key:"startDrag",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Wo._dragElements.has(this._id)||this._createDragElement(e);var n=Wo._dragElements.get(this._id);n.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}},{key:"_setDragPosition",value:function(e,t){var n=this.getStage()._getPointerById(t.pointerId);if(n){var r={x:n.x-t.offset.x,y:n.y-t.offset.y},i=this.dragBoundFunc();if(void 0!==i){var a=i.call(this,r,e);a?r=a:Vo.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===r.x&&this._lastPos.y===r.y||(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}}},{key:"stopDrag",value:function(e){var t=Wo._dragElements.get(this._id);t&&(t.dragStatus="stopped"),Wo._endDragBefore(e),Wo._endDragAfter(e)}},{key:"setDraggable",value:function(e){this._setAttr("draggable",e),this._dragChange()}},{key:"isDragging",value:function(){var e=Wo._dragElements.get(this._id);return!!e&&"dragging"===e.dragStatus}},{key:"_listenDrag",value:function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(e){var t=this;if((!(void 0!==e.evt.button)||Lo.dragButtons.indexOf(e.evt.button)>=0)&&!this.isDragging()){var n=!1;Wo._dragElements.forEach((function(e){t.isAncestorOf(e.node)&&(n=!0)})),n||this._createDragElement(e)}}))}},{key:"_dragChange",value:function(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;var e=Wo._dragElements.get(this._id),t=e&&"dragging"===e.dragStatus,n=e&&"ready"===e.dragStatus;t?this.stopDrag():n&&Wo._dragElements.delete(this._id)}}},{key:"_dragCleanup",value:function(){this.off("mousedown.konva"),this.off("touchstart.konva")}},{key:"isClientRectOnScreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=this.getStage();if(!t)return!1;var n={x:-e.x,y:-e.y,width:t.width()+e.x,height:t.height()+e.y};return Vo.haveIntersection(n,this.getClientRect())}}],[{key:"create",value:function(e,t){return Vo._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}},{key:"_createNode",value:function(t,n){var r,i,a,o=e.prototype.getClassName.call(t),s=t.children;if(n&&(t.attrs.container=n),Lo[o]||(Vo.warn('Can not find a node with class name "'+o+'". Fallback to "Shape".'),o="Shape"),r=new(0,Lo[o])(t.attrs),s)for(i=s.length,a=0;a<i;a++)r.add(e._createNode(s[a]));return r}}]),e}();ps.prototype.nodeType="Node",ps.prototype._attrsAffectingSize=[],ps.prototype.eventListeners={},ps.prototype.on.call(ps.prototype,fs,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform"))})),ps.prototype.on.call(ps.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache("visible")})),ps.prototype.on.call(ps.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache("listening")})),ps.prototype.on.call(ps.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache("absoluteOpacity")}));var vs=es.addGetterSetter;function gs(e,t){var n=void 0!==St&&e[Ot]||e["@@iterator"];if(!n){if(ue(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ms(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Zn(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ms(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ms(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ys(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}vs(ps,"zIndex"),vs(ps,"absolutePosition"),vs(ps,"position"),vs(ps,"x",0,Xo()),vs(ps,"y",0,Xo()),vs(ps,"globalCompositeOperation","source-over",Jo()),vs(ps,"opacity",1,Xo()),vs(ps,"name","",Jo()),vs(ps,"id","",Jo()),vs(ps,"rotation",0,Xo()),es.addComponentsGetterSetter(ps,"scale",["x","y"]),vs(ps,"scaleX",1,Xo()),vs(ps,"scaleY",1,Xo()),es.addComponentsGetterSetter(ps,"skew",["x","y"]),vs(ps,"skewX",0,Xo()),vs(ps,"skewY",0,Xo()),es.addComponentsGetterSetter(ps,"offset",["x","y"]),vs(ps,"offsetX",0,Xo()),vs(ps,"offsetY",0,Xo()),vs(ps,"dragDistance",null,Xo()),vs(ps,"width",0,Xo()),vs(ps,"height",0,Xo()),vs(ps,"listening",!0,Qo()),vs(ps,"preventDefault",!0,Qo()),vs(ps,"filters",null,(function(e){return this._filterUpToDate=!1,e})),vs(ps,"visible",!0,Qo()),vs(ps,"transformsEnabled","all",Jo()),vs(ps,"size"),vs(ps,"dragBoundFunc"),vs(ps,"draggable",!1,Qo()),es.backCompat(ps,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var xs=function(e){ya(n,ps);var t=ys(n);function n(){var e;return kr(this,n),(e=t.apply(this,arguments)).children=[],e}return Tr(n,[{key:"getChildren",value:function(e){if(!e)return this.children||[];var t=this.children||[],n=[];return t.forEach((function(t){e(t)&&n.push(t)})),n}},{key:"hasChildren",value:function(){return this.getChildren().length>0}},{key:"removeChildren",value:function(){return this.getChildren().forEach((function(e){e.parent=null,e.index=0,e.remove()})),this.children=[],this._requestDraw(),this}},{key:"destroyChildren",value:function(){return this.getChildren().forEach((function(e){e.parent=null,e.index=0,e.destroy()})),this.children=[],this._requestDraw(),this}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}var i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}},{key:"destroy",value:function(){return this.hasChildren()&&this.destroyChildren(),Yo(wa(n.prototype),"destroy",this).call(this),this}},{key:"find",value:function(e){return this._generalFind(e,!1)}},{key:"findOne",value:function(e){var t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}},{key:"_generalFind",value:function(e,t){var n=[];return this._descendants((function(r){var i=r._isMatch(e);return i&&n.push(r),!(!i||!t)})),n}},{key:"_descendants",value:function(e){var t,n=gs(this.getChildren());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e(r))return!0;if(r.hasChildren()&&r._descendants(e))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"toObject",value:function(){var e=ps.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach((function(t){e.children.push(t.toObject())})),e}},{key:"isAncestorOf",value:function(e){for(var t=e.getParent();t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}},{key:"clone",value:function(e){var t=ps.prototype.clone.call(this,e);return this.getChildren().forEach((function(e){t.add(e.clone())})),t}},{key:"getAllIntersections",value:function(e){var t=[];return this.find("Shape").forEach((function(n){n.isVisible()&&n.intersects(e)&&t.push(n)})),t}},{key:"_clearSelfAndDescendantCache",value:function(e){var t;Yo(wa(n.prototype),"_clearSelfAndDescendantCache",this).call(this,e),this.isCached()||null===(t=this.children)||void 0===t||t.forEach((function(t){t._clearSelfAndDescendantCache(e)}))}},{key:"_setChildrenIndices",value:function(){var e;null===(e=this.children)||void 0===e||e.forEach((function(e,t){e.index=t})),this._requestDraw()}},{key:"drawScene",value:function(e,t){var n=this.getLayer(),r=e||n&&n.getCanvas(),i=r&&r.getContext(),a=this._getCanvasCache(),o=a&&a.scene,s=r&&r.isCache;if(!this.isVisible()&&!s)return this;if(o){i.save();var u=this.getAbsoluteTransform(t).getMatrix();i.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedSceneCanvas(i),i.restore()}else this._drawChildren("drawScene",r,t);return this}},{key:"drawHit",value:function(e,t){if(!this.shouldDrawHit(t))return this;var n=this.getLayer(),r=e||n&&n.hitCanvas,i=r&&r.getContext(),a=this._getCanvasCache();if(a&&a.hit){i.save();var o=this.getAbsoluteTransform(t).getMatrix();i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",r,t);return this}},{key:"_drawChildren",value:function(e,t,n){var r,i=t&&t.getContext(),a=this.clipWidth(),o=this.clipHeight(),s=this.clipFunc(),u=a&&o||s,l=n===this;if(u){i.save();var c=this.getAbsoluteTransform(n),h=c.getMatrix();if(i.transform(h[0],h[1],h[2],h[3],h[4],h[5]),i.beginPath(),s)s.call(this,i,this);else{var f=this.clipX(),d=this.clipY();i.rect(f,d,a,o)}i.clip(),h=c.copy().invert().getMatrix(),i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}var p=!l&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===e;p&&(i.save(),i._applyGlobalCompositeOperation(this)),null===(r=this.children)||void 0===r||r.forEach((function(r){r[e](t,n)})),p&&i.restore(),u&&i.restore()}},{key:"getClientRect",value:function(e){var t,n,r,i,a,o=(e=e||{}).skipTransform,s=e.relativeTo,u={x:1/0,y:1/0,width:0,height:0},l=this;null===(t=this.children)||void 0===t||t.forEach((function(t){if(t.visible()){var o=t.getClientRect({relativeTo:l,skipShadow:e.skipShadow,skipStroke:e.skipStroke});0===o.width&&0===o.height||(void 0===n?(n=o.x,r=o.y,i=o.x+o.width,a=o.y+o.height):(n=Math.min(n,o.x),r=Math.min(r,o.y),i=Math.max(i,o.x+o.width),a=Math.max(a,o.y+o.height)))}}));for(var c=this.find("Shape"),h=!1,f=0;f<c.length;f++){if(c[f]._isVisible(this)){h=!0;break}}return u=h&&void 0!==n?{x:n,y:r,width:i-n,height:a-r}:{x:0,y:0,width:0,height:0},o?u:this._transformedRect(u,s)}}]),n}();es.addComponentsGetterSetter(xs,"clip",["x","y","width","height"]),es.addGetterSetter(xs,"clipX",void 0,Xo()),es.addGetterSetter(xs,"clipY",void 0,Xo()),es.addGetterSetter(xs,"clipWidth",void 0,Xo()),es.addGetterSetter(xs,"clipHeight",void 0,Xo()),es.addGetterSetter(xs,"clipFunc");var _s=new jr,ws=void 0!==Lo._global.PointerEvent;function bs(e){return _s.get(e)}function Ss(e){return{evt:e,pointerId:e.pointerId}}function ks(e,t){return _s.get(e)===t}function Ps(e,t){Ts(e),t.getStage()&&(_s.set(e,t),ws&&t._fire("gotpointercapture",Ss(new PointerEvent("gotpointercapture"))))}function Ts(e,t){var n=_s.get(e);if(n){var r=n.getStage();r&&r.content,_s.delete(e),ws&&n._fire("lostpointercapture",Ss(new PointerEvent("lostpointercapture")))}}function Ds(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Cs;function Es(){return Cs||(Cs=Vo.createCanvasElement().getContext("2d"))}var As={};var Rs=function(e){ya(n,ps);var t=Ds(n);function n(e){var r,i;for(kr(this,n),r=t.call(this,e);!(i=Vo.getRandomColor())||i in As;);return r.colorKey=i,As[i]=xa(r),r}return Tr(n,[{key:"getContext",value:function(){return Vo.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}},{key:"getCanvas",value:function(){return Vo.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}},{key:"getSceneFunc",value:function(){return this.attrs.sceneFunc||this._sceneFunc}},{key:"getHitFunc",value:function(){return this.attrs.hitFunc||this._hitFunc}},{key:"hasShadow",value:function(){return this._getCache("hasShadow",this._hasShadow)}},{key:"_hasShadow",value:function(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}},{key:"_getFillPattern",value:function(){return this._getCache("patternImage",this.__getFillPattern)}},{key:"__getFillPattern",value:function(){if(this.fillPatternImage()){var e=Es().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(e&&e.setTransform){var t=new No;t.translate(this.fillPatternX(),this.fillPatternY()),t.rotate(Lo.getAngle(this.fillPatternRotation())),t.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),t.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());var n=t.getMatrix();e.setTransform({a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]})}return e}}},{key:"_getLinearGradient",value:function(){return this._getCache("linearGradient",this.__getLinearGradient)}},{key:"__getLinearGradient",value:function(){var e=this.fillLinearGradientColorStops();if(e){for(var t=Es(),n=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),i=t.createLinearGradient(n.x,n.y,r.x,r.y),a=0;a<e.length;a+=2)i.addColorStop(e[a],e[a+1]);return i}}},{key:"_getRadialGradient",value:function(){return this._getCache("radialGradient",this.__getRadialGradient)}},{key:"__getRadialGradient",value:function(){var e=this.fillRadialGradientColorStops();if(e){for(var t=Es(),n=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),i=t.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius()),a=0;a<e.length;a+=2)i.addColorStop(e[a],e[a+1]);return i}}},{key:"getShadowRGBA",value:function(){return this._getCache("shadowRGBA",this._getShadowRGBA)}},{key:"_getShadowRGBA",value:function(){if(this.hasShadow()){var e=Vo.colorToRGBA(this.shadowColor());return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}}},{key:"hasFill",value:function(){var e=this;return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],(function(){return e.fillEnabled()&&!!(e.fill()||e.fillPatternImage()||e.fillLinearGradientColorStops()||e.fillRadialGradientColorStops())}))}},{key:"hasStroke",value:function(){var e=this;return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],(function(){return e.strokeEnabled()&&e.strokeWidth()&&!(!e.stroke()&&!e.strokeLinearGradientColorStops())}))}},{key:"hasHitStroke",value:function(){var e=this.hitStrokeWidth();return"auto"===e?this.hasStroke():this.strokeEnabled()&&!!e}},{key:"intersects",value:function(e){var t=this.getStage().bufferHitCanvas;return t.getContext().clear(),this.drawHit(t,null,!0),t.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}},{key:"destroy",value:function(){return ps.prototype.destroy.call(this),delete As[this.colorKey],delete this.colorKey,this}},{key:"_useBufferCanvas",value:function(e){var t;if(!this.getStage())return!1;if(!(null===(t=this.attrs.perfectDrawEnabled)||void 0===t||t))return!1;var n=e||this.hasFill(),r=this.hasStroke(),i=1!==this.getAbsoluteOpacity();if(n&&r&&i)return!0;var a=this.hasShadow(),o=this.shadowForStrokeEnabled();return!!(n&&r&&a&&o)}},{key:"setStrokeHitEnabled",value:function(e){Vo.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}},{key:"getStrokeHitEnabled",value:function(){return 0!==this.hitStrokeWidth()}},{key:"getSelfRect",value:function(){var e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}},{key:"getClientRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.skipTransform,n=e.relativeTo,r=this.getSelfRect(),i=!e.skipStroke&&this.hasStroke(),a=i&&this.strokeWidth()||0,o=r.width+a,s=r.height+a,u=!e.skipShadow&&this.hasShadow(),l=u?this.shadowOffsetX():0,c=u?this.shadowOffsetY():0,h=o+Math.abs(l),f=s+Math.abs(c),d=u&&this.shadowBlur()||0,p=h+2*d,v=f+2*d,g=0;Math.round(a/2)!==a/2&&(g=1);var m={width:p+g,height:v+g,x:-Math.round(a/2+d)+Math.min(l,0)+r.x,y:-Math.round(a/2+d)+Math.min(c,0)+r.y};return t?m:this._transformedRect(m,n)}},{key:"drawScene",value:function(e,t){var n,r,i=this.getLayer(),a=e||i.getCanvas(),o=a.getContext(),s=this._getCanvasCache(),u=this.getSceneFunc(),l=this.hasShadow(),c=a.isCache,h=t===this;if(!this.isVisible()&&!h)return this;if(s){o.save();var f=this.getAbsoluteTransform(t).getMatrix();return o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this._drawCachedSceneCanvas(o),o.restore(),this}if(!u)return this;if(o.save(),this._useBufferCanvas()&&!c){(r=(n=this.getStage().bufferCanvas).getContext()).clear(),r.save(),r._applyLineJoin(this);var d=this.getAbsoluteTransform(t).getMatrix();r.transform(d[0],d[1],d[2],d[3],d[4],d[5]),u.call(this,r,this),r.restore();var p=n.pixelRatio;l&&o._applyShadow(this),o._applyOpacity(this),o._applyGlobalCompositeOperation(this),o.drawImage(n._canvas,0,0,n.width/p,n.height/p)}else{if(o._applyLineJoin(this),!h){d=this.getAbsoluteTransform(t).getMatrix();o.transform(d[0],d[1],d[2],d[3],d[4],d[5]),o._applyOpacity(this),o._applyGlobalCompositeOperation(this)}l&&o._applyShadow(this),u.call(this,o,this)}return o.restore(),this}},{key:"drawHit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.shouldDrawHit(t,n))return this;var r=this.getLayer(),i=e||r.hitCanvas,a=i&&i.getContext(),o=this.hitFunc()||this.sceneFunc(),s=this._getCanvasCache(),u=s&&s.hit;if(this.colorKey||Vo.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),u){a.save();var l=this.getAbsoluteTransform(t).getMatrix();return a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(a),a.restore(),this}if(!o)return this;a.save(),a._applyLineJoin(this);var c=this===t;if(!c){var h=this.getAbsoluteTransform(t).getMatrix();a.transform(h[0],h[1],h[2],h[3],h[4],h[5])}return o.call(this,a,this),a.restore(),this}},{key:"drawHitFromCache",value:function(){var e,t,n,r,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=this._getCanvasCache(),s=this._getCachedSceneCanvas(),u=o.hit,l=u.getContext(),c=u.getWidth(),h=u.getHeight();l.clear(),l.drawImage(s._canvas,0,0,c,h);try{for(n=(t=(e=l.getImageData(0,0,c,h)).data).length,r=Vo._hexToRgb(this.colorKey),i=0;i<n;i+=4)t[i+3]>a?(t[i]=r.r,t[i+1]=r.g,t[i+2]=r.b,t[i+3]=255):t[i+3]=0;l.putImageData(e,0,0)}catch(e){Vo.error("Unable to draw hit graph from cached scene canvas. "+e.message)}return this}},{key:"hasPointerCapture",value:function(e){return ks(e,this)}},{key:"setPointerCapture",value:function(e){Ps(e,this)}},{key:"releaseCapture",value:function(e){Ts(e)}}]),n}();function Is(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}Rs.prototype._fillFunc=function(e){e.fill()},Rs.prototype._strokeFunc=function(e){e.stroke()},Rs.prototype._fillFuncHit=function(e){e.fill()},Rs.prototype._strokeFuncHit=function(e){e.stroke()},Rs.prototype._centroid=!1,Rs.prototype.nodeType="Shape",Mo(Rs),Rs.prototype.eventListeners={},Rs.prototype.on.call(Rs.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache("hasShadow")})),Rs.prototype.on.call(Rs.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache("shadowRGBA")})),Rs.prototype.on.call(Rs.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",(function(){this._clearCache("patternImage")})),Rs.prototype.on.call(Rs.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache("linearGradient")})),Rs.prototype.on.call(Rs.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache("radialGradient")})),es.addGetterSetter(Rs,"stroke",void 0,$o()),es.addGetterSetter(Rs,"strokeWidth",2,Xo()),es.addGetterSetter(Rs,"fillAfterStrokeEnabled",!1),es.addGetterSetter(Rs,"hitStrokeWidth","auto",Ko()),es.addGetterSetter(Rs,"strokeHitEnabled",!0,Qo()),es.addGetterSetter(Rs,"perfectDrawEnabled",!0,Qo()),es.addGetterSetter(Rs,"shadowForStrokeEnabled",!0,Qo()),es.addGetterSetter(Rs,"lineJoin"),es.addGetterSetter(Rs,"lineCap"),es.addGetterSetter(Rs,"sceneFunc"),es.addGetterSetter(Rs,"hitFunc"),es.addGetterSetter(Rs,"dash"),es.addGetterSetter(Rs,"dashOffset",0,Xo()),es.addGetterSetter(Rs,"shadowColor",void 0,Jo()),es.addGetterSetter(Rs,"shadowBlur",0,Xo()),es.addGetterSetter(Rs,"shadowOpacity",1,Xo()),es.addComponentsGetterSetter(Rs,"shadowOffset",["x","y"]),es.addGetterSetter(Rs,"shadowOffsetX",0,Xo()),es.addGetterSetter(Rs,"shadowOffsetY",0,Xo()),es.addGetterSetter(Rs,"fillPatternImage"),es.addGetterSetter(Rs,"fill",void 0,$o()),es.addGetterSetter(Rs,"fillPatternX",0,Xo()),es.addGetterSetter(Rs,"fillPatternY",0,Xo()),es.addGetterSetter(Rs,"fillLinearGradientColorStops"),es.addGetterSetter(Rs,"strokeLinearGradientColorStops"),es.addGetterSetter(Rs,"fillRadialGradientStartRadius",0),es.addGetterSetter(Rs,"fillRadialGradientEndRadius",0),es.addGetterSetter(Rs,"fillRadialGradientColorStops"),es.addGetterSetter(Rs,"fillPatternRepeat","repeat"),es.addGetterSetter(Rs,"fillEnabled",!0),es.addGetterSetter(Rs,"strokeEnabled",!0),es.addGetterSetter(Rs,"shadowEnabled",!0),es.addGetterSetter(Rs,"dashEnabled",!0),es.addGetterSetter(Rs,"strokeScaleEnabled",!0),es.addGetterSetter(Rs,"fillPriority","color"),es.addComponentsGetterSetter(Rs,"fillPatternOffset",["x","y"]),es.addGetterSetter(Rs,"fillPatternOffsetX",0,Xo()),es.addGetterSetter(Rs,"fillPatternOffsetY",0,Xo()),es.addComponentsGetterSetter(Rs,"fillPatternScale",["x","y"]),es.addGetterSetter(Rs,"fillPatternScaleX",1,Xo()),es.addGetterSetter(Rs,"fillPatternScaleY",1,Xo()),es.addComponentsGetterSetter(Rs,"fillLinearGradientStartPoint",["x","y"]),es.addComponentsGetterSetter(Rs,"strokeLinearGradientStartPoint",["x","y"]),es.addGetterSetter(Rs,"fillLinearGradientStartPointX",0),es.addGetterSetter(Rs,"strokeLinearGradientStartPointX",0),es.addGetterSetter(Rs,"fillLinearGradientStartPointY",0),es.addGetterSetter(Rs,"strokeLinearGradientStartPointY",0),es.addComponentsGetterSetter(Rs,"fillLinearGradientEndPoint",["x","y"]),es.addComponentsGetterSetter(Rs,"strokeLinearGradientEndPoint",["x","y"]),es.addGetterSetter(Rs,"fillLinearGradientEndPointX",0),es.addGetterSetter(Rs,"strokeLinearGradientEndPointX",0),es.addGetterSetter(Rs,"fillLinearGradientEndPointY",0),es.addGetterSetter(Rs,"strokeLinearGradientEndPointY",0),es.addComponentsGetterSetter(Rs,"fillRadialGradientStartPoint",["x","y"]),es.addGetterSetter(Rs,"fillRadialGradientStartPointX",0),es.addGetterSetter(Rs,"fillRadialGradientStartPointY",0),es.addComponentsGetterSetter(Rs,"fillRadialGradientEndPoint",["x","y"]),es.addGetterSetter(Rs,"fillRadialGradientEndPointX",0),es.addGetterSetter(Rs,"fillRadialGradientEndPointY",0),es.addGetterSetter(Rs,"fillPatternRotation",0),es.backCompat(Rs,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var Os,Ls,Ms,Ns=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Fs=Ns.length,Bs=function(e){ya(n,xs);var t=Is(n);function n(e){var r;return kr(this,n),(r=t.call(this,e)).canvas=new cs,r.hitCanvas=new hs({pixelRatio:1}),r._waitingForDraw=!1,r.on("visibleChange.konva",r._checkVisibility),r._checkVisibility(),r.on("imageSmoothingEnabledChange.konva",r._setSmoothEnabled),r._setSmoothEnabled(),r}return Tr(n,[{key:"createPNGStream",value:function(){return this.canvas._canvas.createPNGStream()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getNativeCanvasElement",value:function(){return this.canvas._canvas}},{key:"getHitCanvas",value:function(){return this.hitCanvas}},{key:"getContext",value:function(){return this.getCanvas().getContext()}},{key:"clear",value:function(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}},{key:"setZIndex",value:function(e){Yo(wa(n.prototype),"setZIndex",this).call(this,e);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}},{key:"moveToTop",value:function(){ps.prototype.moveToTop.call(this);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}},{key:"moveUp",value:function(){if(!ps.prototype.moveUp.call(this))return!1;var e=this.getStage();return!(!e||!e.content)&&(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}},{key:"moveDown",value:function(){if(ps.prototype.moveDown.call(this)){var e=this.getStage();if(e){var t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}},{key:"moveToBottom",value:function(){if(ps.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}},{key:"getLayer",value:function(){return this}},{key:"remove",value:function(){var e=this.getNativeCanvasElement();return ps.prototype.remove.call(this),e&&e.parentNode&&Vo._isInDocument(e)&&e.parentNode.removeChild(e),this}},{key:"getStage",value:function(){return this.parent}},{key:"setSize",value:function(e){var t=e.width,n=e.height;return this.canvas.setSize(t,n),this.hitCanvas.setSize(t,n),this._setSmoothEnabled(),this}},{key:"_validateAdd",value:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Vo.throw("You may only add groups and shapes to a layer.")}},{key:"_toKonvaCanvas",value:function(e){return(e=e||{}).width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=void 0!==e.x?e.x:this.x(),e.y=void 0!==e.y?e.y:this.y(),ps.prototype._toKonvaCanvas.call(this,e)}},{key:"_checkVisibility",value:function(){var e=this.visible();this.canvas._canvas.style.display=e?"block":"none"}},{key:"_setSmoothEnabled",value:function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}},{key:"getWidth",value:function(){if(this.parent)return this.parent.width()}},{key:"setWidth",value:function(){Vo.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}},{key:"getHeight",value:function(){if(this.parent)return this.parent.height()}},{key:"setHeight",value:function(){Vo.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}},{key:"batchDraw",value:function(){var e=this;return this._waitingForDraw||(this._waitingForDraw=!0,Vo.requestAnimFrame((function(){e.draw(),e._waitingForDraw=!1}))),this}},{key:"getIntersection",value:function(e){if(!this.isListening()||!this.isVisible())return null;for(var t=1,n=!1;;){for(var r=0;r<Fs;r++){var i=Ns[r],a=this._getIntersection({x:e.x+i.x*t,y:e.y+i.y*t}),o=a.shape;if(o)return o;if(n=!!a.antialiased,!a.antialiased)break}if(!n)return null;t+=1}}},{key:"_getIntersection",value:function(e){var t=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,r=n[3];if(255===r){var i=Vo._rgbToHex(n[0],n[1],n[2]),a=As["#"+i];return a?{shape:a}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}},{key:"drawScene",value:function(e,t){var n=this.getLayer(),r=e||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),xs.prototype.drawScene.call(this,r,t),this._fire("draw",{node:this}),this}},{key:"drawHit",value:function(e,t){var n=this.getLayer(),r=e||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),xs.prototype.drawHit.call(this,r,t),this}},{key:"enableHitGraph",value:function(){return this.hitGraphEnabled(!0),this}},{key:"disableHitGraph",value:function(){return this.hitGraphEnabled(!1),this}},{key:"setHitGraphEnabled",value:function(e){Vo.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}},{key:"getHitGraphEnabled",value:function(e){return Vo.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}},{key:"toggleHitCanvas",value:function(){if(this.parent&&this.parent.content){var e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}}}]),n}();function qs(e,t,n){return t in e?m(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Us(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}Bs.prototype.nodeType="Layer",Mo(Bs),es.addGetterSetter(Bs,"imageSmoothingEnabled",!0),es.addGetterSetter(Bs,"clearBeforeDraw",!0),es.addGetterSetter(Bs,"hitGraphEnabled",!0,Qo());var Gs=[["mouseenter","_pointerenter"],["mousedown","_pointerdown"],["mousemove","_pointermove"],["mouseup","_pointerup"],["mouseleave","_pointerleave"],["touchstart","_pointerdown"],["touchmove","_pointermove"],["touchend","_pointerup"],["touchcancel","_pointercancel"],["mouseover","_pointerover"],["wheel","_wheel"],["contextmenu","_contextmenu"],["pointerdown","_pointerdown"],["pointermove","_pointermove"],["pointerup","_pointerup"],["pointercancel","_pointercancel"],["lostpointercapture","_lostpointercapture"]],zs={mouse:(Os={},qs(Os,"pointerout","mouseout"),qs(Os,"pointerleave","mouseleave"),qs(Os,"pointerover","mouseover"),qs(Os,"pointerenter","mouseenter"),qs(Os,"pointermove","mousemove"),qs(Os,"pointerdown","mousedown"),qs(Os,"pointerup","mouseup"),qs(Os,"pointercancel","mousecancel"),qs(Os,"pointerclick","click"),qs(Os,"pointerdblclick","dblclick"),Os),touch:(Ls={},qs(Ls,"pointerout","touchout"),qs(Ls,"pointerleave","touchleave"),qs(Ls,"pointerover","touchover"),qs(Ls,"pointerenter","touchenter"),qs(Ls,"pointermove","touchmove"),qs(Ls,"pointerdown","touchstart"),qs(Ls,"pointerup","touchend"),qs(Ls,"pointercancel","touchcancel"),qs(Ls,"pointerclick","tap"),qs(Ls,"pointerdblclick","dbltap"),Ls),pointer:(Ms={},qs(Ms,"pointerout","pointerout"),qs(Ms,"pointerleave","pointerleave"),qs(Ms,"pointerover","pointerover"),qs(Ms,"pointerenter","pointerenter"),qs(Ms,"pointermove","pointermove"),qs(Ms,"pointerdown","pointerdown"),qs(Ms,"pointerup","pointerup"),qs(Ms,"pointercancel","pointercancel"),qs(Ms,"pointerclick","pointerclick"),qs(Ms,"pointerdblclick","pointerdblclick"),Ms)},Vs=function(e){return e.indexOf("pointer")>=0?"pointer":e.indexOf("touch")>=0?"touch":"mouse"},Ws=function(e){var t=Vs(e);return"pointer"===t?Lo.pointerEventsEnabled&&zs.pointer:"touch"===t?zs.touch:"mouse"===t?zs.mouse:void 0};function js(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e.clipFunc||e.clipWidth||e.clipHeight)&&Vo.warn("Stage does not support clipping. Please use clip for Layers or Groups."),e}var Hs=[],Ys=function(e){ya(n,xs);var t=Us(n);function n(e){var r;return kr(this,n),(r=t.call(this,js(e)))._pointerPositions=[],r._changedPointerPositions=[],r._buildDOM(),r._bindContentEvents(),Hs.push(xa(r)),r.on("widthChange.konva heightChange.konva",r._resizeDOM),r.on("visibleChange.konva",r._checkVisibility),r.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(function(){js(r.attrs)})),r._checkVisibility(),r}return Tr(n,[{key:"_validateAdd",value:function(e){var t="Layer"===e.getType(),n="FastLayer"===e.getType();t||n||Vo.throw("You may only add layers to the stage.")}},{key:"_checkVisibility",value:function(){if(this.content){var e=this.visible()?"":"none";this.content.style.display=e}}},{key:"setContainer",value:function(e){if("string"===Lt(e)){if("."===e.charAt(0)){var t=e.slice(1);e=document.getElementsByClassName(t)[0]}else{var n;n="#"!==e.charAt(0)?e:e.slice(1),e=document.getElementById(n)}if(!e)throw"Can not find container in document with id "+n}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}},{key:"shouldDrawHit",value:function(){return!0}},{key:"clear",value:function(){var e,t=this.children,n=t.length;for(e=0;e<n;e++)t[e].clear();return this}},{key:"clone",value:function(e){return e||(e={}),e.container="undefined"!=typeof document&&document.createElement("div"),xs.prototype.clone.call(this,e)}},{key:"destroy",value:function(){Yo(wa(n.prototype),"destroy",this).call(this);var e=this.content;e&&Vo._isInDocument(e)&&this.container().removeChild(e);var t=Hs.indexOf(this);return t>-1&&Hs.splice(t,1),this}},{key:"getPointerPosition",value:function(){var e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(Vo.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}},{key:"_getPointerById",value:function(e){return this._pointerPositions.find((function(t){return t.id===e}))}},{key:"getPointersPositions",value:function(){return this._pointerPositions}},{key:"getStage",value:function(){return this}},{key:"getContent",value:function(){return this.content}},{key:"_toKonvaCanvas",value:function(e){(e=e||{}).x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();var t=new cs({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),n=t.getContext()._context,r=this.children;return(e.x||e.y)&&n.translate(-1*e.x,-1*e.y),r.forEach((function(t){if(t.isVisible()){var r=t._toKonvaCanvas(e);n.drawImage(r._canvas,e.x,e.y,r.getWidth()/r.getPixelRatio(),r.getHeight()/r.getPixelRatio())}})),t}},{key:"getIntersection",value:function(e){if(!e)return null;var t,n=this.children;for(t=n.length-1;t>=0;t--){var r=n[t].getIntersection(e);if(r)return r}return null}},{key:"_resizeDOM",value:function(){var e=this.width(),t=this.height();this.content&&(this.content.style.width=e+"px",this.content.style.height=t+"px"),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach((function(n){n.setSize({width:e,height:t}),n.draw()}))}},{key:"add",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(arguments.length>1){for(var a=0;a<arguments.length;a++)this.add(arguments[a]);return this}Yo(wa(n.prototype),"add",this).call(this,e);var o=this.children.length;return o>5&&Vo.warn("The stage has "+o+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),Lo.isBrowser&&this.content.appendChild(e.canvas._canvas),this}},{key:"getParent",value:function(){return null}},{key:"getLayer",value:function(){return null}},{key:"hasPointerCapture",value:function(e){return ks(e,this)}},{key:"setPointerCapture",value:function(e){Ps(e,this)}},{key:"releaseCapture",value:function(e){Ts(e)}},{key:"getLayers",value:function(){return this.children}},{key:"_bindContentEvents",value:function(){var e=this;Lo.isBrowser&&Gs.forEach((function(t){var n=ao(t,2),r=n[0],i=n[1];e.content.addEventListener(r,(function(t){e[i](t)}))}))}},{key:"_pointerenter",value:function(e){this.setPointersPositions(e);var t=Ws(e.type);this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}},{key:"_pointerover",value:function(e){this.setPointersPositions(e);var t=Ws(e.type);this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}},{key:"_getTargetShape",value:function(e){var t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}},{key:"_pointerleave",value:function(e){var t=Ws(e.type),n=Vs(e.type);if(t){this.setPointersPositions(e);var r=this._getTargetShape(n),i=!Wo.isDragging||Lo.hitOnDragEnabled;r&&i?(r._fireAndBubble(t.pointerout,{evt:e}),r._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[n+"targetShape"]=null):i&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}},{key:"_pointerdown",value:function(e){var t=this,n=Ws(e.type),r=Vs(e.type);if(n){this.setPointersPositions(e);var i=!1;this._changedPointerPositions.forEach((function(a){var o=t.getIntersection(a);if(Wo.justDragged=!1,Lo["_"+r+"ListenClick"]=!0,o&&o.isListening()){Lo.capturePointerEventsEnabled&&o.setPointerCapture(a.id),t[r+"ClickStartShape"]=o,o._fireAndBubble(n.pointerdown,{evt:e,pointerId:a.id}),i=!0;var s=e.type.indexOf("touch")>=0;o.preventDefault()&&e.cancelable&&s&&e.preventDefault()}})),i||this._fire(n.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}},{key:"_pointermove",value:function(e){var t=this,n=Ws(e.type),r=Vs(e.type);if(n&&(Wo.isDragging&&Wo.node.preventDefault()&&e.cancelable&&e.preventDefault(),this.setPointersPositions(e),!Wo.isDragging||Lo.hitOnDragEnabled)){var i={},a=!1,o=this._getTargetShape(r);this._changedPointerPositions.forEach((function(s){var u=bs(s.id)||t.getIntersection(s),l=s.id,c={evt:e,pointerId:l},h=o!==u;if(h&&o&&(o._fireAndBubble(n.pointerout,c,u),o._fireAndBubble(n.pointerleave,c,u)),u){if(i[u._id])return;i[u._id]=!0}u&&u.isListening()?(a=!0,h&&(u._fireAndBubble(n.pointerover,c,o),u._fireAndBubble(n.pointerenter,c,o),t[r+"targetShape"]=u),u._fireAndBubble(n.pointermove,c)):o&&(t._fire(n.pointerover,{evt:e,target:t,currentTarget:t,pointerId:l}),t[r+"targetShape"]=null)})),a||this._fire(n.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}}},{key:"_pointerup",value:function(e){var t=this,n=Ws(e.type),r=Vs(e.type);if(n){this.setPointersPositions(e);var i=this[r+"ClickStartShape"],a=this[r+"ClickEndShape"],o={},s=!1;this._changedPointerPositions.forEach((function(u){var l=bs(u.id)||t.getIntersection(u);if(l){if(l.releaseCapture(u.id),o[l._id])return;o[l._id]=!0}var c=u.id,h={evt:e,pointerId:c},f=!1;Lo["_"+r+"InDblClickWindow"]?(f=!0,clearTimeout(t[r+"DblTimeout"])):Wo.justDragged||(Lo["_"+r+"InDblClickWindow"]=!0,clearTimeout(t[r+"DblTimeout"])),t[r+"DblTimeout"]=setTimeout((function(){Lo["_"+r+"InDblClickWindow"]=!1}),Lo.dblClickWindow),l&&l.isListening()?(s=!0,t[r+"ClickEndShape"]=l,l._fireAndBubble(n.pointerup,h),Lo["_"+r+"ListenClick"]&&i&&i===l&&(l._fireAndBubble(n.pointerclick,h),f&&a&&a===l&&l._fireAndBubble(n.pointerdblclick,h))):(t[r+"ClickEndShape"]=null,Lo["_"+r+"ListenClick"]&&t._fire(n.pointerclick,{evt:e,target:t,currentTarget:t,pointerId:c}),f&&t._fire(n.pointerdblclick,{evt:e,target:t,currentTarget:t,pointerId:c}))})),s||this._fire(n.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Lo["_"+r+"ListenClick"]=!1,e.cancelable&&e.preventDefault()}}},{key:"_contextmenu",value:function(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble("contextmenu",{evt:e}):this._fire("contextmenu",{evt:e,target:this,currentTarget:this})}},{key:"_wheel",value:function(e){this.setPointersPositions(e);var t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble("wheel",{evt:e}):this._fire("wheel",{evt:e,target:this,currentTarget:this})}},{key:"_pointercancel",value:function(e){this.setPointersPositions(e);var t=bs(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble("pointerup",Ss(e)),Ts(e.pointerId)}},{key:"_lostpointercapture",value:function(e){Ts(e.pointerId)}},{key:"setPointersPositions",value:function(e){var t=this,n=this._getContentPosition(),r=null,i=null;void 0!==(e=e||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,(function(e){t._pointerPositions.push({id:e.identifier,x:(e.clientX-n.left)/n.scaleX,y:(e.clientY-n.top)/n.scaleY})})),Array.prototype.forEach.call(e.changedTouches||e.touches,(function(e){t._changedPointerPositions.push({id:e.identifier,x:(e.clientX-n.left)/n.scaleX,y:(e.clientY-n.top)/n.scaleY})}))):(r=(e.clientX-n.left)/n.scaleX,i=(e.clientY-n.top)/n.scaleY,this.pointerPos={x:r,y:i},this._pointerPositions=[{x:r,y:i,id:Vo._getFirstPointerId(e)}],this._changedPointerPositions=[{x:r,y:i,id:Vo._getFirstPointerId(e)}])}},{key:"_setPointerPosition",value:function(e){Vo.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}},{key:"_getContentPosition",value:function(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}},{key:"_buildDOM",value:function(){if(this.bufferCanvas=new cs({width:this.width(),height:this.height()}),this.bufferHitCanvas=new hs({pixelRatio:1,width:this.width(),height:this.height()}),Lo.isBrowser){var e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}}},{key:"cache",value:function(){return Vo.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}},{key:"clearCache",value:function(){return this}},{key:"batchDraw",value:function(){return this.getChildren().forEach((function(e){e.batchDraw()})),this}}]),n}();Ys.prototype.nodeType="Stage",Mo(Ys),es.addGetterSetter(Ys,"container");var Zs=u.Reflect,Xs=Zs&&Zs.ownKeys||function(e){var t=Oe.f(ye(e)),n=ae.f;return n?t.concat(n(e)):t};p(p.S,"Reflect",{ownKeys:Xs});var Ks=l.Reflect.ownKeys,Js="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var $s=new(function(){function e(){kr(this,e),this.m=[1,0,0,1,0,0]}return Tr(e,[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){return no(this.m)}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[3]*t+this.m[1]*e}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[3]*=t,this.m[1]*=e,this.m[2]*=t}},{key:"rotate",value:function(e){var t=Math.cos(e*Math.PI/180),n=Math.sin(e*Math.PI/180),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=a,this.m[3]=o}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[0]*e,i=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=o}},{key:"transformPoint",value:function(e,t){return[e*this.m[0]+t*this.m[2]+this.m[4],t*this.m[3]+e*this.m[1]+this.m[5]]}},{key:"invertPoint",value:function(e,t){var n,r,i,a,o,s,u,l,c,h,f=this.m,d=(n=f[0],r=f[2],i=f[4],a=f[1],o=f[3],s=f[5],u=0,l=0,c=1,(h=new Js(9))[0]=n,h[1]=r,h[2]=i,h[3]=a,h[4]=o,h[5]=s,h[6]=u,h[7]=l,h[8]=c,h),p=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,f=-c*a+s*u,d=l*a-o*u,p=n*h+r*f+i*d;return p?(p=1/p,e[0]=h*p,e[1]=(-c*r+i*l)*p,e[2]=(s*r-i*o)*p,e[3]=f*p,e[4]=(c*n-i*u)*p,e[5]=(-s*n+i*a)*p,e[6]=d*p,e[7]=(-l*n+r*u)*p,e[8]=(o*n-r*a)*p,e):null}(function(){var e=new Js(9);return Js!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}(),d);return[e*p[0]+t*p[1]+p[2],e*p[3]+t*p[4]+p[5]]}}]),e}()),Qs=function(e,t){var n=ao($s.invertPoint(e,t),2),r=n[0],i=n[1];return r>=0&&r<=ko.width&&i>=0&&i<=ko.height},eu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,e),Ks(t).length&&this.update(t)}return Tr(e,[{key:"update",value:function(e){var t,n,r,i,a,o,s,u,l,c=e.rootSize,h=e.scale,f=e.rotate,d=e.width,p=e.height,v=e.position,g=void 0===v?[0,0]:v,m=e.offset,y=e.flip;Ra(ko,null!==(t={rootWidth:null==c?void 0:c.width,rootHeight:null==c?void 0:c.height})&&void 0!==t?t:{}),Ra(ko,null!==(n={x:m.x,y:m.y})&&void 0!==n?n:{}),Ra(ko,null!==(r={scale:h})&&void 0!==r?r:{}),Ra(ko,null!==(i={rotate:f})&&void 0!==i?i:{}),Ra(ko,null!==(a={width:d})&&void 0!==a?a:{}),Ra(ko,null!==(o={height:p})&&void 0!==o?o:{}),Ra(ko,null!==(s={centerX:d/2,centerY:p/2})&&void 0!==s?s:{}),Ra(ko,null!==(u={position:g})&&void 0!==u?u:{}),Ra(ko,null!==(l={flip:y})&&void 0!==l?l:{}),V(Po).length||Ra(Po,ko),c&&function(){var e=ko.scale,t=ko.rotate,n=ko.flip,r=ko.width,i=ko.height,a=ko.x,o=ko.y,s=ko.rootWidth,u=ko.rootHeight;if($s.reset(),(a||o)&&$s.translate(a,o),$s.translate(s/2,u/2),n){var l=n.h,c=void 0!==l&&l,h=n.v,f=void 0!==h&&h?-1:1,d=c?-1:1;$s.scale(d,f)}e&&$s.scale(e,e),t&&$s.rotate(t),$s.translate(-r/2,-i/2),$s.m}()}}]),e}();p(p.S,"Reflect",{set:function e(t,n,r){var i,a,o=arguments.length<4?t:arguments[3],s=Be.f(ye(t),n);if(!s){if(S(a=Wt(t)))return e(a,n,r,o);s=he(0)}if(x(s,"value")){if(!1===s.writable||!S(o))return!1;if(i=Be.f(o,n)){if(i.get||i.set||!1===i.writable)return!1;i.value=r,v.f(o,n,i)}else v.f(o,n,he(0,r));return!0}return void 0!==s.set&&(s.set.call(o,r),!0)}});var tu=l.Reflect.set;function nu(e,t,n,r){return(nu="undefined"!=typeof Reflect&&tu?tu:function(e,t,n,r){var i,a=Ho(e,t);if(a){if((i=Ge(a,t)).set)return i.set.call(r,n),!0;if(!i.writable)return!1}if(i=Ge(r,t)){if(!i.writable)return!1;i.value=n,m(r,t,i)}else qs(r,t,n);return!0})(e,t,n,r)}function ru(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}function iu(e,t,n,r,i,a,o){var s=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),u=Math.sqrt(Math.pow(i-n,2)+Math.pow(a-r,2)),l=o*s/(s+u),c=o*u/(s+u);return[n-l*(i-e),r-l*(a-t),n+c*(i-e),r+c*(a-t)]}function au(e,t){var n,r,i=e.length,a=[];for(n=2;n<i-2;n+=2)r=iu(e[n-2],e[n-1],e[n],e[n+1],e[n+2],e[n+3],t),isNaN(r[0])||(a.push(r[0]),a.push(r[1]),a.push(e[n]),a.push(e[n+1]),a.push(r[2]),a.push(r[3]));return a}var ou=function(e){ya(n,Rs);var t=ru(n);function n(e){var r;return kr(this,n),(r=t.call(this,e)).on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")})),r}return Tr(n,[{key:"_sceneFunc",value:function(e){var t,n,r,i=this.points(),a=i.length,o=this.tension(),s=this.closed(),u=this.bezier();if(a){if(e.beginPath(),e.moveTo(i[0],i[1]),0!==o&&a>4){for(n=(t=this.getTensionPoints()).length,r=s?0:4,s||e.quadraticCurveTo(t[0],t[1],t[2],t[3]);r<n-2;)e.bezierCurveTo(t[r++],t[r++],t[r++],t[r++],t[r++],t[r++]);s||e.quadraticCurveTo(t[n-2],t[n-1],i[a-2],i[a-1])}else if(u)for(r=2;r<a;)e.bezierCurveTo(i[r++],i[r++],i[r++],i[r++],i[r++],i[r++]);else for(r=2;r<a;r+=2)e.lineTo(i[r],i[r+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}},{key:"getTensionPoints",value:function(){return this._getCache("tensionPoints",this._getTensionPoints)}},{key:"_getTensionPoints",value:function(){return this.closed()?this._getTensionPointsClosed():au(this.points(),this.tension())}},{key:"_getTensionPointsClosed",value:function(){var e=this.points(),t=e.length,n=this.tension(),r=iu(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),i=iu(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),a=au(e,n);return[r[2],r[3]].concat(a).concat([i[0],i[1],e[t-2],e[t-1],i[2],i[3],r[0],r[1],e[0],e[1]])}},{key:"getWidth",value:function(){return this.getSelfRect().width}},{key:"getHeight",value:function(){return this.getSelfRect().height}},{key:"getSelfRect",value:function(){var e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};for(var t,n,r=(e=0!==this.tension()?[e[0],e[1]].concat(no(this._getTensionPoints()),[e[e.length-2],e[e.length-1]]):this.points())[0],i=e[0],a=e[1],o=e[1],s=0;s<e.length/2;s++)t=e[2*s],n=e[2*s+1],r=Math.min(r,t),i=Math.max(i,t),a=Math.min(a,n),o=Math.max(o,n);return{x:r,y:a,width:i-r,height:o-a}}}]),n}();function su(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}ou.prototype.className="Line",ou.prototype._attrsAffectingSize=["points","bezier","tension"],Mo(ou),es.addGetterSetter(ou,"closed",!1),es.addGetterSetter(ou,"bezier",!1),es.addGetterSetter(ou,"tension",0,Xo()),es.addGetterSetter(ou,"points",[],function(){if(Lo.isUnminified)return function(e,t){return Vo._isArray(e)?e.forEach((function(e){Vo._isNumber(e)||Vo.warn('"'+t+'" attribute has non numeric element '+e+". Make sure that all elements are numbers.")})):Vo.warn(Zo(e)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.'),e}}());var uu=function(e){ya(n,Rs);var t=su(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_sceneFunc",value:function(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),e.closePath(),e.fillStrokeShape(this)}},{key:"getWidth",value:function(){return 2*this.radius()}},{key:"getHeight",value:function(){return 2*this.radius()}},{key:"setWidth",value:function(e){this.radius()!==e/2&&this.radius(e/2)}},{key:"setHeight",value:function(e){this.radius()!==e/2&&this.radius(e/2)}}]),n}();function lu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}uu.prototype._centroid=!0,uu.prototype.className="Circle",uu.prototype._attrsAffectingSize=["radius"],Mo(uu),es.addGetterSetter(uu,"radius",0,Xo());var cu=function(e){ya(n,uu);var t=lu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).fill("rgba(0,0,0,0.1)"),e.stroke(mo.NORMAL[yo]),e.strokeWidth(2),e.radius(7),e.hitStrokeWidth(go),e.draggable(!0),e.name(yo),e}return n}();function hu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var fu=function(e){ya(n,ou);var t=hu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).stroke(mo.NORMAL[_o]),e.strokeWidth(2),e.lineJoin("round"),e.dash([6,3]),e.name(_o),e}return n}();function du(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var pu,vu=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],gu=vu.length;function mu(){return pu||(pu=Vo.createCanvasElement().getContext("2d"))}var yu=function(e){ya(n,Rs);var t=du(n);function n(e){var r;kr(this,n),(r=t.call(this,function(e){return(e=e||{}).fillLinearGradientColorStops||e.fillRadialGradientColorStops||e.fillPatternImage||(e.fill=e.fill||"black"),e}(e)))._partialTextX=0,r._partialTextY=0;for(var i=0;i<gu;i++)r.on(vu[i]+"Change.konva",r._setTextData);return r._setTextData(),r}return Tr(n,[{key:"_sceneFunc",value:function(e){var t=this.textArr,n=t.length;if(this.text()){var r,i=this.padding(),a=this.fontSize(),o=this.lineHeight()*a,s=this.verticalAlign(),u=0,l=this.align(),c=this.getWidth(),h=this.letterSpacing(),f=this.fill(),d=this.textDecoration(),p=-1!==d.indexOf("underline"),v=-1!==d.indexOf("line-through"),g=0,m=(g=o/2,0),y=0;for(e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline","middle"),e.setAttr("textAlign","left"),"middle"===s?u=(this.getHeight()-n*o-2*i)/2:"bottom"===s&&(u=this.getHeight()-n*o-2*i),e.translate(i,u+i),r=0;r<n;r++){m=0,y=0;var x,_,w,b=t[r],S=b.text,k=b.width,P=r!==n-1;if(e.save(),"right"===l?m+=c-k-2*i:"center"===l&&(m+=(c-k-2*i)/2),p&&(e.save(),e.beginPath(),e.moveTo(m,g+y+Math.round(a/2)),_=0===(x=S.split(" ").length-1),w="justify"===l&&P&&!_?c-2*i:k,e.lineTo(m+Math.round(w),g+y+Math.round(a/2)),e.lineWidth=a/15,e.strokeStyle=f,e.stroke(),e.restore()),v&&(e.save(),e.beginPath(),e.moveTo(m,g+y),_=0===(x=S.split(" ").length-1),w="justify"===l&&P&&!_?c-2*i:k,e.lineTo(m+Math.round(w),g+y),e.lineWidth=a/15,e.strokeStyle=f,e.stroke(),e.restore()),0!==h||"justify"===l){x=S.split(" ").length-1;for(var T=Zn(S),D=0;D<T.length;D++){var C=T[D];" "===C&&r!==n-1&&"justify"===l&&(m+=(c-2*i-k)/x),this._partialTextX=m,this._partialTextY=g+y,this._partialText=C,e.fillStrokeShape(this),m+=this.measureSize(C).width+h}}else this._partialTextX=m,this._partialTextY=g+y,this._partialText=S,e.fillStrokeShape(this);e.restore(),n>1&&(g+=o)}}}},{key:"_hitFunc",value:function(e){var t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)}},{key:"setText",value:function(e){var t=Vo._isString(e)?e:null==e?"":e+"";return this._setAttr("text",t),this}},{key:"getWidth",value:function(){return"auto"===this.attrs.width||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}},{key:"getHeight",value:function(){return"auto"===this.attrs.height||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}},{key:"getTextWidth",value:function(){return this.textWidth}},{key:"getTextHeight",value:function(){return Vo.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}},{key:"measureSize",value:function(e){var t,n=mu(),r=this.fontSize();return n.save(),n.font=this._getContextFont(),t=n.measureText(e),n.restore(),{width:t.width,height:r}}},{key:"_getContextFont",value:function(){return this.fontStyle()+" "+this.fontVariant()+" "+this.fontSize()+"px "+this.fontFamily().split(",").map((function(e){var t=(e=e.trim()).indexOf(" ")>=0,n=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!n&&(e='"'.concat(e,'"')),e})).join(", ")}},{key:"_addTextLine",value:function(e){"justify"===this.align()&&(e=e.trim());var t=this._getTextWidth(e);return this.textArr.push({text:e,width:t})}},{key:"_getTextWidth",value:function(e){var t=this.letterSpacing(),n=e.length;return mu().measureText(e).width+(n?t*(n-1):0)}},{key:"_setTextData",value:function(){var e=this.text().split("\n"),t=+this.fontSize(),n=0,r=this.lineHeight()*t,i=this.attrs.width,a=this.attrs.height,o="auto"!==i&&void 0!==i,s="auto"!==a&&void 0!==a,u=this.padding(),l=i-2*u,c=a-2*u,h=0,f=this.wrap(),d="none"!==f,p="char"!==f&&d,v=this.ellipsis();this.textArr=[],mu().font=this._getContextFont();for(var g=v?this._getTextWidth("…"):0,m=0,y=e.length;m<y;++m){var x=e[m],_=this._getTextWidth(x);if(o&&_>l)for(;x.length>0;){for(var w=0,b=x.length,S="",k=0;w<b;){var P=w+b>>>1,T=x.slice(0,P+1),D=this._getTextWidth(T)+g;D<=l?(w=P+1,S=T,k=D):b=P}if(!S)break;if(p){var C,E=x[S.length];(C=(" "===E||"-"===E)&&k<=l?S.length:Math.max(S.lastIndexOf(" "),S.lastIndexOf("-"))+1)>0&&(w=C,S=S.slice(0,w),k=this._getTextWidth(S))}if(S=S.trimRight(),this._addTextLine(S),n=Math.max(n,k),h+=r,!d||s&&h+r>c){var A=this.textArr[this.textArr.length-1];if(A)if(v)this._getTextWidth(A.text+"…")<l||(A.text=A.text.slice(0,A.text.length-3)),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(A.text+"…");break}if((x=(x=x.slice(w)).trimLeft()).length>0&&(_=this._getTextWidth(x))<=l){this._addTextLine(x),h+=r,n=Math.max(n,_);break}}else this._addTextLine(x),h+=r,n=Math.max(n,_);if(s&&h+r>c)break}this.textHeight=t,this.textWidth=n}},{key:"getStrokeScaleEnabled",value:function(){return!0}}]),n}();function xu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}yu.prototype._fillFunc=function(e){e.fillText(this._partialText,this._partialTextX,this._partialTextY)},yu.prototype._strokeFunc=function(e){e.strokeText(this._partialText,this._partialTextX,this._partialTextY)},yu.prototype.className="Text",yu.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],Mo(yu),es.overWriteSetter(yu,"width",Ko()),es.overWriteSetter(yu,"height",Ko()),es.addGetterSetter(yu,"fontFamily","Arial"),es.addGetterSetter(yu,"fontSize",12,Xo()),es.addGetterSetter(yu,"fontStyle","normal"),es.addGetterSetter(yu,"fontVariant","normal"),es.addGetterSetter(yu,"padding",0,Xo()),es.addGetterSetter(yu,"align","left"),es.addGetterSetter(yu,"verticalAlign","top"),es.addGetterSetter(yu,"lineHeight",1,Xo()),es.addGetterSetter(yu,"wrap","word"),es.addGetterSetter(yu,"ellipsis",!1,Qo()),es.addGetterSetter(yu,"letterSpacing",0,Xo()),es.addGetterSetter(yu,"text","",Jo()),es.addGetterSetter(yu,"textDecoration","");var _u={shadowColor:"#000000",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,shadowOpacity:.8,cornerRadius:10},wu=function(e){ya(n,yu);var t=xu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,Ra({},_u,r))).fontSize(15),e.align("center"),e.name(wo),e.fill(mo.NORMAL[".".concat(wo)]),e.draggable(!0),e}return n}(),bu={isComplete:!0,button:1},Su=function(e){bu.isComplete=e},ku=function(){function e(){kr(this,e),this.state={1:null,2:null,3:null,4:null},this.toolInstance={}}return Tr(e,[{key:"updateState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Ks(this.state).includes("".concat(t))?this.state[t]=e:console.warn("unsupported button,".concat(t,". should be [1,2,3]."))}},{key:"getToolType",value:function(e){var t;return null===(t=this.state)||void 0===t?void 0:t[e]}},{key:"getToolInstance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(bu.isComplete){var n,r=null===(n=this.state)||void 0===n?void 0:n[e];if(!r)return;return t&&(this.toolInstance[e]=new bl[r],this.toolInstance[e].$stage=this.$stage,bu.button=e),this.toolInstance[e]}return e===bu.button?this.toolInstance[e]:(0!==e&&(Su(!0),this.toolInstance[bu.button].mouseUp()),this.toolInstance[bu.button])}}]),e}();function Pu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Tu=function(e){ya(n,xs);var t=Pu(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_validateAdd",value:function(e){var t=e.getType();"Group"!==t&&"Shape"!==t&&Vo.throw("You may only add groups and shapes to groups.")}}]),n}();Tu.prototype.nodeType="Group",Mo(Tu);var Du=function(e){var t=".node-anchor";e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.HOVER)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.HOVER["default-color"]),e.show();var i=e.getParent().getChildren().length-1;e.zIndex(i)})),t=".node-item",e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.HOVER)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.HOVER["default-color"])})),t=".node-dashline",e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.HOVER)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.HOVER["default-color"])})),t=".node-label",e.find(t).forEach((function(e){var n,r;e.fill(null!==(n=null===(r=mo.HOVER)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.HOVER["default-color"])}))},Cu=function(e){var t=".node-anchor";e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.NORMAL)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.NORMAL["default-color"]),e.hide()})),t=".node-item",e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.NORMAL)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.NORMAL["default-color"])})),t=".node-dashline",e.find(t).forEach((function(e){var n,r;e.stroke(null!==(n=null===(r=mo.NORMAL)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.NORMAL["default-color"])})),t=".node-label",e.find(t).forEach((function(e){var n,r;e.fill(null!==(n=null===(r=mo.NORMAL)||void 0===r?void 0:r[t])&&void 0!==n?n:mo.NORMAL["default-color"])}))},Eu=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",n=e.getStage();n&&(n.container().style.cursor=t||"auto")},Au=function(e,t,n){return e.map((function(e){return e*t+n}))},Ru=function(e,t,n){for(var r=e,i=[[r.x(),r.y()+r.height()/2],[r.x()+r.width()/2,r.y()],[r.x()+r.width(),r.y()+r.height()/2],[r.x()+r.width()/2,r.y()+r.height()]],a=9007199254740991,o=null,s=null,u=function(e,t){return Math.pow(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2),.5)},l=0;l<t.length;l+=1)for(var c=0;c<i.length;c+=1){var h=u(t[l],i[c]);h<a&&(o=t[l],s=i[c],a=h)}n.points([o[0],o[1],s[0],s[1]]),n.show()},Iu=function(){return Math.random().toString(36).substring(2)};function Ou(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Lu=function(e){ya(n,Tu);var t=Ou(n);function n(){var e,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),r=t.call(this,i),(null===(e=i.useDefaultMouseEffect)||void 0===e||e)&&r._bindMouseEffect(),r}return Tr(n,[{key:"_bindMouseEffect",value:function(){var e=this,t=!1;this.on("mouseover",(function(t){Eu(e,"grab"),Du(e)})),this.on("mousedown",(function(n){Eu(e,"grabbing"),t=!0})),this.on("mouseout mouseleave",(function(n){t||(Eu(e),Cu(e))})),this.on("dragend mouseup",(function(n){Eu(e,"grab"),t=!1}))}}]),n}();function Mu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Nu=function(e){ya(n,Lu);var t=Mu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r))._data=null,e.UIInitialed=!1,e}return Tr(n,[{key:"initialUI",value:function(){}},{key:"verifyDataLegal",value:function(){}},{key:"convertLocalCoords",value:function(e){}},{key:"renderData",value:function(){}},{key:"mouseEnter",value:function(e){}},{key:"mouseLeave",value:function(e){}},{key:"mouseOver",value:function(e){}},{key:"mouseOut",value:function(e){}},{key:"mouseMove",value:function(e){}},{key:"mouseDown",value:function(e){}},{key:"mouseUp",value:function(e){}},{key:"mouseClick",value:function(e){}},{key:"mouseRightClick",value:function(e){}},{key:"mouseDoubleClick",value:function(e){}},{key:"mouseWheel",value:function(e){}},{key:"mouseWheelClick",value:function(e){}},{key:"documentMouseMove",value:function(e){}},{key:"documentMouseUp",value:function(e){}},{key:"data",get:function(){return this._data},set:function(e){this._data=e,this.careStageEvent=!1,this.UIInitialed||(this.initialUI(),Cu(this)),this.renderData()}},{key:"setData",value:function(e){this._data=e}}]),n}();function Fu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Bu=function(e){ya(n,Nu);var t=Fu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).careStageEvent=!0,e}return Tr(n,[{key:"dragAnchor",value:function(e){this.careStageEvent=!1}},{key:"dragAnchorEnd",value:function(e){}},{key:"dragText",value:function(e){this.careStageEvent=!1}},{key:"drag",value:function(e){this.careStageEvent=!1}},{key:"dragEnd",value:function(e){this.careStageEvent=!1}},{key:"mouseWheel",value:function(e){Yo(wa(n.prototype),"mouseWheel",this).call(this,e),this.mouseUp(e),Su(!0)}}]),n}(),qu={length:function(e){var t=JSON.parse(_i(e)),n=$s.transformPoint(e.position.x,e.position.y),r=$s.transformPoint(e.position.x+e.start.x,e.position.y+e.start.y),i=$s.transformPoint(e.position.x+e.end.x,e.position.y+e.end.y),a=$s.transformPoint(e.position.x+e.textBox.x,e.position.y+e.textBox.y);return t.position.x=n[0],t.position.y=n[1],t.end.x=i[0]-n[0],t.end.y=i[1]-n[1],t.start.x=r[0]-n[0],t.start.y=r[1]-n[1],t.textBox.x=a[0]-n[0],t.textBox.y=a[1]-n[1],t},angle:function(e){var t=JSON.parse(_i(e)),n=$s.transformPoint(e.position.x,e.position.y),r=$s.transformPoint(e.position.x+e.start.x,e.position.y+e.start.y),i=$s.transformPoint(e.position.x+e.middle.x,e.position.y+e.middle.y),a=$s.transformPoint(e.position.x+e.end.x,e.position.y+e.end.y),o=$s.transformPoint(e.position.x+e.textBox.x,e.position.y+e.textBox.y);return t.position.x=n[0],t.position.y=n[1],t.start.x=r[0]-n[0],t.start.y=r[1]-n[1],t.middle.x=i[0]-n[0],t.middle.y=i[1]-n[1],t.end.x=a[0]-n[0],t.end.y=a[1]-n[1],t.textBox.x=o[0]-n[0],t.textBox.y=o[1]-n[1],t},ellipse_roi:function(e){var t=JSON.parse(_i(e)),n=$s.transformPoint(e.position.x,e.position.y),r=$s.transformPoint(e.position.x+e.start.x,e.position.y+e.start.y),i=$s.transformPoint(e.position.x+e.end.x,e.position.y+e.end.y),a=$s.transformPoint(e.position.x+e.textBox.x,e.position.y+e.textBox.y);return t.position.x=n[0],t.position.y=n[1],t.end.x=i[0]-n[0],t.end.y=i[1]-n[1],t.start.x=r[0]-n[0],t.start.y=r[1]-n[1],t.textBox.x=a[0]-n[0],t.textBox.y=a[1]-n[1],t}},Uu=function(e){var t=e.type;return null==qu?void 0:qu[t](e)},Gu=function(e,t){return $s.invertPoint(e,t)};function zu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Vu=function(e){ya(n,Bu);var t=zu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,n),(e=t.call(this,r)).type=bo.ANGLE;var i=Iu();return e.name(i),e._data={id:i,type:e.type,start:{x:0,y:0},middle:{x:0,y:0},position:{x:0,y:0},end:{x:0,y:0},textBox:{dragged:!1,x:0,y:0,text:""}},e.careStageEvent=!0,e.pointCount=0,Su(!1),e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),2!==this.pointCount&&(this.initialUI(),this.data.position=this.$stage.getPointerPosition(),this.pointCount+=1)}},{key:"mouseMove",value:function(e){if(Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.careStageEvent&&3!==this.pointCount&&0!==this.pointCount){var t=this.getRelativePointerPosition();switch(this.pointCount){case 1:this.data.middle=t;break;case 2:this.data.end=t,this.data.textBox.text=this._getAngle()}this.renderData()}}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.pointCount+=1,3===this.pointCount&&(this.pointCount=0,Su(!0),this.careStageEvent=!1,this._tryUpdateData())}},{key:"renderData",value:function(){Yo(wa(n.prototype),"renderData",this).call(this);var e=this.data,t=e.start,r=e.end,i=e.middle,a=e.position,o=e.textBox;this.setPosition(a),this.findOne("#anchorStart").setPosition(t),this.findOne("#anchorMiddle").setPosition(i),this.findOne("#anchorEnd").setPosition(r),this.findOne("#line1").points([t.x,t.y,i.x,i.y]),this.findOne("#line2").points([i.x,i.y,r.x,r.y]);var s=this.findOne(".".concat(wo));if(o.dragged){var u=[[t.x,t.y],[i.x,i.y],[r.x,r.y]];s.setPosition({x:o.x,y:o.y});var l=this.findOne(".".concat(_o));Ru(s,u,l)}else{var c=this._getAngle(),h=c<=180?i.x-65:i.x+10,f=c<=180?"right":"left";s.align(f),s.setPosition({x:h,y:i.y})}s.text(this.showAngle(o.text))}},{key:"initialUI",value:function(){var e=this;if(Yo(wa(n.prototype),"initialUI",this).call(this),!this.UIInitialed){var t=new cu({id:"anchorStart"}),r=new cu({id:"anchorMiddle"}),i=new cu({id:"anchorEnd"});[t,r,i].forEach((function(t){t.on("dragmove",e.dragAnchor.bind(e)),t.on("dragend",e.dragAnchorEnd.bind(e))}));var a=new ou({hitStrokeWidth:vo,name:xo,id:"line1"}),o=new ou({hitStrokeWidth:vo,name:xo,id:"line2"}),s=new wu;s.width(55),s.on("dragmove",this.dragText.bind(this));var u=new fu({visible:!1});this.draggable(!0),this.on("dragend",this.dragEnd.bind(this)),this.add(t,r,i,a,o,s,u),this.$stage.findOne("#toolsLayer").add(this),this.draw()}}},{key:"verifyDataLegal",value:function(){var e=this.data,t=e.start,n=e.end,r=e.middle,i=e.position;return[[t.x+i.x,t.y+i.y],[r.x+i.x,r.y+i.y],[n.x+i.x,n.y+i.y]].every((function(e){var t=ao(e,2),n=t[0],r=t[1];return Qs(n,r)}))}},{key:"dragAnchor",value:function(e){Yo(wa(n.prototype),"dragAnchor",this).call(this,e);var t=e.target;switch(t.getId()){case"anchorStart":this.data.start=t.getPosition();break;case"anchorMiddle":this.data.middle=t.getPosition();break;case"anchorEnd":this.data.end=t.getPosition()}this.data.textBox.text=this._getAngle(),this.renderData()}},{key:"dragAnchorEnd",value:function(e){Yo(wa(n.prototype),"dragAnchorEnd",this).call(this,e),this._tryUpdateData()}},{key:"dragEnd",value:function(e){Yo(wa(n.prototype),"dragEnd",this).call(this,e),this.data.position=this.getPosition(),this.renderData(),this._tryUpdateData()}},{key:"dragText",value:function(e){Yo(wa(n.prototype),"dragText",this).call(this,e);var t=e.target.getPosition();this.data.textBox=Ra({},this.data.textBox,{dragged:!0,x:t.x,y:t.y}),this.renderData()}},{key:"showAngle",value:function(e){if(""===e)return"";var t=(e+360)%360;return t>180&&(t=360-t),"".concat(t.toFixed(1),"°")}},{key:"_getAngle",value:function(){var e=this.data,t=e.start,n=e.end,r=e.middle,i=t.x-r.x,a=t.y-r.y,o=n.x-r.x,s=n.y-r.y,u=i*o+a*s,l=i*s-a*o;return+((Math.atan2(l,u)/Math.PI*180+360)%360).toFixed(1)}},{key:"_tryUpdateData",value:function(){if(!this.verifyDataLegal()&&this.getStage())return this.getStage().fire(So.DATA_REMOVED,{id:this.data.id}),void this.remove();var e=this.getStage();if(e){var t=this._convertData();e.fire(So.DATA_UPDATED,{id:this.data.id,data:t})}}},{key:"_convertData",value:function(){var e=this.data,t=e.start,n=e.middle,r=e.end,i=e.position,a=e.textBox,o=Gu(i.x,i.y),s=Gu(i.x+t.x,i.y+t.y),u=Gu(i.x+n.x,i.y+n.y),l=Gu(i.x+r.x,i.y+r.y),c=Gu(i.x+a.x,i.y+a.y),h=JSON.parse(_i(this.data));return h.position={x:o[0],y:o[1]},h.start={x:s[0]-o[0],y:s[1]-o[1]},h.middle={x:u[0]-o[0],y:u[1]-o[1]},h.end={x:l[0]-o[0],y:l[1]-o[1]},h.textBox.x=c[0]-o[0],h.textBox.y=c[1]-o[1],h}},{key:"data",get:function(){return Yo(wa(n.prototype),"data",this)},set:function(e){!function(e,t,n,r,i){if(!nu(e,t,n,r||e)&&i)throw new Error("failed to set property")}(wa(n.prototype),"data",e,this,!0),Su(!0)}}]),n}();function Wu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var ju=function(e){ya(n,Rs);var t=Wu(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_sceneFunc",value:function(e){var t=this.radiusX(),n=this.radiusY();e.beginPath(),e.save(),t!==n&&e.scale(1,n/t),e.arc(0,0,t,0,2*Math.PI,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}},{key:"getWidth",value:function(){return 2*this.radiusX()}},{key:"getHeight",value:function(){return 2*this.radiusY()}},{key:"setWidth",value:function(e){this.radiusX(e/2)}},{key:"setHeight",value:function(e){this.radiusY(e/2)}}]),n}();function Hu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}ju.prototype.className="Ellipse",ju.prototype._centroid=!0,ju.prototype._attrsAffectingSize=["radiusX","radiusY"],Mo(ju),es.addComponentsGetterSetter(ju,"radius",["x","y"]),es.addGetterSetter(ju,"radiusX",0,Xo()),es.addGetterSetter(ju,"radiusY",0,Xo());var Yu=function(e){ya(n,Rs);var t=Hu(n);function n(){return kr(this,n),t.apply(this,arguments)}return Tr(n,[{key:"_sceneFunc",value:function(e){var t=this.cornerRadius(),n=this.width(),r=this.height();if(e.beginPath(),t){var i=0,a=0,o=0,s=0;"number"==typeof t?i=a=o=s=Math.min(t,n/2,r/2):(i=Math.min(t[0]||0,n/2,r/2),a=Math.min(t[1]||0,n/2,r/2),s=Math.min(t[2]||0,n/2,r/2),o=Math.min(t[3]||0,n/2,r/2)),e.moveTo(i,0),e.lineTo(n-a,0),e.arc(n-a,a,a,3*Math.PI/2,0,!1),e.lineTo(n,r-s),e.arc(n-s,r-s,s,0,Math.PI/2,!1),e.lineTo(o,r),e.arc(o,r-o,o,Math.PI/2,Math.PI,!1),e.lineTo(0,i),e.arc(i,i,i,Math.PI,3*Math.PI/2,!1)}else e.rect(0,0,n,r);e.closePath(),e.fillStrokeShape(this)}}]),n}();function Zu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}Yu.prototype.className="Rect",Mo(Yu),es.addGetterSetter(Yu,"cornerRadius",0,function(e){if(Lo.isUnminified)return function(t,n){var r=Vo._isNumber(t),i=Vo._isArray(t)&&t.length==e;return r||i||Vo.warn(Zo(t)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+e+")"),t}}(4));var Xu=function(e){ya(n,Tu);var t=Zu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).textfiled1=new wu({height:20,width:70}),e.textfiled1.align("left"),e.textfiled1.draggable(!1),e.textfield2=new wu({height:20,x:70,width:90}),e.textfield2.align("right"),e.textfield2.draggable(!1),e.add(e.textfiled1,e.textfield2),e}return Tr(n,[{key:"setText",value:function(e,t){this.textfiled1.text(e),this.textfield2.text(t)}}]),n}(),Ku={wwwc:{ww:0,wc:0},columns:0,rows:0,seriesId:null,sliceId:null,pixelData:null,imgCanvas:null,canvas:null,columnPixelSpacing:null,rowPixelSpacing:null,slope:null,intercept:null};function Ju(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var $u=function(e){ya(n,Bu);var t=Ju(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,n),(e=t.call(this,r)).type=bo.ELLIPSE_ROI;var i=Iu();return e.name(i),e._data={id:i,type:e.type,position:{x:0,y:0},start:{x:0,y:0},end:{x:0,y:0},textBox:{dragged:!1,x:0,y:0}},e.isDown=!1,e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.initialUI(),this.data.position=this.$stage.getPointerPosition(),this.renderData(),this.isDown=!0}},{key:"mouseMove",value:function(e){Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.isDown&&(this.data.end=this.getRelativePointerPosition(),this.renderData())}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.isDown=!1,this._tryUpdateData()}},{key:"initialUI",value:function(){var e=this;Yo(wa(n.prototype),"initialUI",this).call(this);var t=new cu({id:"startAnchor"}),r=new cu({id:"endAnchor"}),i=new Yu({id:"rect",name:yo,stroke:"#000",opacity:0}),a=new ju(qs({id:"ellipse",hitStrokeWidth:60,stroke:"#FFF",name:xo},"stroke",mo.NORMAL[".".concat(xo)]));[t,r].forEach((function(t){t.on("dragmove",e.dragAnchor.bind(e)),t.on("dragend",e.dragAnchorEnd.bind(e))}));var o=new Tu({id:"textGroup",draggable:!0,width:165,height:100});o.on("dragmove",this.dragText.bind(this));var s=new Xu({id:"area"}),u=new Xu({id:"variance",y:20}),l=new Xu({id:"avg",y:40}),c=new Xu({id:"max",y:60}),h=new Xu({id:"min",y:80});o.add(s,u,l,c,h);var f=new fu({visible:!1});this.draggable(!0),this.on("dragmove",this.dragMove.bind(this)),this.on("dragend",this.dragEnd.bind(this)),this.add(i,t,r,a,o,f),this.$stage.findOne("#toolsLayer").add(this),this.draw()}},{key:"renderData",value:function(){var e,t,r,i,a;Yo(wa(n.prototype),"renderData",this).call(this);var o=this.data,s=o.position,u=o.start,l=o.end,c=o.textBox;this.setPosition(s),this.findOne("#startAnchor").setPosition(u),this.findOne("#endAnchor").setPosition(l),this.findOne("#rect").setPosition(u),this.findOne("#ellipse").setPosition(u),this.findOne("#ellipse").offset({x:(u.x-l.x)/2,y:(u.y-l.y)/2});var h=Math.abs(l.x-u.x),f=Math.abs(l.y-u.y);this.findOne("#ellipse").size({width:h,height:f}),this.findOne("#rect").size({width:l.x-u.x,height:l.y-u.y});var d=this._getPixelData(),p=this._getInfo(d),v=this.findOne("#textGroup");if(null===(e=v.findOne("#area"))||void 0===e||e.setText("面积：","".concat(+p.area.toFixed(2),"mm²")),null===(t=v.findOne("#variance"))||void 0===t||t.setText("方差：",+p.variance.toFixed(2)),null===(r=v.findOne("#avg"))||void 0===r||r.setText("平均值：",+p.avg.toFixed(2)),null===(i=v.findOne("#max"))||void 0===i||i.setText("最大值：",p.max),null===(a=v.findOne("#min"))||void 0===a||a.setText("最小值：",p.min),this.data.textBox.dragged){var g=this.findOne(".".concat(_o)),m=[[(u.x+l.x)/2,u.y],[l.x,(u.y+l.y)/2],[(u.x+l.x)/2,l.y],[u.x,(u.y+l.y)/2]];v.setPosition({x:c.x,y:c.y}),Ru(v,m,g)}else{var y=Math.max(u.x,l.x),x=Math.min(u.y,l.y);v.setPosition({x:y+10,y:x})}}},{key:"dragMove",value:function(){this.data.position=this.getPosition(),this.renderData()}},{key:"dragEnd",value:function(e){Yo(wa(n.prototype),"dragEnd",this).call(this,e),this._tryUpdateData()}},{key:"dragAnchor",value:function(e){Yo(wa(n.prototype),"dragAnchor",this).call(this,e);var t=e.target;"startAnchor"===t.getId()?this._data.start=t.getPosition():"endAnchor"===t.getId()&&(this._data.end=t.getPosition()),this.renderData()}},{key:"dragAnchorEnd",value:function(e){Yo(wa(n.prototype),"dragAnchorEnd",this).call(this,e),this._tryUpdateData()}},{key:"dragText",value:function(e){Yo(wa(n.prototype),"dragText",this).call(this,e);var t=e.target;this.data.textBox=Ra({},this.data.textBox,{dragged:!0},t.position()),this.renderData()}},{key:"verifyDataLegal",value:function(){var e=this.data,t=e.start,n=e.end,r=e.position;return[[t.x+r.x,t.y+r.y],[n.x+r.x,n.y+r.y]].every((function(e){var t=ao(e,2),n=t[0],r=t[1];return Qs(n,r)}))}},{key:"_tryUpdateData",value:function(){if(!this.verifyDataLegal()&&this.getStage())return this.getStage().fire(So.DATA_REMOVED,{id:this.data.id}),void this.remove();var e=this.getStage();if(e){var t=this._convertData();e.fire(So.DATA_UPDATED,{id:this.data.id,data:t})}}},{key:"_convertData",value:function(){var e=this.data,t=e.position,n=e.end,r=e.start,i=e.textBox,a=Gu(t.x,t.y),o=Gu(t.x+r.x,t.y+r.y),s=Gu(t.x+n.x,t.y+n.y),u=Gu(t.x+i.x,t.y+i.y),l=JSON.parse(_i(this.data));return l.position={x:a[0],y:a[1]},l.start={x:o[0]-a[0],y:o[1]-a[1]},l.end={x:s[0]-a[0],y:s[1]-a[1]},l.textBox.x=u[0]-a[0],l.textBox.y=u[1]-a[1],l}},{key:"_getArea",value:function(){var e=this.data.end,t=Ku.columnPixelSpacing,n=void 0===t?.625:t,r=Ku.rowPixelSpacing,i=void 0===r?.625:r,a=Math.abs(e.x)/2,o=Math.abs(e.y)/2;return Math.PI*(a*n)*(o*i)}},{key:"_getPixelData",value:function(){for(var e=this.data,t=e.position,n=e.start,r=e.end,i=Ku.pixelData,a=Gu(t.x+n.x,t.y+n.y),o=Gu(t.x+r.x,t.y+r.y),s=Math.abs(a[0]-o[0]),u=Math.abs(a[1]-o[1]),l=Math.round(Math.min(a[0],o[0])),c=Math.round(Math.min(a[1],o[1])),h=Math.abs(a[0]-o[0])/2,f=Math.abs(a[1]-o[1])/2,d=[(a[0]+o[0])/2,(a[1]+o[1])/2],p=[],v=0,g=0;g<u;g++)for(var m=0;m<s;m++)if(this._inEllipse(h,f,m+l,g+c,d)){var y=(g+c)*Ku.columns+(m+l);p[v++]=i[y]}return Au(p,Ku.slope,Ku.intercept)}},{key:"_getInfo",value:function(e){for(var t=0,n=0,r=9007199254740991,i=-9007199254740991,a=0;a<e.length;a++){var o=e[a];t+=o,r=Math.min(r,o),i=Math.max(i,o)}for(var s=t/e.length,u=0;u<e.length;u++){var l=e[u];n+=Math.pow(l-s,2)}return{variance:Math.sqrt(n/e.length),max:i,min:r,area:this._getArea(),avg:s}}},{key:"_inEllipse",value:function(e,t,n,r,i){return Math.pow(n-i[0],2)/Math.pow(e,2)+Math.pow(r-i[1],2)/Math.pow(t,2)<=1}}]),n}();function Qu(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var el=function(e){ya(n,Bu);var t=Qu(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,n),(e=t.call(this,r)).type=bo.LENGTH;var i=Iu();return e.name(i),e._data={id:i,type:e.type,position:{x:0,y:0},start:{x:0,y:0},end:{x:0,y:0},textBox:{dragged:!1,x:0,y:0,text:""}},e.careStageEvent=!0,e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.initialUI(),this.data.position=this.$stage.getPointerPosition()}},{key:"mouseMove",value:function(e){if(Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.careStageEvent){var t=this.getRelativePointerPosition();this.data.end=t,this._calcText(),this.renderData()}}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.careStageEvent=!1,this._tryUpdateData()}},{key:"verifyDataLegal",value:function(){var e=this.data,t=e.start,n=e.end,r=e.position;return[[t.x+r.x,t.y+r.y],[n.x+r.x,n.y+r.y]].every((function(e){var t=ao(e,2),n=t[0],r=t[1];return Qs(n,r)}))}},{key:"renderData",value:function(){var e,t,r;Yo(wa(n.prototype),"renderData",this).call(this);var i=this.data,a=i.position,o=i.start,s=i.end,u=i.textBox;this.setPosition(a),null===(e=this.findOne("#startAnchor"))||void 0===e||e.setPosition(o),null===(t=this.findOne("#endAnchor"))||void 0===t||t.setPosition(s),null===(r=this.findOne(".".concat(xo)))||void 0===r||r.points([o.x,o.y,s.x,s.y]);var l=this.findOne(".".concat(wo));if(u.dragged){var c=[[o.x,o.y],[s.x,s.y],[(o.x+s.x)/2,(o.y+s.y)/2]];l.setPosition({x:u.x,y:u.y});var h=this.findOne(".".concat(_o));Ru(l,c,h)}else{var f=s.x-o.x>0?s:o;l.setPosition({x:f.x+10,y:f.y})}l.text("".concat(u.text,"mm"))}},{key:"initialUI",value:function(){var e=this;if(Yo(wa(n.prototype),"initialUI",this).call(this),!this.UIInitialed){var t=new cu({id:"startAnchor"}),r=new cu({id:"endAnchor"});[t,r].forEach((function(t){t.on("dragmove",e.dragAnchor.bind(e)),t.on("dragend",e.dragAnchorEnd.bind(e))}));var i=new ou({hitStrokeWidth:vo,name:xo}),a=new wu;a.on("dragmove",this.dragText.bind(this));var o=new fu({visible:!1});this.draggable(!0),this.on("dragend",this.dragEnd.bind(this)),this.add(t,r,i,a,o),this.$stage.findOne("#toolsLayer").add(this),this.draw(),this.UIInitialed=!0}}},{key:"dragAnchor",value:function(e){Yo(wa(n.prototype),"dragAnchor",this).call(this,e);var t=e.target;"startAnchor"===t.getId()?this._data.start=t.getPosition():"endAnchor"===t.getId()&&(this._data.end=t.getPosition()),this._calcText(),this.renderData()}},{key:"dragAnchorEnd",value:function(e){Yo(wa(n.prototype),"dragAnchorEnd",this).call(this,e),this._tryUpdateData()}},{key:"dragEnd",value:function(e){Yo(wa(n.prototype),"dragEnd",this).call(this,e),this.data.position=this.getPosition(),this.renderData(),this._tryUpdateData()}},{key:"dragText",value:function(e){Yo(wa(n.prototype),"dragText",this).call(this,e);var t=e.target;this.data.textBox=Ra({},this.data.textBox,{dragged:!0},t.getPosition()),this.renderData()}},{key:"_calcText",value:function(){var e=this.data,t=e.start,n=e.end,r=e.position,i=Gu(r.x+t.x,r.y+t.y),a=Gu(r.x+n.x,r.y+n.y),o=Ku.columnPixelSpacing,s=Ku.rowPixelSpacing,u=Math.pow(i[0]*o-a[0]*o,2),l=Math.pow(i[1]*s-a[1]*s,2),c=+Math.sqrt(u+l).toFixed(2);this.data.textBox.text=c}},{key:"_tryUpdateData",value:function(){if(!this.verifyDataLegal()&&this.getStage())return this.getStage().fire(So.DATA_REMOVED,{id:this.data.id}),void this.remove();var e=this.getStage();if(e){var t=this._convertData();e.fire(So.DATA_UPDATED,{id:this.data.id,data:t})}}},{key:"_convertData",value:function(){var e=this.data,t=e.position,n=e.end,r=e.textBox,i=e.start,a=Gu(t.x,t.y),o=Gu(t.x+i.x,t.y+i.y),s=Gu(t.x+n.x,t.y+n.y),u=Gu(t.x+r.x,t.y+r.y),l=JSON.parse(_i(this.data));return l.position={x:a[0],y:a[1]},l.start={x:o[0]-a[0],y:o[1]-a[1]},l.end={x:s[0]-a[0],y:s[1]-a[1]},l.textBox.x=u[0]-a[0],l.textBox.y=u[1]-a[1],l}}]),n}();function tl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var nl=function(e){ya(n,Bu);var t=tl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};kr(this,n),(e=t.call(this,Ra({},r,{useDefaultMouseEffect:!1}))).type=bo.PROBE;var i=Iu();return e.name(i),e._data={id:i,type:e.type,position:{x:0,y:0}},e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.initialUI(),this.data.position=this.$stage.getPointerPosition(),this.renderData()}},{key:"mouseMove",value:function(e){Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.data.position=this.$stage.getPointerPosition(),this.renderData()}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.remove()}},{key:"initialUI",value:function(){Yo(wa(n.prototype),"initialUI",this).call(this);var e=new wu;e.setPosition({x:20,y:10}),e.draggable(!1),e.show(),this.add(e),this.$stage.findOne("#toolsLayer").add(this),this.UIInitialed=!0}},{key:"renderData",value:function(){Yo(wa(n.prototype),"renderData",this).call(this);var e=this.data.position,t=this.findOne(".".concat(wo));if(this.setPosition(e),Qs(e.x,e.y)){var r=Gu(e.x,e.y);t.show();var i=this._getCT(Math.round(r[0]),Math.round(r[1]));t.text("CT: ".concat(i))}else t.hide()}},{key:"_getCT",value:function(e,t){var n=t*Ku.columns+e;return Au([Ku.pixelData[n]],Ku.slope,Ku.intercept)}}]),n}();function rl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var il=document.createElement("canvas"),al=function(e){ya(n,Nu);var t=rl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,Ra({},r,{useDefaultMouseEffect:!1}))).type=bo.MAGNIFYING,e.dom=null,e.name=Iu(),e._data={id:e.name,type:e.type,originalRadius:50,scale:3,centerPoint:{x:0,y:0},size:250},e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.initialUI(),this.findOne("#circle").visible(!0),this.findOne("#circleBG").visible(!0),this.data.centerPoint=this.$stage.getRelativePointerPosition(),Eu(this,"none"),this.renderData()}},{key:"mouseMove",value:function(e){Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.data.centerPoint=this.$stage.getRelativePointerPosition(),this.renderData()}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),Eu(this,"auto"),this.remove()}},{key:"renderData",value:function(){Yo(wa(n.prototype),"renderData",this).call(this);var e=this.data,t=e.centerPoint;e.originalRadius,e.scale;var r=this.findOne("#circleBG"),i=this.findOne("#circle");i.setPosition(t),i.width(this.data.size),i.height(this.data.size),i.fillPatternImage(this._getImage()),i.fillPatternOffset({x:il.width/2,y:il.height/2}),r.setPosition(t),r.width(this.data.size),r.height(this.data.size)}},{key:"initialUI",value:function(){Yo(wa(n.prototype),"initialUI",this).call(this);var e=new uu({id:"circle",stroke:"#fff",strokeWidth:2,radius:70,visible:!1,fillPatternRepeat:"no-repeat"}),t=new uu({id:"circleBG",fill:"black",radius:70,visible:!1});this.add(t,e),this.$stage.findOne("#toolsLayer").add(this),this.draw()}},{key:"_getImage",value:function(){var e=il;il.width=2*this.data.size,il.height=2*this.data.size;var t=e.getContext("2d"),n=Gu(this.data.centerPoint.x,this.data.centerPoint.y);return t.drawImage(Ku.imgCanvas,n[0]-this.data.originalRadius/ko.scale,n[1]-this.data.originalRadius/ko.scale,2*this.data.originalRadius/ko.scale,2*this.data.originalRadius/ko.scale,0,0,il.width,il.height),e}}]),n}(),ol=s((function(e){!function(){function t(e,t,n){var r=t.x,i=t.y,a=n.x-r,o=n.y-i;if(0!==a||0!==o){var s=((e.x-r)*a+(e.y-i)*o)/(a*a+o*o);s>1?(r=n.x,i=n.y):s>0&&(r+=a*s,i+=o*s)}return(a=e.x-r)*a+(o=e.y-i)*o}function n(e,r,i,a,o){for(var s,u=a,l=r+1;l<i;l++){var c=t(e[l],e[r],e[i]);c>u&&(s=l,u=c)}u>a&&(s-r>1&&n(e,r,s,a,o),o.push(e[s]),i-s>1&&n(e,s,i,a,o))}function r(e,t){var r=e.length-1,i=[e[0]];return n(e,0,r,t,i),i.push(e[r]),i}function i(e,t,n){if(e.length<=2)return e;var i=void 0!==t?t*t:1;return e=r(e=n?e:function(e,t){for(var n,r,i,a,o,s=e[0],u=[s],l=1,c=e.length;l<c;l++)n=e[l],i=s,a=void 0,o=void 0,a=(r=n).x-i.x,o=r.y-i.y,a*a+o*o>t&&(u.push(n),s=n);return s!==n&&u.push(n),u}(e,i),i)}e.exports=i,e.exports.default=i}()}));function sl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var ul=function(e){ya(n,Nu);var t=sl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),r.useDefaultMouseEffect=!1,(e=t.call(this,r)).type=bo.POLYGON,e.name=Iu(),e._data={id:e.name,type:e.type,position:{x:0,y:0},points:[]},e}return Tr(n,[{key:"initialUI",value:function(){if(Yo(wa(n.prototype),"initialUI",this).call(this),!this.UIInitialed){var e=new ou({hitStrokeWidth:vo,name:xo,fill:"blue",closed:!0,stroke:"white",strokeWidth:2,opacity:.2,fillAfterStrokeEnabled:!1});this.add(e),this.$stage.findOne("#toolsLayer").add(this),this.draw(),this.UIInitialed=!0}}},{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.isPaint=!0,this.initialUI(),this.data.position=this.$stage.getPointerPosition(),this.setAbsolutePosition(this.data.position)}},{key:"mouseMove",value:function(e){if(Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.isPaint){var t=this.getRelativePointerPosition();this.data.points.push(t),this.renderData()}}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.isPaint=!1,this._tryUpdateData()}},{key:"mouseRightClick",value:function(e){Yo(wa(n.prototype),"mouseRightClick",this).call(this,e),console.log(e)}},{key:"renderData",value:function(){Yo(wa(n.prototype),"renderData",this).call(this);var e=this.data,t=e.position,r=e.points;this.setPosition(t);var i=(r=ol(r,.3,!0)).map((function(e){return[e.x,e.y]}));this.findOne(".".concat(xo)).points(i.flat()),this.draw()}},{key:"_tryUpdateData",value:function(){}}]),n}();function ll(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var cl=function(e){ya(n,Nu);var t=ll(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).rotate=0,e.isDown=!1,e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.isDown=!0}},{key:"mouseMove",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.isDown&&(this.rotate=(this.rotate+90)%360,this.$stage.fire(So.TOOL_ROTATION,{rotate:this.rotate}))}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.isDown=!1}}]),n}();function hl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var fl=function(e){ya(n,Nu);var t=hl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).isDown=!1,e.oldOffsetY=null,e.scale=ko.scale,e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.isDown=!0,this.oldOffsetY=e.evt.screenY}},{key:"documentMouseMove",value:function(e){if(Yo(wa(n.prototype),"documentMouseMove",this).call(this,e),this.isDown){var t=e.screenY-this.oldOffsetY;this.oldOffsetY=e.screenY;var r=t/200,i=Math.log(this.scale)/Math.log(1.7)+r;this.scale=Math.pow(1.7,i),this.scale<.05?this.scale=.05:this.scale>10&&(this.scale=10),this.isDown&&this.$stage.fire(So.TOOL_SCALE,{scale:this.scale})}}},{key:"documentMouseUp",value:function(e){Yo(wa(n.prototype),"documentMouseUp",this).call(this,e),this.isDown=!1}}]),n}();function dl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var pl=function(e){ya(n,Nu);var t=dl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).isDown=!1,e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e),this.isDown=!0}},{key:"mouseMove",value:function(e){if(Yo(wa(n.prototype),"mouseMove",this).call(this,e),this.isDown){var t=e.evt.movementY;0!==t&&this.$stage.fire(So.TOOL_STACK_CHANGE,{delta:Math.sign(t)})}}},{key:"mouseUp",value:function(e){Yo(wa(n.prototype),"mouseUp",this).call(this,e),this.isDown=!1}}]),n}();function vl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var gl=function(e){ya(n,Nu);var t=vl(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),t.call(this,e)}return Tr(n,[{key:"mouseWheel",value:function(e){Yo(wa(n.prototype),"mouseWheel",this).call(this,e);var t=e.evt.wheelDelta;this.$stage.fire(So.TOOL_STACK_CHANGE,{delta:-Math.sign(t)})}}]),n}();function ml(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var yl=function(e){ya(n,Nu);var t=ml(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).isDown=!1,e.oldOffset=null,e.step=null,e.type=bo.TRANSLATE,e.name=Iu(),e._data={id:e.name,type:e.type,offset:{x:0,y:0}},e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e);var t=e.evt,r=t.screenX,i=t.screenY;this.isDown=!0,this.oldOffset=[r,i],this.step={x:ko.x,y:ko.y}}},{key:"documentMouseMove",value:function(e){if(Yo(wa(n.prototype),"documentMouseMove",this).call(this,e),this.isDown){var t={x:e.screenX-this.oldOffset[0]+this.step.x,y:e.screenY-this.oldOffset[1]+this.step.y};this.data.offset=t,this.$stage.fire(So.TOOL_TRANSLATE,{offset:t})}}},{key:"documentMouseUp",value:function(e){Yo(wa(n.prototype),"documentMouseUp",this).call(this,e),this.isDown=!1}}]),n}();function xl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var _l,wl=function(e){ya(n,Nu);var t=xl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).isDown=!1,e.oldOffset=null,e.step=null,e.type=bo.WWWC,e.name=Iu(),e._data={id:e.name,type:e.type,wwwc:{ww:0,wc:0}},e}return Tr(n,[{key:"mouseDown",value:function(e){Yo(wa(n.prototype),"mouseDown",this).call(this,e);var t=e.evt,r=t.screenX,i=t.screenY;this.isDown=!0,this.oldOffset=[r,i],this.step={ww:Ku.wwwc.ww,wc:Ku.wwwc.wc}}},{key:"documentMouseMove",value:function(e){if(Yo(wa(n.prototype),"documentMouseMove",this).call(this,e),this.isDown){var t={ww:e.screenX-this.oldOffset[0]+this.step.ww,wc:e.screenY-this.oldOffset[1]+this.step.wc};this.data.wwwc=t,this.$stage.fire(So.TOOL_WWWC,{wwwc:t})}}},{key:"documentMouseUp",value:function(e){Yo(wa(n.prototype),"documentMouseUp",this).call(this,e),this.isDown=!1}}]),n}(),bl=(qs(_l={},bo.LENGTH,el),qs(_l,bo.ANGLE,Vu),qs(_l,bo.ROTATION,cl),qs(_l,bo.SCALE,fl),qs(_l,bo.POLYGON,ul),qs(_l,bo.TRANSLATE,yl),qs(_l,bo.WWWC,wl),qs(_l,bo.MAGNIFYING,al),qs(_l,bo.PROBE,nl),qs(_l,bo.STACK_SCROLL,pl),qs(_l,bo.STACK_WHEEL_SCROLL,gl),qs(_l,bo.ELLIPSE_ROI,$u),_l),Sl={mouseenter:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseEnter(e)},mouseleave:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseLeave(e)},mouseout:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseOut(e)},mouseover:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseOver(e)},mousemove:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseMove(e)},mousedown:function(e,t){var n,r,i=e.evt.which;"Stage"===(null===(n=e.target)||void 0===n?void 0:n.nodeType)&&(null===(r=t.getToolInstance(i,!0))||void 0===r||r.mouseDown(e))},mouseup:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseUp(e)},click:function(e,t){var n,r,i=e.evt.which;null===(n=t.getToolInstance(i))||void 0===n||null===(r=n[["mouseClick","mouseWheelClick"][i]])||void 0===r||r.call(n,e)},contextmenu:function(e,t){var n;e.evt.preventDefault();var r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseRightClick(e)},dblclick:function(e,t){var n,r=e.evt.which;null===(n=t.getToolInstance(r))||void 0===n||n.mouseDoubleClick(e)},wheel:function(e,t){var n;[1,2,3].map((function(n){var r;null===(r=t.getToolInstance(n))||void 0===r||r.mouseWheel(e)})),t.getToolType(4)&&!t.getToolInstance(4)&&t.getToolInstance(4,!0),null===(n=t.getToolInstance(4))||void 0===n||n.mouseWheel(e)}},kl={mousemove:function(e,t){var n,r=e.which;null===(n=t.getToolInstance(r))||void 0===n||n.documentMouseMove(e)},mouseup:function(e,t){var n,r=e.which;null===(n=t.getToolInstance(r))||void 0===n||n.documentMouseUp(e)}},Pl={},Tl=function(e,t){t.$stage=e,Ks(Sl).forEach((function(t){e.off(t,Pl[t]),delete Pl[t]})),Ks(Sl).forEach((function(n){Pl[n]=function(e){Sl[n](e,t)},e.on(n,Pl[n])})),Ks(kl).forEach((function(t){var n="document-".concat(t,"-").concat(e.id());document.removeEventListener(t,Pl[n]),delete Pl[n]})),Ks(kl).forEach((function(n){var r="document-".concat(n,"-").concat(e.id());Pl[r]=function(e){kl[n](e,t)},document.addEventListener(n,Pl[r])}))};function Dl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Cl=function(e){ya(n,$a);var t=Dl(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),(e=t.call(this,r)).toolState=new ku,e.area=new eu,e.initContainer(r.el),e}return Tr(n,[{key:"resize",value:function(e,t){this.stage.setSize({width:e,height:t})}},{key:"useTool",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.toolState.updateState(e,t,this.stage),Tl(this.stage,this.toolState)}},{key:"initContainer",value:function(e){var t=this,n=document.createElement("div");n.classList.add("tools-container"),n.style.cssText="position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0; z-index:2;",e.appendChild(n);var r=new Ys(Ra({},{container:n,id:this.id},this._getRootSize(e)));this.stage=r,r.add(new Bs({id:"toolsLayer"})),Ro(So).forEach((function(e){r.on(e,(function(n){t.emit(e,n)}))}))}},{key:"updateViewport",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.area.update(e)}},{key:"updateImageState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V(e).map((function(t){Ku[t]=e[t]}))}},{key:"renderData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jr,t=this.stage.findOne("#toolsLayer");t||console.error("can't find tools layer."),null==Wo||Wo._dragElements.clear(),t.removeChildren(),e.forEach((function(e){var n=e.type,r=e.id,i=new bl[n];i.$stage=t.getStage(),i.data=Uu(e),i.name(r)})),t.batchDraw()}},{key:"resetData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jr,t=this.stage.findOne("#toolsLayer");t||console.error("can't find tools layer."),e.forEach((function(e){var n=t.findOne(".".concat(e.id)),r=Uu(e);n.setData(r),n.renderData()})),t.batchDraw()}},{key:"_getRootSize",value:function(e){return{width:e.clientWidth,height:e.clientHeight}}}]),n}(),El=function(e,t){var n="tx-resizer",r=e.querySelector(".".concat(n)),i=-1,a=function(n){ia()-i<=100||(i=ia(),t(e))};if(r)r.contentWindow.onresize=a;else{var o=document.createElement("iframe");o.style.cssText="position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0; pointer-events:none;z-index:-1;",o.classList=[n],e.style.position="relative",e.style.overflow="hidden",e.insertBefore(o,e.firstChild),o.contentWindow.onresize=a}},Al={},Rl=function(){function e(t){kr(this,e),this.viewportMap=null!=t?t:new jr,this.links=new jr,this.isRunning=!1}return Tr(e,[{key:"link",value:function(e,t){var n={viewports:e,properties:t},r=this.viewportMap;e.forEach((function(n){var i=r.get(n),a=e.reduce((function(e,t){return n!==t&&e.push(r.get(t)),e}),[]);i.imageView.inject(t),t.forEach((function(e){var t="".concat(n,"-").concat(e),r=function(t){a.forEach((function(n){null==n||n.useCmd(e,t,!1)}))};Al[t]=r,i.imageView.on(t,r)}))}));var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return Math.random().toString(16).slice(2).substring(0,e)}();return this.links.set(i,n),console.log("[Linkage] 计划联动[".concat(e.join(","),"], 属性[").concat(t.join(","),"]")),i}},{key:"unlink",value:function(e){var t=this,n=this.links.get(e),r=n.viewports,i=n.properties;return r.forEach((function(e){t._removeHandler(e,i)})),this.links.delete(e)}},{key:"removeViewport",value:function(e){var t=this;this.links.forEach((function(n,r,i){var a=n.viewports,o=n.properties,s=a.findIndex((function(t){return t===e}));if(s>=0){var u=a.splice(s,1);t._removeHandler(u,o)}if(1===a.length){var l=ao(a,1)[0];return t._removeHandler(l,o),void i.delete(r)}i.set(r,{viewports:a,properties:o})}))}},{key:"launch",value:function(){this.isRunning=!0}},{key:"terminate",value:function(){this.isRunning=!1}},{key:"_removeHandler",value:function(e,t){var n=this.viewportMap.get(e);n&&t.forEach((function(e){var t="".concat(id,"-").concat(e),r=Al[t];n.imageView.off(t,r),delete Al[t]}))}}]),e}(),Il="viewer_",Ol={ROOT_SIZE_CHANGED:"".concat(Il,"root_size_changed"),POSITION_CHANGED:"".concat(Il,"position_changed"),SIZE_CHANGED:"".concat(Il,"size_changed"),SLICE_CHANGED:"".concat(Il,"slice_changed"),ROTATION_CHANGED:"".concat(Il,"rotation_changed"),SCALE_CHANGED:"".concat(Il,"scale_changed"),IMAGE_RENDERED:"".concat(Il,"image_rendered"),MATRIX_CHANGED:"".concat(Il,"matrix_rendered")},Ll=function(e,t,n){var r=e.samplesPerPixel,i=e.pixelData,a=n.width,o=n.height,s=n.getContext("2d");s.fillStyle="white",s.fillRect(0,0,a,o),s.imageSmoothingEnabled=!1;for(var u=s.getImageData(0,0,a,o),l=0,c=a*o,h=0;h<c*r;)u.data[l++]=t[i[h++]+-e.minPixelValue],u.data[l++]=t[i[h++]+-e.minPixelValue],u.data[l++]=t[i[h++]+-e.minPixelValue],u.data[l++]=t[i[h++]+-e.minPixelValue];s.putImageData(u,0,0)},Ml={},Nl=function(e,t){var n=t.wwwc,r=t.invert,i=void 0!==r&&r,a=e.windowWidth,o=e.windowCenter;if(null!=n&&n.ww&&null!=n&&n.wc){var s=n.ww;o=n.wc,a=s}Ks(Ml).length>50&&(Ml={});var u=e.minPixelValue,l=e.maxPixelValue,c="".concat(a,"-").concat(o,"-").concat(+i,"-").concat(u,"-").concat(l);return Ml[c]||(Ml[c]=Fl(e,a,o,i)),Ml[c]},Fl=function(e,t,n,r){var i=e.minPixelValue,a=e.maxPixelValue,o=Math.min(i,0),s=new Uint8ClampedArray(a-o+1),u=e.slope,l=e.intercept,c=Bl(u,l),h=ql(t,n);if(r)for(var f=i;f<=a;f+=1)s[f-o]=255-h(c(f));else for(var d=i;d<=a;d+=1)s[d-o]=h(c(d));return s},Bl=function(e,t){return function(n){return n*e+t}},ql=function(e,t){return function(n){return 255*((n-t)/e+.5)}},Ul=function(e,t,n){var r=e.pixelData,i=e.minPixelValue,a=n.width,o=n.height,s=n.getContext("2d");s.fillStyle="white",s.fillRect(0,0,a,o),s.imageSmoothingEnabled=!0;for(var u=s.getImageData(0,0,a,o),l=3,c=a*o,h=0;h<c;)u.data[l]=t[r[h++]+-i],l+=4;s.putImageData(u,0,0)},Gl=function(){function e(){kr(this,e),this.type="canvas",this.renderCanvas=document.createElement("canvas")}var t;return Tr(e,[{key:"render",value:(t=Sr(Ar.mark((function e(t,n){var r,i,a;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.renderCanvas,i=Nl(t,n),a=t.color,(["rgb","rgba"].includes(a)?Ll:Ul)(t,i,r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"renderData",get:function(){return this.renderCanvas}}]),e}(),zl=function(){function e(){kr(this,e),this.type="webgl",this.renderCanvas=document.createElement("canvas")}var t;return Tr(e,[{key:"render",value:(t=Sr(Ar.mark((function e(t,n){return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"renderData",get:function(){return this.renderCanvas}}]),e}();Gr("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return Nr.def(Rr(this,"Set"),e=0===e?0:e,e)}},Nr),p(p.P+p.R,"Set",{toJSON:zr("Set")}),Vr("Set"),Wr("Set");var Vl=l.Set,Wl=new(function(){function e(){kr(this,e),this.reset()}return Tr(e,[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var t=new e;return t.m=no(this.m),t}},{key:"multiply",value:function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=o}},{key:"invert",value:function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=o}},{key:"rotate",value:function(e){var t=Math.cos(e*Math.PI/180),n=Math.sin(e*Math.PI/180),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,o=this.m[1]*-n+this.m[3]*t;this.m[0]=r,this.m[1]=i,this.m[2]=a,this.m[3]=o}},{key:"translate",value:function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}},{key:"scale",value:function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}},{key:"transformPoint",value:function(e,t){var n=e,r=t;return{x:e=n*this.m[0]+r*this.m[2]+this.m[4],y:t=n*this.m[1]+r*this.m[3]+this.m[5]}}}]),e}()),jl=function(e,t,n){Wl.reset();var r=e.offset,i=e.scale,a=e.rotate,o=e.flip;r&&Wl.translate(r.x,r.y);var s=t.width,u=t.height;if(Wl.translate(s/2,u/2),o){var l=o.h,c=void 0!==l&&l,h=o.v,f=void 0!==h&&h?-1:1,d=c?-1:1;Wl.scale(d,f)}i&&Wl.scale(i,i),a&&Wl.rotate(a);var p=n.width,v=n.height;return Wl.translate(-p/2,-v/2),Wl.m};p(p.S,"Reflect",{has:function(e,t){return t in e}});var Hl=l.Reflect.has,Yl=Eo(!0);p(p.S,"Object",{entries:function(e){return Yl(e)}});var Zl=l.Object.entries,Xl=function(e,t){var n=Ks(t)[0];if(!Hl(e,n))return!0;var r=jo(e,n),i=Lt(t[n]);return"string"===i||"boolean"===i||"number"===i?r!==t[n]:"object"===i?!Zl(t[n]).every((function(e){var t=ao(e,2),n=t[0],i=t[1];return r[n]===i})):void 0};function Kl(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Jl=function(e){ya(i,$a);var t,n,r=Kl(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,i),(e=r.call(this,t)).core=t.core,e.renderSchedule=e.core.renderSchedule,e.renderer=null,e.el=t.el,e.canvas=null,e.displayState={flip:{h:!1,v:!1},scale:1,currentTransform:null},window.view=xa(e),e.init(),e}return Tr(i,[{key:"init",value:function(){this.initContainer(),this.initCanvas()}},{key:"initContainer",value:function(){var e=document.createElement("div");e.classList.add("dicom-container"),e.style.cssText="position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0; z-index:2;",this.viewerContainer=e,this.el.style.position="relative",this.el.style.overflow="hidden",this.el.insertBefore(e,this.el.firstChild)}},{key:"initCanvas",value:function(){var e=document.createElement("canvas");e.style.position="absolute",e.style.display="block",e.style.zIndex="1";var t=this._getRootSize(),n=t.width,r=t.height;e.width=n,e.height=r,this.canvas=e,this.canvas.className="__tx-dicom",this.canvas.id=this.id,this.viewerContainer.insertBefore(this.canvas,this.viewerContainer.firstChild)}},{key:"initResize",value:function(){var e=this,t="tx-resizer";if(!this.el.querySelector(".".concat(t))){var n=-1;this.iframe=document.createElement("iframe"),this.iframe.style.cssText="position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: 0; pointer-events:none;",this.iframe.classList=[t],this.el.style.position="relative",this.el.style.overflow="hidden",this.viewerContainer.insertBefore(this.iframe,this.viewerContainer.firstChild),this.iframe.contentWindow.onresize=function(t){ia()-n<=100||(n=ia(),e._sizeChanged=!0,e._calcSuitableSizeRatio(),e.renderSchedule.invalidate(e.render.bind(e),e.image),e.emit(Ol.ROOT_SIZE_CHANGED,e._getRootSize()))}}}},{key:"showImage",value:function(e){this.image=e;var t=this.renderer.renderData,n=t.width,r=t.height,i=e.columns,a=e.rows;n===a&&r===i||(this.renderer.renderData.width=i,this.renderer.renderData.height=a,this._calcSuitableSizeRatio()),this._displayChanged=!0,this.renderSchedule.invalidate(this.render.bind(this),e),this.emit(Ol.SLICE_CHANGED,{seriesId:e.seriesId,sliceId:e.instanceNumber})}},{key:"render",value:(n=Sr(Ar.mark((function e(t){var n,r,i,a,o,s,u,l,c,h,f,d,p,v,g,m,y,x,_,w,b,S,k,P,T,D,C,E,A;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=!1,!this._displayChanged){e.next=9;break}return r=this.displayState,e.next=7,this.renderer.render(t,r);case 7:this._displayChanged=!1,n=!0;case 9:i=this._getRootSize(),a=i.width,o=i.height,this.canvas.width===a&&this.canvas.height===o||(this.canvas.width=a,this.canvas.height=o),(this._flipChanged||this._positionChanged||this._rotateChanged||this._scaleChanged||this._sizeChanged)&&(l=this.renderer.renderData,this.displayState.currentTransform=jl(this.displayState,this.canvas,this.renderer.renderData),this._flipChanged=!1,this._positionChanged=!1,this._rotateChanged=!1,this._scaleChanged=!1,this._sizeChanged=!1,c=this._getRootSize(),h=c.width,f=c.height,d=this.displayState,p=d.scale,v=d.rotate,g=d.offset,m=void 0===g?{x:0,y:0}:g,y=[(h-l.width*p)/2,(f-l.height*p)/2],this.emit(Ol.MATRIX_CHANGED,{width:l.width,height:l.height,scale:p||1,rootSize:this._getRootSize(),rotate:v||0,offset:m||[0,0],seriesId:null===(s=this.image)||void 0===s?void 0:s.seriesId,sliceId:null===(u=this.image)||void 0===u?void 0:u.instanceNumber,position:y,flip:this.displayState.flip}),n=!0),n&&(D=this.renderer.renderData,C=D.width,E=D.height,(A=this.canvas.getContext("2d")).fillStyle="black",A.setTransform(1,0,0,1,0,0),A.fillRect(0,0,this.canvas.width,this.canvas.height),A.setTransform.apply(A,no(this.displayState.currentTransform)),A.drawImage(D,0,0,C,E,0,0,C,E),this.emit(Ol.IMAGE_RENDERED,{wwwc:{ww:null!==(x=null===(_=this.displayState)||void 0===_||null===(w=_.wwwc)||void 0===w?void 0:w.ww)&&void 0!==x?x:null===(b=this.image)||void 0===b?void 0:b.windowWidth,wc:null!==(S=null===(k=this.displayState)||void 0===k||null===(P=k.wwwc)||void 0===P?void 0:P.wc)&&void 0!==S?S:null===(T=this.image)||void 0===T?void 0:T.windowCenter},columns:this.image.columns,rows:this.image.rows,pixelData:this.image.pixelData,seriesId:this.image.seriesId,sliceId:this.image.instanceNumber,columnPixelSpacing:this.image.columnPixelSpacing,rowPixelSpacing:this.image.rowPixelSpacing,slope:this.image.slope,intercept:this.image.intercept}),n=!1);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setWWWC",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._propertySetter({wwwc:e},"_displayChanged"),this.tryDispatchInjectEvents("wwwc",e,t)}},{key:"setInvert",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._propertySetter({invert:e},"_displayChanged"),this.tryDispatchInjectEvents("invert",e,t)}},{key:"setOffset",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._propertySetter({offset:e},"_positionChanged"),this.tryDispatchInjectEvents("offset",e,t)}},{key:"setRotation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._propertySetter({rotate:e},"_rotateChanged"),this.tryDispatchInjectEvents("rotation",e,t)}},{key:"setFlipV",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={v:e,h:this.displayState.flip.h};this._propertySetter({flip:n},"_flipChanged"),this.tryDispatchInjectEvents("flipV",e,t)}},{key:"setFlipH",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={v:this.displayState.flip.v,h:e};this._propertySetter({flip:n},"_flipChanged"),this.tryDispatchInjectEvents("flipH",e,t)}},{key:"setScale",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._propertySetter({scale:e},"_scaleChanged"),this.tryDispatchInjectEvents("scale",e,t)}},{key:"setTranslation",value:function(e){this._propertySetter({translation:e},"_positionChanged"),this.tryDispatchInjectEvents("translation",e,dispatch)}},{key:"_getRootSize",value:function(){var e=this.el;return{width:e.clientWidth,height:e.clientHeight}}},{key:"_propertySetter",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!!Xl(this.displayState,e)&&(n&&Ra(this.displayState,e),this[t]=!0,this.renderSchedule.invalidate(this.render.bind(this),this.image),!0)}},{key:"_calcSuitableSizeRatio",value:function(){var e;if(null!=this&&null!==(e=this.renderer)&&void 0!==e&&e.renderData){var t=this._getRootSize(),n=t.width,r=t.height,i=this.renderer.renderData,a=i.width,o=i.height,s=n/a;n/r>a/o&&(s=r/o),this.setScale(s)}}},{key:"resize",value:function(e,t){this._sizeChanged=!0,this._calcSuitableSizeRatio(),this.renderSchedule.invalidate(this.render.bind(this),this.image),this.emit(Ol.ROOT_SIZE_CHANGED,{width:e,height:t})}},{key:"snapshot",value:(t=Sr(Ar.mark((function e(){return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"inject",value:function(e){var t,n;this.injectEventNames=(t=null!==(n=this.injectEventNames)&&void 0!==n?n:[]).concat.apply(t,no(e)),this.injectEventNames=no(new Vl(this.injectEventNames))}},{key:"tryDispatchInjectEvents",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(n){var r=this.injectEventNames,i=void 0===r?[]:r;i.includes(e)&&this.emit("".concat(this.id,"-").concat(e),t)}}}],[{key:"create",value:function(){console.error("need implemented by subclass.")}}]),i}();function $l(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var Ql=function(e){ya(n,Jl);var t=$l(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,n),t.call(this,e)}return Tr(n,null,[{key:"create",value:function(e){return new n(e)}}]),n}();function ec(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var tc=function(e){ya(n,Jl);var t=ec(n);function n(e){return kr(this,n),t.call(this,e)}return Tr(n,null,[{key:"create",value:function(e){return new n(e)}}]),n}();function nc(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var rc=function(e){ya(r,Jl);var t,n=nc(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kr(this,r),n.call(this,e)}return Tr(r,[{key:"init",value:function(){this.initContainer(),this.initVideo()}},{key:"initVideo",value:function(){var e=document.createElement("video");e.style.position="absolute",e.style.display="block";var t=this._getRootSize(),n=t.width,r=t.height;e.width=n,e.height=r,this.video=e,this.video.className="__tx-dicom",this.video.controls=!0,this.video.id=this.id,this.viewerContainer.insertBefore(this.video,this.viewerContainer.firstChild),this.viewerContainer.style.zIndex=10}},{key:"showVideo",value:function(e){this.video.src=e}},{key:"resize",value:function(e,t){Yo(wa(r.prototype),"resize",this).call(this,e,t),this.video.width=e,this.video.height=t}},{key:"snapshot",value:(t=Sr(Ar.mark((function e(){var t;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.createElement("canvas")).width=this.video.videoWidth,t.height=this.video.videoHeight,t.getContext("2d").drawImage(this.video,0,0),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"create",value:function(e){return new r(e)}}]),r}(),ic=function(e){var t=null,n="webgl"===e.renderer&&function(){var e={failIfMajorPerformanceCaveat:!0};try{var t=document.createElement("canvas");return!!window.WebGLRenderingContext&&(t.getContext("webgl2",e)||t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(e){return!1}}()?new zl:new Gl;switch(e.plane){case"standard":t=tc.create(e);break;case"pixel":t=Ql.create(e);break;case"video":t=rc.create(e)}return t.core=e.core,t.renderer=n,t};function ac(e){var t=function(){if("undefined"==typeof Reflect||!ga)return!1;if(ga.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(ga(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=wa(e);if(t){var i=wa(this).constructor;n=ga(r,arguments,i)}else n=r.apply(this,arguments);return _a(this,n)}}var oc=function(e){ya(r,$a);var t,n=ac(r);function r(e){var t;return kr(this,r),(t=n.call(this)).init(e),window.a=xa(t),t.data={},t.currentIndex=0,t}return Tr(r,[{key:"init",value:(t=Sr(Ar.mark((function e(t){var n,r,i,a,o,s=this;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ra({},t,{id:this.id}),this.option=n,r=new Cl(n),i=new Do,El(n.el,(function(e){var t=e.clientWidth,n=e.clientHeight;null==a||a.resize(t,n),null==r||r.resize(t,n)})),(a=ic(n)).on(Ol.MATRIX_CHANGED,(function(e){var t,n;r.updateViewport(e);var i="".concat(e.seriesId,"-").concat(e.sliceId),a=null!==(t=null===(n=s.data)||void 0===n?void 0:n[i])&&void 0!==t?t:new jr;r.resetData(a)})),a.on(Ol.IMAGE_RENDERED,(function(e){r.updateImageState(e)})),o=ia(),a.on(Ol.SLICE_CHANGED,(function(e){var t,n;s.option.seriesId=e.seriesId;var i="".concat(e.seriesId,"-").concat(e.sliceId);s.sliceKey=i;var u=null!==(t=null===(n=s.data)||void 0===n?void 0:n[i])&&void 0!==t?t:new jr,l=ia();if(!(l-o<100)){var c=a.renderer,h=a.canvas;r.updateImageState({imgCanvas:c.renderData,canvas:h}),r.renderData(u),o=l}})),r.on(So.DATA_CREATED,(function(e){var t,n,r=s.sliceKey,i=null!==(t=null===(n=s.data)||void 0===n?void 0:n[r])&&void 0!==t?t:new jr;i.set(e.id,e.data),s.data[r]=i})),r.on(So.DATA_UPDATED,(function(e){var t,n,r=s.sliceKey,i=null!==(t=null===(n=s.data)||void 0===n?void 0:n[r])&&void 0!==t?t:new jr;i.set(e.id,e.data),s.data[r]=i})),r.on(So.DATA_REMOVED,(function(e){var t,n,r=s.sliceKey,i=null!==(t=null===(n=s.data)||void 0===n?void 0:n[r])&&void 0!==t?t:new jr;i.delete(e.id),s.data[r]=i})),[i,r].map((function(e){e.on(So.TOOL_ROTATION,(function(e){return a.setRotation(e.rotate,e.dispatch)})),e.on(So.TOOL_WWWC,(function(e){return a.setWWWC(e.wwwc,e.dispatch)})),e.on(So.TOOL_FLIPH,(function(e){return a.setFlipH(e.h,e.dispatch)})),e.on(So.TOOL_FLIPV,(function(e){return a.setFlipV(e.v,e.dispatch)})),e.on(So.TOOL_INVERT,(function(e){return a.setInvert(e.invert,e.dispatch)})),e.on(So.TOOL_SCALE,(function(e){return a.setScale(e.scale,e.dispatch)})),e.on(So.TOOL_TRANSLATE,(function(e){return a.setOffset(e.offset,e.dispatch)})),e.on(So.TOOL_STACK_CHANGE,function(){var e=Sr(Ar.mark((function e(t){var n,r,i,o,u,l,c;return Ar.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.delta,r=t.loop,i=s.option,o=i.plane,u=i.seriesId,l=i.resource,s.currentIndex+=n,s.currentIndex=l.getIllegalIndex(s.currentIndex,u,o,r),e.next=6,l.getImage(u,s.currentIndex,o);case 6:c=e.sent,a.showImage(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),this._toolView=r,this._imageView=a,this.api=i;case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"toolView",get:function(){return this._toolView}},{key:"imageView",get:function(){return this._imageView}},{key:"useTool",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.toolView.useTool(e,t)}},{key:"useCmd",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null===(n=this.api)||void 0===n||n[e](t,r)}}]),r}(),sc=function(){function e(){kr(this,e),this.viewports=new jr,this.core=new po({fps:30}),this.linkManager=new Rl(this.viewports),window.__TX_VIEWPORT_MANAGER__=this}return Tr(e,[{key:"addViewport",value:function(e){Ra(e,{core:this.core,resource:this.resource});var t=new oc(e);return this.viewports.set(t.id,t),t}},{key:"removeViewport",value:function(e){var t;null===(t=this.viewports.get(e))||void 0===t||t.destroy(),this.viewports.delete(e)}},{key:"link",value:function(e,t){}}]),e}();exports.LINK_PROPERTY={WWWC:"wwwc",INVERT:"invert",ROTATION:"rotation",FLIP_V:"flipV",FLIP_H:"flipH",SCALE:"scale",TRANSLATION:"translation",POSITION:"position",SLICE:"slice"},exports.Resource=ua,exports.TOOL_TYPE=bo,exports.ViewportManager=sc;
//# sourceMappingURL=index.cjs.js.map
